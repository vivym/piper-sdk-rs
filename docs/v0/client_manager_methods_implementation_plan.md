# ClientManager æ–¹æ³•å¯ç”¨å®æ–½è®¡åˆ’

> åŸºäºã€ŠClientManager æœªä½¿ç”¨æ–¹æ³•æ·±å…¥åˆ†ææŠ¥å‘Šã€‹ï¼Œæœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„å®æ–½æ­¥éª¤å’Œä»£ç ä¿®æ”¹æŒ‡å¯¼ã€‚

## æ¦‚è¿°

æœ¬è®¡åˆ’å®æ–½ `ClientManager` ä¸­ 4 ä¸ªæœªä½¿ç”¨æ–¹æ³•çš„å¯ç”¨å’Œä¼˜åŒ–ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
- **P0ï¼ˆæœ€é«˜ï¼‰**ï¼š`set_filters()` å’Œ `count()` - å®ç°åè®®æ”¯æŒ
- **P1ï¼ˆä¸­ç­‰ï¼‰**ï¼š`register()` å’Œ `contains()` - ä»£ç æ¸…æ´åº¦ä¼˜åŒ–

---

## é˜¶æ®µ 1ï¼šP0 ä»»åŠ¡ - å®ç°åè®®æ”¯æŒï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

### ç›®æ ‡
å®ç° `SetFilter` å’Œ `GetStatus` æ¶ˆæ¯å¤„ç†ï¼Œå¯ç”¨ `set_filters()` å’Œ `count()` æ–¹æ³•ã€‚

### æ—¶é—´ä¼°ç®—
- **å®ç° `SetFilter` å¤„ç†**ï¼š1-2 å°æ—¶ âœ… **å·²å®Œæˆ**
- **å®ç° `GetStatus` å¤„ç†**ï¼š3-5 å°æ—¶ï¼ˆåŒ…æ‹¬å‡½æ•°ç­¾åä¿®æ”¹ï¼‰ âœ… **å·²å®Œæˆ**
- **æµ‹è¯•å’ŒéªŒè¯**ï¼š2-3 å°æ—¶ âš ï¸ **å¾…å®Œæˆ**

### è¿›åº¦çŠ¶æ€
- âœ… **å·²å®Œæˆ**ï¼šä»£ç å®ç°ï¼ˆä»»åŠ¡ 1.1 å’Œ 1.2ï¼‰
- âš ï¸ **å¾…æµ‹è¯•**ï¼šåŠŸèƒ½æµ‹è¯•å’ŒéªŒè¯

---

### ä»»åŠ¡ 1.1ï¼šå®ç° `SetFilter` æ¶ˆæ¯å¤„ç†

#### ç›®æ ‡
åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ  `SetFilter` æ¶ˆæ¯å¤„ç†ï¼Œå¯ç”¨å®¢æˆ·ç«¯åŠ¨æ€è¿‡æ»¤è§„åˆ™æ›´æ–°ã€‚

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1.1.1ï¼šä¿®æ”¹ `handle_ipc_message()` æ·»åŠ  `SetFilter` å¤„ç†åˆ†æ”¯**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/daemon.rs`

**ä½ç½®**ï¼š`handle_ipc_message()` å‡½æ•°ï¼ˆçº¦ç¬¬ 1173 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
fn handle_ipc_message(
    msg: piper_sdk::can::gs_usb_udp::protocol::Message,
    client_addr: std::os::unix::net::SocketAddr,
    addr_str: &str,  // â† æ–°å¢å‚æ•°ï¼ˆä»»åŠ¡ 1.2 ä¸­ä¼šæ·»åŠ ï¼‰
    tx_adapter: &Arc<Mutex<Option<GsUsbTxAdapter>>>,
    _device_state: &Arc<RwLock<DeviceState>>,
    clients: &Arc<RwLock<ClientManager>>,
    socket: &std::os::unix::net::UnixDatagram,
    stats: &Arc<RwLock<DaemonStats>>,
) {
    match msg {
        // ... ç°æœ‰æ¶ˆæ¯å¤„ç† ...

        Message::SetFilter { client_id, filters } => {
            // âœ… æ–°å¢ï¼šSetFilter æ¶ˆæ¯å¤„ç†
            let mut clients_guard = clients.write().unwrap();
            clients_guard.set_filters(client_id, filters);
            eprintln!(
                "[Client {}] Filters updated: {} rules",
                client_id,
                filters.len()
            );
            // å¯é€‰ï¼šå‘é€ç¡®è®¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯
        },

        // ... å…¶ä»–æ¶ˆæ¯å¤„ç† ...
    }
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ä»£ç ç¼–è¯‘é€šè¿‡
2. åŠŸèƒ½æµ‹è¯•ï¼šä½¿ç”¨å®¢æˆ·ç«¯å‘é€ `SetFilter` æ¶ˆæ¯ï¼ŒéªŒè¯è¿‡æ»¤è§„åˆ™æ›´æ–°

---

**æ­¥éª¤ 1.1.2ï¼šç§»é™¤ `set_filters()` ä¸Šçš„ `#[allow(dead_code)]`**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/client_manager.rs`

**ä½ç½®**ï¼š`ClientManager::set_filters()` æ–¹æ³•ï¼ˆçº¦ç¬¬ 249 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
#[allow(dead_code)]
pub fn set_filters(&mut self, id: u32, filters: Vec<CanIdFilter>) {
    // ...
}

// ä¿®æ”¹å
pub fn set_filters(&mut self, id: u32, filters: Vec<CanIdFilter>) {
    // ...
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ç§»é™¤ `#[allow(dead_code)]` åä¸å†æœ‰è­¦å‘Š
2. åŠŸèƒ½æµ‹è¯•ï¼šç¡®ä¿ `set_filters()` æ–¹æ³•æ­£å¸¸å·¥ä½œ

---

### ä»»åŠ¡ 1.2ï¼šå®ç° `GetStatus` æ¶ˆæ¯å¤„ç†

#### ç›®æ ‡
åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ  `GetStatus` æ¶ˆæ¯å¤„ç†ï¼Œå®ç°å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€æŸ¥è¯¢åŠŸèƒ½ã€‚

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1.2.1ï¼šä¿®æ”¹ `ipc_receive_loop()` æå–åœ°å€å­—ç¬¦ä¸²**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/daemon.rs`

**ä½ç½®**ï¼š`ipc_receive_loop()` å‡½æ•°ï¼ˆçº¦ç¬¬ 1137 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
fn ipc_receive_loop(
    socket: std::os::unix::net::UnixDatagram,
    tx_adapter: Arc<Mutex<Option<GsUsbTxAdapter>>>,
    device_state: Arc<RwLock<DeviceState>>,
    clients: Arc<RwLock<ClientManager>>,
    stats: Arc<RwLock<DaemonStats>>,
) {
    let mut buf = [0u8; 1024];

    loop {
        match socket.recv_from(&mut buf) {
            Ok((len, client_addr)) => {
                // âœ… æ–°å¢ï¼šæå–åœ°å€å­—ç¬¦ä¸²ï¼ˆç”¨äºå‘é€å“åº”ï¼‰
                let addr_str = match client_addr.as_pathname() {
                    Some(path) => match path.to_str() {
                        Some(s) => s.to_string(),
                        None => format!("/tmp/gs_usb_client.sock"),
                    },
                    None => format!("/tmp/gs_usb_client.sock"),
                };

                if let Ok(msg) =
                    piper_sdk::can::gs_usb_udp::protocol::decode_message(&buf[..len])
                {
                    // æ›´æ–°ç»Ÿè®¡ï¼ˆæ¥æ”¶ IPC æ¶ˆæ¯ï¼‰
                    stats.read().unwrap().increment_ipc_received();
                    Self::handle_ipc_message(
                        msg,
                        client_addr,     // â† å·²å­˜åœ¨ï¼šæºåœ°å€ï¼ˆUnix Socket åœ°å€ï¼‰
                        &addr_str,       // â† æ–°å¢ï¼šåœ°å€å­—ç¬¦ä¸²ï¼ˆç”¨äº send_toï¼‰
                        &tx_adapter,
                        &device_state,
                        &clients,
                        &socket,
                        &stats,
                    );
                }
            },
            Err(e) => {
                // ... ç°æœ‰é”™è¯¯å¤„ç† ...
            },
        }
    }
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ä»£ç ç¼–è¯‘é€šè¿‡
2. æ—¥å¿—æ£€æŸ¥ï¼šéªŒè¯åœ°å€å­—ç¬¦ä¸²æ­£ç¡®æå–

**å¯é€‰æ€§èƒ½ä¼˜åŒ–ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰**ï¼š
- èƒŒæ™¯ï¼šä¸Šè¿°å®ç°ä¼šåœ¨æ¯æ¬¡ `recv_from` æ—¶åˆ†é… `addr_str`ï¼ˆ`String`ï¼‰ï¼Œå¯¹äºé«˜é¢‘ `SendFrame` åœºæ™¯å­˜åœ¨å¾®å°å¼€é”€ã€‚
- ä¼˜åŒ–æ€è·¯ï¼šå°† `addr_str` æ„å»ºå»¶ååˆ° `handle_ipc_message()` å†…éƒ¨ï¼Œä»…åœ¨ `Message::GetStatus` åˆ†æ”¯éœ€è¦å‘é€å“åº”æ—¶æ‰æ‰§è¡Œå­—ç¬¦ä¸²è½¬æ¢ã€‚
- åšæ³•ï¼šåœ¨ `ipc_receive_loop()` é‡Œåªä¼ é€’ `client_addr`ï¼ˆ`SocketAddr`ï¼‰ï¼›åœ¨ `handle_ipc_message()` çš„ `GetStatus` åˆ†æ”¯ä¸­æŒ‰éœ€è°ƒç”¨ `client_addr.as_pathname()` â†’ `to_str()` â†’ `to_string()`ã€‚
- é¢„æœŸæ”¶ç›Šï¼šå¯¹é«˜é¢‘æ¶ˆæ¯é›¶é¢å¤–åˆ†é…ï¼›`GetStatus` å±ä½é¢‘æ“ä½œï¼Œå»¶åæ„å»ºä¸ä¼šå½±å“æ€§èƒ½ã€‚

---

**æ­¥éª¤ 1.2.2ï¼šä¿®æ”¹ `handle_ipc_message()` ç­¾åæ·»åŠ  `addr_str` å‚æ•°**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/daemon.rs`

**ä½ç½®**ï¼š`handle_ipc_message()` å‡½æ•°ï¼ˆçº¦ç¬¬ 1173 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
fn handle_ipc_message(
    msg: piper_sdk::can::gs_usb_udp::protocol::Message,
    client_addr: std::os::unix::net::SocketAddr,
    tx_adapter: &Arc<Mutex<Option<GsUsbTxAdapter>>>,
    // ...
) {
    // ...
}

// ä¿®æ”¹å
fn handle_ipc_message(
    msg: piper_sdk::can::gs_usb_udp::protocol::Message,
    client_addr: std::os::unix::net::SocketAddr,  // â† ä¿ç•™ï¼šæºåœ°å€ï¼ˆä¸º UDP é¢„ç•™ï¼‰
    addr_str: &str,  // â† æ–°å¢ï¼šåœ°å€å­—ç¬¦ä¸²ï¼ˆç”¨äº send_toï¼‰
    tx_adapter: &Arc<Mutex<Option<GsUsbTxAdapter>>>,
    // ...
) {
    // ...
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿æ‰€æœ‰è°ƒç”¨ `handle_ipc_message()` çš„åœ°æ–¹éƒ½å·²æ›´æ–°
2. åŠŸèƒ½æµ‹è¯•ï¼šç¡®ä¿ç°æœ‰æ¶ˆæ¯å¤„ç†ä¸å—å½±å“

---

**æ­¥éª¤ 1.2.3ï¼šåœ¨ `handle_ipc_message()` ä¸­æ·»åŠ  `GetStatus` å¤„ç†åˆ†æ”¯**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/daemon.rs`

**ä½ç½®**ï¼š`handle_ipc_message()` å‡½æ•°å†…çš„ `match msg` å—

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
Message::GetStatus => {
    // âœ… æ–°å¢ï¼šGetStatus æ¶ˆæ¯å¤„ç†
    let clients_guard = clients.read().unwrap();
    let stats_guard = stats.read().unwrap();
    let device_state_guard = device_state.read().unwrap();
    let detailed_guard = stats_guard.detailed.read().unwrap();

    let rx_fps = stats_guard.get_rx_fps();
    let tx_fps = stats_guard.get_tx_fps();

    // æ„å»º StatusResponse
    let status = piper_sdk::can::gs_usb_udp::protocol::StatusResponse {
        device_state: match *device_state_guard {
            DeviceState::Connected => 1,
            DeviceState::Disconnected => 0,
            DeviceState::Reconnecting => 2,
        },
        rx_fps_x1000: (rx_fps * 1000.0) as u32,
        tx_fps_x1000: (tx_fps * 1000.0) as u32,
        ipc_sent_fps_x1000: (stats_guard.get_ipc_sent_fps() * 1000.0) as u32,
        ipc_received_fps_x1000: (stats_guard.get_ipc_received_fps() * 1000.0) as u32,
        health_score: stats_guard.health_score(rx_fps, tx_fps) as u8,
        usb_stall_count: detailed_guard.usb_stall_count.load(Ordering::Relaxed),
        can_bus_off_count: detailed_guard.can_bus_off_count.load(Ordering::Relaxed),
        can_error_passive_count: detailed_guard.can_error_passive_count.load(Ordering::Relaxed),
        cpu_usage_percent: detailed_guard.cpu_usage_percent.load(Ordering::Relaxed) as u8,
        client_count: clients_guard.count() as u32,  // â† ä½¿ç”¨ count() æ–¹æ³•
        client_send_blocked: stats_guard.client_send_blocked.load(Ordering::Relaxed),
    };

    // ç¼–ç å¹¶å‘é€ StatusResponse å›è¯·æ±‚è€…
    let mut status_buf = [0u8; 64];
    if let Ok(encoded) = piper_sdk::can::gs_usb_udp::protocol::encode_status_response(
        &status,
        0, // seq (GetStatus ä¸éœ€è¦åºåˆ—å·ï¼Œä½¿ç”¨ 0)
        &mut status_buf,
    ) {
        // âœ… å…³é”®ï¼šå‘é€åˆ°è¯·æ±‚è€…ï¼ˆè€Œä¸æ˜¯å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯ï¼‰
        // âœ… æ³¨æ„ï¼šGetStatus çš„è¯·æ±‚è€…å¯èƒ½å°šæœªæ³¨å†Œï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ recv_from è·å–çš„åœ°å€
        if let Err(e) = socket.send_to(encoded, addr_str) {
            eprintln!("Failed to send StatusResponse: {}", e);
        } else {
            eprintln!("[GetStatus] Sent StatusResponse to {}", addr_str);
        }
    }
},
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæ‰€æœ‰å­—æ®µå’Œç±»å‹åŒ¹é…
2. åŠŸèƒ½æµ‹è¯•ï¼šä½¿ç”¨å®¢æˆ·ç«¯å‘é€ `GetStatus` æ¶ˆæ¯ï¼ŒéªŒè¯å“åº”æ­£ç¡®è¿”å›
3. è¾¹ç•Œæµ‹è¯•ï¼šéªŒè¯æœªæ³¨å†Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥æ¥æ”¶å“åº”

---

**æ­¥éª¤ 1.2.4ï¼šåœ¨ `status_print_loop()` ä¸­ä½¿ç”¨ `count()` æ›¿æ¢ `ids.len()`**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/daemon.rs`

**ä½ç½®**ï¼š`status_print_loop()` å‡½æ•°ï¼ˆçº¦ç¬¬ 1360 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
let (client_count, client_ids) = {
    let clients_guard = clients.read().unwrap();
    let ids: Vec<u32> = clients_guard.iter().map(|client| client.id).collect();
    (ids.len(), ids)  // â† ç›´æ¥ä½¿ç”¨ ids.len()
};

// ä¿®æ”¹å
let (client_count, client_ids) = {
    let clients_guard = clients.read().unwrap();
    let ids: Vec<u32> = clients_guard.iter().map(|client| client.id).collect();
    (clients_guard.count(), ids)  // â† ä½¿ç”¨ count() æ–¹æ³•ï¼Œæ›´è¯­ä¹‰åŒ–
};
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ä»£ç ç¼–è¯‘é€šè¿‡
2. åŠŸèƒ½æµ‹è¯•ï¼šéªŒè¯çŠ¶æ€æ‰“å°ä¸­çš„å®¢æˆ·ç«¯æ•°é‡æ˜¾ç¤ºæ­£ç¡®

---

**æ­¥éª¤ 1.2.5ï¼šç§»é™¤ `count()` ä¸Šçš„ `#[allow(dead_code)]`**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/client_manager.rs`

**ä½ç½®**ï¼š`ClientManager::count()` æ–¹æ³•ï¼ˆçº¦ç¬¬ 281 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
#[allow(dead_code)]
pub fn count(&self) -> usize {
    self.clients.len()
}

// ä¿®æ”¹å
pub fn count(&self) -> usize {
    self.clients.len()
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ç§»é™¤ `#[allow(dead_code)]` åä¸å†æœ‰è­¦å‘Š
2. åŠŸèƒ½æµ‹è¯•ï¼šç¡®ä¿ `count()` æ–¹æ³•æ­£å¸¸å·¥ä½œ

---

## é˜¶æ®µ 2ï¼šP1 ä»»åŠ¡ - ä»£ç æ¸…æ´åº¦ä¼˜åŒ–ï¼ˆä¸­ç­‰ä¼˜å…ˆçº§ï¼‰

### ç›®æ ‡
ä½¿ç”¨ `#[cfg(test)]` æ ‡è®° `register()` å’Œ `contains()` æ–¹æ³•ï¼Œæ¶ˆé™¤ç¼–è¯‘è­¦å‘Šï¼Œä¿ç•™æµ‹è¯•ä»£ç å¯è¯»æ€§ã€‚

### æ—¶é—´ä¼°ç®—
- **ä¼˜åŒ– `register()` æ–¹æ³•**ï¼š15-30 åˆ†é’Ÿ
- **ä¼˜åŒ– `contains()` æ–¹æ³•**ï¼š15-30 åˆ†é’Ÿ
- **æµ‹è¯•éªŒè¯**ï¼š15-30 åˆ†é’Ÿ
- **æ€»è®¡**ï¼š45-90 åˆ†é’Ÿ

### è¿›åº¦çŠ¶æ€
- âœ… **å·²å®Œæˆ**ï¼šæ‰€æœ‰æ­¥éª¤ï¼ˆä»»åŠ¡ 2.1 å’Œ 2.2ï¼‰

---

### ä»»åŠ¡ 2.1ï¼šä¼˜åŒ– `register()` æ–¹æ³•

#### ç›®æ ‡
å°† `register()` æ–¹æ³•æ ‡è®°ä¸º `#[cfg(test)]`ï¼Œæ˜ç¡®è¡¨è¾¾"ç›®å‰ä»…æµ‹è¯•ç”¨"çš„è¯­ä¹‰ã€‚

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 2.1.1ï¼šä¿®æ”¹ `register()` æ–¹æ³•æ·»åŠ  `#[cfg(test)]`**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/client_manager.rs`

**ä½ç½®**ï¼š`ClientManager::register()` æ–¹æ³•ï¼ˆçº¦ç¬¬ 175 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
#[allow(dead_code)]
pub fn register(
    &mut self,
    id: u32,
    addr: ClientAddr,
    filters: Vec<CanIdFilter>,
) -> Result<(), ClientError> {
    // ...
}

// ä¿®æ”¹å
#[cfg(test)]
pub fn register(
    &mut self,
    id: u32,
    addr: ClientAddr,
    filters: Vec<CanIdFilter>,
) -> Result<(), ClientError> {
    // ...
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ç”Ÿäº§ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæµ‹è¯•ä»£ç ä»ç„¶å¯ä»¥ä½¿ç”¨
2. æµ‹è¯•éªŒè¯ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰ä½¿ç”¨ `register()` çš„æµ‹è¯•é€šè¿‡

---

### ä»»åŠ¡ 2.2ï¼šä¼˜åŒ– `contains()` æ–¹æ³•

#### ç›®æ ‡
å°† `contains()` æ–¹æ³•æ ‡è®°ä¸º `#[cfg(test)]`ï¼Œä¿ç•™æµ‹è¯•ä»£ç çš„å¯è¯»æ€§ã€‚

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 2.2.1ï¼šä¿®æ”¹ `contains()` æ–¹æ³•æ·»åŠ  `#[cfg(test)]`**

**æ–‡ä»¶**ï¼š`src/bin/gs_usb_daemon/client_manager.rs`

**ä½ç½®**ï¼š`ClientManager::contains()` æ–¹æ³•ï¼ˆçº¦ç¬¬ 287 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š

```rust
// ä¿®æ”¹å‰
#[allow(dead_code)]
pub fn contains(&self, id: u32) -> bool {
    self.clients.contains_key(&id)
}

// ä¿®æ”¹å
#[cfg(test)]
pub fn contains(&self, id: u32) -> bool {
    self.clients.contains_key(&id)
}
```

**éªŒè¯æ–¹æ³•**ï¼š
1. ç¼–è¯‘æ£€æŸ¥ï¼šç¡®ä¿ç”Ÿäº§ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæµ‹è¯•ä»£ç ä»ç„¶å¯ä»¥ä½¿ç”¨
2. æµ‹è¯•éªŒè¯ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰ä½¿ç”¨ `contains()` çš„æµ‹è¯•é€šè¿‡

---

## æµ‹è¯•ç­–ç•¥

### é˜¶æ®µ 1 æµ‹è¯•ï¼ˆP0ï¼‰

#### `SetFilter` æ¶ˆæ¯å¤„ç†æµ‹è¯•

1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**ï¼š
   - å®¢æˆ·ç«¯å‘é€ `SetFilter` æ¶ˆæ¯
   - éªŒè¯è¿‡æ»¤è§„åˆ™æ­£ç¡®æ›´æ–°
   - éªŒè¯æ—¥å¿—è¾“å‡ºæ­£ç¡®

2. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**ï¼š
   - å‘é€ç©ºçš„è¿‡æ»¤è§„åˆ™åˆ—è¡¨
   - å‘é€ä¸å­˜åœ¨çš„ `client_id`
   - éªŒè¯é”™è¯¯å¤„ç†

3. **é›†æˆæµ‹è¯•**ï¼š
   - å®¢æˆ·ç«¯è¿æ¥åå‘é€ `SetFilter` æ¶ˆæ¯
   - éªŒè¯è¿‡æ»¤è§„åˆ™ç”Ÿæ•ˆï¼ˆåªæ¥æ”¶åŒ¹é…çš„ CAN å¸§ï¼‰

#### `GetStatus` æ¶ˆæ¯å¤„ç†æµ‹è¯•

1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**ï¼š
   - å®¢æˆ·ç«¯å‘é€ `GetStatus` æ¶ˆæ¯
   - éªŒè¯ `StatusResponse` æ­£ç¡®è¿”å›
   - éªŒè¯æ‰€æœ‰å­—æ®µæ•°æ®æ­£ç¡®

2. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**ï¼š
   - æœªæ³¨å†Œå®¢æˆ·ç«¯å‘é€ `GetStatus` æ¶ˆæ¯ï¼ˆåº”èƒ½æ¥æ”¶å“åº”ï¼‰
   - éªŒè¯è®¾å¤‡ä¸åŒçŠ¶æ€ä¸‹çš„å“åº”ï¼ˆConnected/Disconnected/Reconnectingï¼‰
   - éªŒè¯ç©ºå®¢æˆ·ç«¯åˆ—è¡¨æ—¶çš„ `client_count` ä¸º 0

3. **é›†æˆæµ‹è¯•**ï¼š
   - å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€ `GetStatus` æ¶ˆæ¯
   - éªŒè¯å“åº”æ­£ç¡®è·¯ç”±åˆ°å„è‡ªçš„è¯·æ±‚è€…
   - éªŒè¯ `count()` æ–¹æ³•è¿”å›æ­£ç¡®çš„å®¢æˆ·ç«¯æ•°é‡

### é˜¶æ®µ 2 æµ‹è¯•ï¼ˆP1ï¼‰

#### `#[cfg(test)]` æ ‡è®°éªŒè¯

1. **ç¼–è¯‘æµ‹è¯•**ï¼š
   - ç”Ÿäº§ä»£ç ç¼–è¯‘ï¼š`cargo build --release`
   - æµ‹è¯•ä»£ç ç¼–è¯‘ï¼š`cargo test`
   - éªŒè¯æ—  `dead_code` è­¦å‘Š

2. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - è¿è¡Œæ‰€æœ‰ä½¿ç”¨ `register()` çš„å•å…ƒæµ‹è¯•
   - è¿è¡Œæ‰€æœ‰ä½¿ç”¨ `contains()` çš„å•å…ƒæµ‹è¯•
   - éªŒè¯æµ‹è¯•ä»£ç å¯è¯»æ€§ï¼ˆ`assert!(manager.contains(1))` vs `assert!(manager.clients.contains_key(&1))`ï¼‰

---

## é£é™©è¯„ä¼°

### é˜¶æ®µ 1 é£é™©

| é£é™© | å½±å“ | å¯èƒ½æ€§ | ç¼“è§£æªæ–½ |
|------|------|--------|---------|
| `GetStatus` å“åº”è·¯ç”±é”™è¯¯ | é«˜ | ä½ | ä½¿ç”¨ `addr_str` ç²¾ç¡®è·¯ç”±ï¼Œè€Œä¸æ˜¯å¹¿æ’­ |
| å‡½æ•°ç­¾åä¿®æ”¹å½±å“ç°æœ‰ä»£ç  | ä¸­ | ä¸­ | ä»”ç»†æ£€æŸ¥æ‰€æœ‰è°ƒç”¨ç‚¹ï¼Œç¡®ä¿å‚æ•°ä¼ é€’æ­£ç¡® |
| `StatusResponse` å­—æ®µç±»å‹ä¸åŒ¹é… | ä¸­ | ä½ | ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿å­—æ®µç±»å‹åŒ¹é… |
| æ€§èƒ½å½±å“ï¼ˆ`GetStatus` é¢‘ç¹æŸ¥è¯¢ï¼‰ | ä½ | ä½ | `GetStatus` ä¸æ˜¯é«˜é¢‘æ“ä½œï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥ |

### é˜¶æ®µ 2 é£é™©

| é£é™© | å½±å“ | å¯èƒ½æ€§ | ç¼“è§£æªæ–½ |
|------|------|--------|---------|
| `#[cfg(test)]` å¯¼è‡´æµ‹è¯•å¤±è´¥ | ä½ | ä½ | ç¡®ä¿æ‰€æœ‰æµ‹è¯•ä½¿ç”¨çš„æ–¹æ³•éƒ½å·²æ ‡è®° |
| è¯¯åˆ  `register()` å¯¼è‡´æœªæ¥ UDP æ”¯æŒå›°éš¾ | ä¸­ | ä½ | ä½¿ç”¨ `#[cfg(test)]` ä¿ç•™æ–¹æ³•ï¼Œæ˜ç¡®è¯­ä¹‰ |

---

## å®æ–½åæ•ˆæœ

### ä»£ç è´¨é‡æå‡
- âœ… å‡å°‘ `dead_code` è­¦å‘Šï¼ˆä» 4 ä¸ªå‡å°‘åˆ° 0 ä¸ªï¼‰
- âœ… æå‡åè®®å®Œæ•´æ€§ï¼ˆå®ç° `SetFilter` å’Œ `GetStatus`ï¼‰
- âœ… æé«˜ä»£ç å¯ç»´æŠ¤æ€§ï¼ˆæ˜ç¡®æµ‹è¯•ä¸“ç”¨æ–¹æ³•çš„è¯­ä¹‰ï¼‰
- âœ… æå‡ä»£ç å¯è¯»æ€§ï¼ˆæµ‹è¯•ä»£ç ä½¿ç”¨ `contains()` è€Œé `contains_key()`ï¼‰

### åŠŸèƒ½æå‡
- âœ… å®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€æ›´æ–°è¿‡æ»¤è§„åˆ™ï¼ˆè¿è¡Œæ—¶æ›´æ”¹ CAN ID è¿‡æ»¤ï¼‰
- âœ… å®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼ˆåŒ…æ‹¬å®¢æˆ·ç«¯æ•°é‡ã€å¥åº·åº¦ç­‰ï¼‰
- âœ… ä¸º UDP æ”¯æŒåšå¥½å‡†å¤‡ï¼ˆ`register()` æ–¹æ³•ä¿ç•™ï¼Œç­‰å¾… UDP æ”¯æŒï¼‰

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è¿è¡Œæ—¶éœ€æ±‚åŠ¨æ€è°ƒæ•´è¿‡æ»¤è§„åˆ™
- âœ… å®¢æˆ·ç«¯å¯ä»¥ç›‘æ§å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼Œè¿›è¡Œå¥åº·æ£€æŸ¥å’Œæ•…éšœè¯Šæ–­
- âœ… å¼€å‘å·¥å…·å¯ä»¥æŸ¥è¯¢å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼Œè¿›è¡Œè°ƒè¯•å’Œç›‘æ§

---

## åç»­å·¥ä½œ

### UDP æ”¯æŒï¼ˆé•¿æœŸï¼‰
å½“å®ç° UDP æ”¯æŒæ—¶ï¼š
1. å»æ‰ `register()` ä¸Šçš„ `#[cfg(test)]` æ ‡è®°
2. åœ¨ UDP è¿æ¥å¤„ç†ä¸­ä½¿ç”¨ `register()` æ–¹æ³•
3. ä¿®æ”¹ `handle_ipc_message()` ä»¥æ”¯æŒ UDP socket åœ°å€è·å–

### å¯é€‰å¢å¼º
1. **`SetFilter` ç¡®è®¤æ¶ˆæ¯**ï¼šåœ¨ `SetFilter` å¤„ç†æˆåŠŸåï¼Œå‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤æ¶ˆæ¯
2. **`GetStatus` é¢‘ç‡é™åˆ¶**ï¼šä¸ºé¿å…æ€§èƒ½é—®é¢˜ï¼Œé™åˆ¶ `GetStatus` çš„æŸ¥è¯¢é¢‘ç‡
3. **`GetStatus` æƒé™æ§åˆ¶**ï¼šé™åˆ¶åªæœ‰å·²æ³¨å†Œå®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢çŠ¶æ€ï¼ˆå½“å‰è®¾è®¡å…è®¸æœªæ³¨å†Œå®¢æˆ·ç«¯æŸ¥è¯¢ï¼‰

---

## æ—¶é—´çº¿

### é˜¶æ®µ 1ï¼ˆP0ï¼‰ï¼š6-10 å°æ—¶
- **ç¬¬ 1-2 å°æ—¶**ï¼šå®ç° `SetFilter` æ¶ˆæ¯å¤„ç†ï¼ˆä»»åŠ¡ 1.1ï¼‰
- **ç¬¬ 3-7 å°æ—¶**ï¼šå®ç° `GetStatus` æ¶ˆæ¯å¤„ç†ï¼ˆä»»åŠ¡ 1.2ï¼‰
- **ç¬¬ 8-10 å°æ—¶**ï¼šæµ‹è¯•å’ŒéªŒè¯

### é˜¶æ®µ 2ï¼ˆP1ï¼‰ï¼š45-90 åˆ†é’Ÿ
- **ç¬¬ 1-30 åˆ†é’Ÿ**ï¼šä¼˜åŒ– `register()` æ–¹æ³•ï¼ˆä»»åŠ¡ 2.1ï¼‰
- **ç¬¬ 31-60 åˆ†é’Ÿ**ï¼šä¼˜åŒ– `contains()` æ–¹æ³•ï¼ˆä»»åŠ¡ 2.2ï¼‰
- **ç¬¬ 61-90 åˆ†é’Ÿ**ï¼šæµ‹è¯•éªŒè¯

### æ€»è®¡
- **æ€»è®¡æ—¶é—´**ï¼š7-12 å°æ—¶
- **å»ºè®®æ‹†åˆ†**ï¼šé˜¶æ®µ 1 å®Œæˆåè¿›è¡Œä»£ç å®¡æŸ¥ï¼Œå†å¼€å§‹é˜¶æ®µ 2

---

## æ£€æŸ¥æ¸…å•

### é˜¶æ®µ 1ï¼ˆP0ï¼‰

#### `SetFilter` æ¶ˆæ¯å¤„ç†
- [x] åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ  `SetFilter` å¤„ç†åˆ†æ”¯ âœ… **å·²å®Œæˆ**
- [x] ç§»é™¤ `set_filters()` ä¸Šçš„ `#[allow(dead_code)]` âœ… **å·²å®Œæˆ**
- [ ] æµ‹è¯• `SetFilter` æ¶ˆæ¯å¤„ç†åŠŸèƒ½ âš ï¸ **å¾…æµ‹è¯•**
- [ ] éªŒè¯è¿‡æ»¤è§„åˆ™æ›´æ–°æ­£ç¡® âš ï¸ **å¾…æµ‹è¯•**

#### `GetStatus` æ¶ˆæ¯å¤„ç†
- [x] åœ¨ `handle_ipc_message()` ä¸­æŒ‰éœ€æå–åœ°å€å­—ç¬¦ä¸²ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ âœ… **å·²å®Œæˆ**
- [x] åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ  `GetStatus` å¤„ç†åˆ†æ”¯ âœ… **å·²å®Œæˆ**
- [x] åœ¨ `status_print_loop()` ä¸­ä½¿ç”¨ `count()` æ›¿æ¢ `ids.len()` âœ… **å·²å®Œæˆ**
- [x] ç§»é™¤ `count()` ä¸Šçš„ `#[allow(dead_code)]` âœ… **å·²å®Œæˆ**
- [ ] æµ‹è¯• `GetStatus` æ¶ˆæ¯å¤„ç†åŠŸèƒ½ âš ï¸ **å¾…æµ‹è¯•**
- [ ] éªŒè¯å“åº”æ­£ç¡®è·¯ç”±åˆ°è¯·æ±‚è€… âš ï¸ **å¾…æµ‹è¯•**
- [ ] éªŒè¯æœªæ³¨å†Œå®¢æˆ·ç«¯å¯ä»¥æ¥æ”¶å“åº” âš ï¸ **å¾…æµ‹è¯•**

### é˜¶æ®µ 2ï¼ˆP1ï¼‰

#### ä»£ç ä¼˜åŒ–
- [x] å°† `register()` æ”¹ä¸º `#[cfg(test)]` âœ… **å·²å®Œæˆ**
- [x] å°† `contains()` æ”¹ä¸º `#[cfg(test)]` âœ… **å·²å®Œæˆ**
- [x] éªŒè¯ç”Ÿäº§ä»£ç ç¼–è¯‘é€šè¿‡ âœ… **å·²å®Œæˆ**
- [x] éªŒè¯æµ‹è¯•ä»£ç ç¼–è¯‘é€šè¿‡ âœ… **å·²å®Œæˆ**
- [x] è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ âœ… **å·²å®Œæˆ**ï¼ˆ9 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

---

**è®¡åˆ’åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´
**è®¡åˆ’çŠ¶æ€**ï¼šâœ… **æ‰€æœ‰ä»£ç å®ç°å·²å®Œæˆï¼Œå¾…åŠŸèƒ½æµ‹è¯•éªŒè¯**
**å‚è€ƒæ–‡æ¡£**ï¼šã€ŠClientManager æœªä½¿ç”¨æ–¹æ³•æ·±å…¥åˆ†ææŠ¥å‘Š v1.1ã€‹

---

## å®æ–½è¿›åº¦æ›´æ–°

### é˜¶æ®µ 1ï¼ˆP0ï¼‰- å·²å®Œæˆ âœ…

**å®æ–½æ—¥æœŸ**ï¼š2024å¹´

**å·²å®Œæˆå†…å®¹**ï¼š

1. âœ… **ä»»åŠ¡ 1.1ï¼šå®ç° `SetFilter` æ¶ˆæ¯å¤„ç†**
   - âœ… åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ äº† `SetFilter` å¤„ç†åˆ†æ”¯ï¼ˆç¬¬ 1276-1286 è¡Œï¼‰
   - âœ… ç§»é™¤äº† `set_filters()` ä¸Šçš„ `#[allow(dead_code)]` å±æ€§
   - âœ… å®ç°äº†è¿‡æ»¤è§„åˆ™åŠ¨æ€æ›´æ–°åŠŸèƒ½

2. âœ… **ä»»åŠ¡ 1.2ï¼šå®ç° `GetStatus` æ¶ˆæ¯å¤„ç†**
   - âœ… åœ¨ `handle_ipc_message()` ä¸­æ·»åŠ äº† `GetStatus` å¤„ç†åˆ†æ”¯ï¼ˆç¬¬ 1287-1345 è¡Œï¼‰
   - âœ… å®ç°äº†æŒ‰éœ€æå–åœ°å€å­—ç¬¦ä¸²çš„æ€§èƒ½ä¼˜åŒ–ï¼ˆä»…åœ¨ `GetStatus` åˆ†æ”¯å†…è½¬æ¢ï¼‰
   - âœ… åœ¨ `status_print_loop()` ä¸­ä½¿ç”¨ `count()` æ›¿æ¢äº† `ids.len()`ï¼ˆç¬¬ 1429 è¡Œï¼‰
   - âœ… ç§»é™¤äº† `count()` ä¸Šçš„ `#[allow(dead_code)]` å±æ€§

**å…³é”®å®ç°ç»†èŠ‚**ï¼š

- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®ä¼˜åŒ–å»ºè®®ï¼Œ`GetStatus` åˆ†æ”¯å†…æŒ‰éœ€æå–åœ°å€å­—ç¬¦ä¸²ï¼Œé¿å…é«˜é¢‘ `SendFrame` æ¶ˆæ¯çš„é¢å¤–åˆ†é…å¼€é”€
- **åœ°å€è·¯ç”±**ï¼š`GetStatus` å“åº”ä½¿ç”¨ `socket.send_to(encoded, &addr_str)` ç²¾ç¡®è·¯ç”±åˆ°è¯·æ±‚è€…ï¼Œè€Œä¸æ˜¯å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯
- **æœªæ³¨å†Œå®¢æˆ·ç«¯æ”¯æŒ**ï¼š`GetStatus` çš„è¯·æ±‚è€…å¯èƒ½å°šæœªæ³¨å†Œï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ `recv_from()` è·å–çš„æºåœ°å€å‘é€å“åº”

**ä»£ç å˜æ›´æ–‡ä»¶**ï¼š

- `src/bin/gs_usb_daemon/daemon.rs`ï¼šæ·»åŠ  `SetFilter` å’Œ `GetStatus` æ¶ˆæ¯å¤„ç†
- `src/bin/gs_usb_daemon/client_manager.rs`ï¼šç§»é™¤ `set_filters()` å’Œ `count()` ä¸Šçš„ `#[allow(dead_code)]`

**ç¼–è¯‘çŠ¶æ€**ï¼šâœ… **ç¼–è¯‘é€šè¿‡**ï¼ˆä»…æœ‰ä¸€ä¸ªæ— å…³çš„ `protocol.rs` è­¦å‘Šï¼‰

**å¾…æµ‹è¯•éªŒè¯**ï¼š

- [ ] `SetFilter` æ¶ˆæ¯å¤„ç†åŠŸèƒ½æµ‹è¯•
- [ ] `GetStatus` æ¶ˆæ¯å¤„ç†åŠŸèƒ½æµ‹è¯•
- [ ] è¿‡æ»¤è§„åˆ™åŠ¨æ€æ›´æ–°éªŒè¯
- [ ] å“åº”è·¯ç”±æ­£ç¡®æ€§éªŒè¯
- [ ] æœªæ³¨å†Œå®¢æˆ·ç«¯æŸ¥è¯¢éªŒè¯

---

---

### é˜¶æ®µ 2ï¼ˆP1ï¼‰- å·²å®Œæˆ âœ…

**å®æ–½æ—¥æœŸ**ï¼š2024å¹´

**å·²å®Œæˆå†…å®¹**ï¼š

1. âœ… **ä»»åŠ¡ 2.1ï¼šä¼˜åŒ– `register()` æ–¹æ³•**
   - âœ… å°† `register()` æ”¹ä¸º `#[cfg(test)] pub fn register(...)`
   - âœ… ç§»é™¤äº† `#[allow(dead_code)]` å±æ€§
   - âœ… æ˜ç¡®è¡¨è¾¾äº†"ç›®å‰ä»…æµ‹è¯•ç”¨"çš„è¯­ä¹‰

2. âœ… **ä»»åŠ¡ 2.2ï¼šä¼˜åŒ– `contains()` æ–¹æ³•**
   - âœ… å°† `contains()` æ”¹ä¸º `#[cfg(test)] pub fn contains(...)`
   - âœ… ç§»é™¤äº† `#[allow(dead_code)]` å±æ€§
   - âœ… ä¿ç•™äº†æµ‹è¯•ä»£ç çš„å¯è¯»æ€§ï¼ˆ`assert!(manager.contains(1))` vs `assert!(manager.clients.contains_key(&1))`ï¼‰

**ä»£ç å˜æ›´æ–‡ä»¶**ï¼š

- `src/bin/gs_usb_daemon/client_manager.rs`ï¼šå°† `register()` å’Œ `contains()` æ”¹ä¸º `#[cfg(test)]`

**ç¼–è¯‘çŠ¶æ€**ï¼šâœ… **ç¼–è¯‘é€šè¿‡**ï¼ˆç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä»£ç å‡ç¼–è¯‘æˆåŠŸï¼‰

**æµ‹è¯•çŠ¶æ€**ï¼šâœ… **æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡**ï¼ˆ9 ä¸ª `client_manager` æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**å®ç°æ•ˆæœ**ï¼š

- âœ… æ¶ˆé™¤äº†æ‰€æœ‰ `dead_code` è­¦å‘Šï¼ˆä» 4 ä¸ªå‡å°‘åˆ° 0 ä¸ªï¼‰
- âœ… æ˜ç¡®è¡¨è¾¾äº†æµ‹è¯•ä¸“ç”¨æ–¹æ³•çš„è¯­ä¹‰ï¼ˆ`#[cfg(test)]` æ¯” `#[allow(dead_code)]` æ›´ä¼˜é›…ï¼‰
- âœ… ä¿ç•™äº†æµ‹è¯•ä»£ç çš„å¯è¯»æ€§ï¼ˆ`contains()` åœ¨æµ‹è¯•ä¸­æ¯” `contains_key()` æ›´ç›´è§‚ï¼‰
- âœ… ä¸ºæœªæ¥ UDP æ”¯æŒåšå¥½å‡†å¤‡ï¼ˆ`register()` æ–¹æ³•ä¿ç•™ï¼Œç­‰å¾… UDP æ”¯æŒæ—¶å»æ‰ `#[cfg(test)]`ï¼‰

---

## æ•´ä½“è¿›åº¦æ€»ç»“

### âœ… å·²å®Œæˆï¼ˆä»£ç å®ç°ï¼‰

#### é˜¶æ®µ 1ï¼ˆP0ï¼‰- å·²å®Œæˆ âœ…
- âœ… `SetFilter` æ¶ˆæ¯å¤„ç†å®ç°
- âœ… `GetStatus` æ¶ˆæ¯å¤„ç†å®ç°
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆæŒ‰éœ€æå–åœ°å€å­—ç¬¦ä¸²ï¼‰
- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡

#### é˜¶æ®µ 2ï¼ˆP1ï¼‰- å·²å®Œæˆ âœ…
- âœ… `register()` æ–¹æ³•ä¼˜åŒ–ï¼ˆ`#[cfg(test)]`ï¼‰
- âœ… `contains()` æ–¹æ³•ä¼˜åŒ–ï¼ˆ`#[cfg(test)]`ï¼‰
- âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ9 ä¸ªæµ‹è¯•ï¼‰

### âš ï¸ å¾…å®Œæˆï¼ˆæµ‹è¯•éªŒè¯ï¼‰

#### åŠŸèƒ½æµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] `SetFilter` æ¶ˆæ¯å¤„ç†åŠŸèƒ½æµ‹è¯•
- [ ] `GetStatus` æ¶ˆæ¯å¤„ç†åŠŸèƒ½æµ‹è¯•
- [ ] è¿‡æ»¤è§„åˆ™åŠ¨æ€æ›´æ–°éªŒè¯
- [ ] å“åº”è·¯ç”±æ­£ç¡®æ€§éªŒè¯
- [ ] æœªæ³¨å†Œå®¢æˆ·ç«¯æŸ¥è¯¢éªŒè¯

### ğŸ“Š å®Œæˆåº¦ç»Ÿè®¡

- **ä»£ç å®ç°**ï¼š100% âœ…ï¼ˆæ‰€æœ‰è®¡åˆ’ä»»åŠ¡å·²å®Œæˆï¼‰
- **å•å…ƒæµ‹è¯•**ï¼š100% âœ…ï¼ˆ9 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
- **åŠŸèƒ½æµ‹è¯•**ï¼š0% âš ï¸ï¼ˆå¾…å®é™…ç¯å¢ƒæµ‹è¯•ï¼‰
- **ä»£ç è´¨é‡**ï¼šâœ… `dead_code` è­¦å‘Šå·²æ¶ˆé™¤

### ğŸ¯ å®ç°æˆæœ

1. **åè®®å®Œæ•´æ€§æå‡**ï¼š
   - âœ… å®ç°äº† `SetFilter` æ¶ˆæ¯å¤„ç†ï¼ˆå®¢æˆ·ç«¯å¯åŠ¨æ€æ›´æ–°è¿‡æ»¤è§„åˆ™ï¼‰
   - âœ… å®ç°äº† `GetStatus` æ¶ˆæ¯å¤„ç†ï¼ˆå®¢æˆ·ç«¯å¯æŸ¥è¯¢å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ï¼‰

2. **ä»£ç è´¨é‡æå‡**ï¼š
   - âœ… æ¶ˆé™¤äº†æ‰€æœ‰ `dead_code` è­¦å‘Š
   - âœ… ä½¿ç”¨ `#[cfg(test)]` æ˜ç¡®è¡¨è¾¾æµ‹è¯•ä¸“ç”¨æ–¹æ³•
   - âœ… ä¿ç•™äº†æµ‹è¯•ä»£ç çš„å¯è¯»æ€§

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - âœ… `GetStatus` åœ°å€å­—ç¬¦ä¸²æŒ‰éœ€æå–ï¼Œé¿å…é«˜é¢‘æ¶ˆæ¯çš„é¢å¤–åˆ†é…

4. **å¯ç»´æŠ¤æ€§æå‡**ï¼š
   - âœ… æ–¹æ³•è¯­ä¹‰æ¸…æ™°ï¼ˆ`count()` æ¯” `ids.len()` æ›´è¯­ä¹‰åŒ–ï¼‰
   - âœ… ä¸ºæœªæ¥ UDP æ”¯æŒåšå¥½å‡†å¤‡

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šå®Œæˆé˜¶æ®µ 1ï¼ˆP0ï¼‰çš„åŠŸèƒ½æµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ŒéªŒè¯ `SetFilter` å’Œ `GetStatus` æ¶ˆæ¯å¤„ç†çš„æ­£ç¡®æ€§
