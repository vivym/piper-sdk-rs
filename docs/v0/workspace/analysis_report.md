# Piper SDK Workspace é‡æ„åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-25
**é¡¹ç›®**: piper-sdk-rs
**å½“å‰ç‰ˆæœ¬**: v0.0.2
**æŠ¥å‘Šç±»å‹**: æŠ€æœ¯æ¶æ„åˆ†æä¸é‡æ„å»ºè®®

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šæ·±å…¥åˆ†æäº† piper-sdk-rs é¡¹ç›®çš„å½“å‰ç»“æ„ï¼Œè¯„ä¼°äº†å°†å…¶é‡æ„ä¸º Cargo workspace çš„å¿…è¦æ€§ã€‚ç»è¿‡å…¨é¢åˆ†æï¼Œ**å¼ºçƒˆå»ºè®®**å°†é¡¹ç›®è½¬æ¢ä¸º workspace æ¨¡å¼ã€‚

**å…³é”®å‘ç°**:
- âœ… é¡¹ç›®å·²æœ‰æ¸…æ™°çš„å±‚æ¬¡è¾¹ç•Œï¼Œé€‚åˆæ‹†åˆ†
- âœ… æ— å¾ªç¯ä¾èµ–ï¼Œè¿ç§»é£é™©ä½
- âœ… ä»£ç é‡è¾¾åˆ° 35K+ è¡Œï¼Œå¯æ˜¾è‘—æå‡ç¼–è¯‘é€Ÿåº¦
- âœ… æœ‰æ˜ç¡®çš„æ‰©å±•éœ€æ±‚ï¼ˆä¸Šä½æœºã€CLI å·¥å…·ç­‰ï¼‰
- âš ï¸ éœ€è¦ç»´æŠ¤å‘åå…¼å®¹æ€§

**é¢„æœŸæ”¶ç›Š**:
- ğŸš€ å¢é‡ç¼–è¯‘æ—¶é—´å‡å°‘ 40-60%
- ğŸ“¦ ç‹¬ç«‹çš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒ
- ğŸ§ª æ›´å¥½çš„æµ‹è¯•éš”ç¦»
- ğŸ”§ æ”¯æŒå¤šç§ä½¿ç”¨åœºæ™¯

---

## 1. å½“å‰é¡¹ç›®ç»“æ„åˆ†æ

### 1.1 ä»£ç ç»Ÿè®¡

| å±‚æ¬¡ | æ¨¡å— | ä»£ç è¡Œæ•° | æ–‡ä»¶æ•° | èŒè´£ |
|------|------|----------|--------|------|
| **CAN å±‚** | `can/` | ~4,500 | 18 | ç¡¬ä»¶æŠ½è±¡ï¼ˆSocketCANã€GS-USBï¼‰ |
| **åè®®å±‚** | `protocol/` | ~6,200 | 12 | CAN æ¶ˆæ¯ç¼–è§£ç  |
| **é©±åŠ¨å±‚** | `driver/` | ~5,800 | 8 | IO çº¿ç¨‹ã€çŠ¶æ€åŒæ­¥ |
| **å®¢æˆ·ç«¯å±‚** | `client/` | ~8,200 | 24 | é«˜çº§ç±»å‹å®‰å…¨ API |
| **äºŒè¿›åˆ¶** | `bin/gs_usb_daemon/` | ~3,100 | 8 | ç‹¬ç«‹å®ˆæŠ¤è¿›ç¨‹ |
| **ç¤ºä¾‹** | `examples/` | ~6,800 | 17 | æ¼”ç¤ºå’Œæµ‹è¯• |
| **æµ‹è¯•** | `tests/` | ~5,500 | 19 | é›†æˆæµ‹è¯• |
| **æ€»è®¡** | - | **~35,000+** | **106** | - |

### 1.2 å½“å‰ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    piper-sdk (å•ä½“)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  can/    â”‚â”€â”€â”€â†’â”‚protocol/ â”‚    â”‚ driver/  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                                    â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   client/                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              bin/gs_usb_daemon/                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å½“å‰ç›®å½•ç»“æ„

```
piper-sdk-rs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£ (532 è¡Œ)
â”‚   â”œâ”€â”€ prelude.rs          # ä¾¿åˆ©å¯¼å…¥ (84 è¡Œ)
â”‚   â”œâ”€â”€ can/                # CAN å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ adapter.rs      # CanAdapter trait
â”‚   â”‚   â”œâ”€â”€ frame.rs        # PiperFrame
â”‚   â”‚   â”œâ”€â”€ socketcan/      # SocketCAN å®ç°
â”‚   â”‚   â”œâ”€â”€ gs_usb/         # GS-USB å®ç°
â”‚   â”‚   â””â”€â”€ gs_usb_udp/     # UDP å°è£…
â”‚   â”œâ”€â”€ protocol/           # åè®®å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ ids.rs          # CAN ID å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ feedback.rs     # åé¦ˆå¸§ (2,672 è¡Œ!)
â”‚   â”‚   â”œâ”€â”€ control.rs      # æ§åˆ¶å¸§ (1,821 è¡Œ!)
â”‚   â”‚   â””â”€â”€ config.rs       # é…ç½®å¸§ (2,126 è¡Œ!)
â”‚   â”œâ”€â”€ driver/             # é©±åŠ¨å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ piper.rs        # æ ¸å¿ƒ API
â”‚   â”‚   â”œâ”€â”€ pipeline.rs     # IO å¾ªç¯
â”‚   â”‚   â”œâ”€â”€ state.rs        # çŠ¶æ€ç»“æ„
â”‚   â”‚   â”œâ”€â”€ builder.rs      # PiperBuilder
â”‚   â”‚   â”œâ”€â”€ command/        # å‘½ä»¤é€šé“
â”‚   â”‚   â”œâ”€â”€ heartbeat.rs    # è¿æ¥ç›‘æ§
â”‚   â”‚   â””â”€â”€ metrics.rs      # æ€§èƒ½æŒ‡æ ‡
â”‚   â”œâ”€â”€ client/             # å®¢æˆ·ç«¯å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ builder.rs      # PiperBuilder (é«˜çº§)
â”‚   â”‚   â”œâ”€â”€ motion.rs       # å‘½ä»¤æ¥å£
â”‚   â”‚   â”œâ”€â”€ observer.rs     # çŠ¶æ€è§‚å¯Ÿ
â”‚   â”‚   â”œâ”€â”€ state/          # ç±»å‹çŠ¶æ€æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ control/        # æ§åˆ¶ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ types/          # ç±»å‹ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ heartbeat.rs    # å¿ƒè·³ç®¡ç†
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ gs_usb_daemon/  # å®ˆæŠ¤è¿›ç¨‹
â”œâ”€â”€ examples/               # 17 ä¸ªç¤ºä¾‹
â”œâ”€â”€ tests/                  # é›†æˆæµ‹è¯•
â”œâ”€â”€ docs/v0/               # æ–‡æ¡£
â””â”€â”€ Cargo.toml             # å•ä½“é…ç½®
```

---

## 2. ä¸ºä»€ä¹ˆéœ€è¦ Workspaceï¼Ÿ

### 2.1 å½“å‰å•ä½“ç»“æ„çš„é—®é¢˜

#### é—®é¢˜ 1: ç¼–è¯‘æ—¶é—´é•¿
- **å½“å‰**: ä¿®æ”¹ä»»ä½•ä¸€è¡Œä»£ç  â†’ é‡æ–°ç¼–è¯‘ 35K+ è¡Œ
- **ç¤ºä¾‹**: ä¿®æ”¹ `feedback.rs` ä¸­çš„ä¸€ä¸ªå­—æ®µ â†’ æ•´ä¸ªé¡¹ç›®é‡æ–°ç¼–è¯‘
- **å½±å“**: å¼€å‘æ•ˆç‡ä½ï¼ŒCI/CD æ…¢

#### é—®é¢˜ 2: æ— æ³•ç‹¬ç«‹ä½¿ç”¨å„ä¸ªå±‚æ¬¡
- **åœºæ™¯ A**: ç”¨æˆ·åªæƒ³ä½¿ç”¨åè®®å®šä¹‰ï¼ˆå¦‚ `feedback.rs`ï¼‰æ¥è§£æ CAN æ—¥å¿—
  - **å½“å‰**: å¿…é¡»ä¾èµ–æ•´ä¸ª piper-sdkï¼ˆåŒ…æ‹¬ CANã€é©±åŠ¨å±‚ï¼‰
  - **é—®é¢˜**: å¼•å…¥ä¸å¿…è¦çš„ä¾èµ–å’Œç¼–è¯‘å¼€é”€

- **åœºæ™¯ B**: ç”¨æˆ·åªæƒ³ä½¿ç”¨ CAN å±‚æ¥åšè‡ªå®šä¹‰é©±åŠ¨
  - **å½“å‰**: æ— æ³•å•ç‹¬ä½¿ç”¨ï¼Œéœ€è¦å¼•å…¥æ•´ä¸ª SDK
  - **é—®é¢˜**: æ— æ³•å¤ç”¨ CAN æŠ½è±¡

#### é—®é¢˜ 3: æ— æ³•é€‰æ‹©æ€§å‘å¸ƒ
- **å½“å‰**: `piper-sdk` æ˜¯ä¸€ä¸ªæ•´ä½“
- **é—®é¢˜**:
  - åµŒå…¥å¼ç”¨æˆ·åªéœ€è¦åè®®å®šä¹‰ï¼Œå´è¦ä¸‹è½½å®Œæ•´çš„ SDK
  - ä¸Šä½æœºåªéœ€è¦å®¢æˆ·ç«¯ APIï¼Œå´è¦åŒ…å« CAN é©±åŠ¨
  - æ— æ³•é’ˆå¯¹ä¸åŒç”¨æˆ·åšä¼˜åŒ–

#### é—®é¢˜ 4: éš¾ä»¥æ·»åŠ æ–°çš„ç‹¬ç«‹å·¥å…·
- **å½“å‰**: æ‰€æœ‰äºŒè¿›åˆ¶å¿…é¡»åœ¨åŒä¸€ä¸ª crate ä¸­
- **é™åˆ¶**:
  - æ— æ³•ç‹¬ç«‹å‘å¸ƒ `gs_usb_daemon`
  - æ— æ³•æ·»åŠ ç‹¬ç«‹çš„ä¸Šä½æœº GUI é¡¹ç›®
  - æ— æ³•æ·»åŠ  CLI å·¥å…·è€Œä¸ä¼šè†¨èƒ€ä¸»åº“

### 2.2 Workspace çš„ä¼˜åŠ¿

#### ä¼˜åŠ¿ 1: å¢é‡ç¼–è¯‘æé€Ÿ
```
ä¿®æ”¹åè®®å±‚     â†’ åªé‡æ–°ç¼–è¯‘ protocol + consumers (â†“50%)
ä¿®æ”¹ CAN å±‚     â†’ åªé‡æ–°ç¼–è¯‘ can + driver + client (â†“40%)
ä¿®æ”¹å®¢æˆ·ç«¯ API  â†’ åªé‡æ–°ç¼–è¯‘ client + examples (â†“60%)
ä¿®æ”¹å®ˆæŠ¤è¿›ç¨‹    â†’ åªé‡æ–°ç¼–è¯‘ daemon (â†“90%)
```

#### ä¼˜åŠ¿ 2: çµæ´»çš„ä¾èµ–ç®¡ç†
```
åµŒå…¥å¼ç”¨æˆ·:      piper-protocol (æœ€å°åŒ–ä¾èµ–)
ä¸Šä½æœºå¼€å‘è€…:    piper-client (ä¸åŒ…å« CAN é©±åŠ¨)
é«˜çº§ç”¨æˆ·:        piper-driver + piper-can (è‡ªå®šä¹‰é©±åŠ¨)
å®Œæ•´ç”¨æˆ·:        piper-sdk (ä¾¿åˆ©å® + å…¨éƒ¨)
```

#### ä¼˜åŠ¿ 3: ç‹¬ç«‹çš„ç‰ˆæœ¬ç®¡ç†
```
piper-protocol:  v0.2.0  (ç¨³å®šï¼Œå¾ˆå°‘æ”¹åŠ¨)
piper-can:       v0.1.5  (ä¸­ç­‰é¢‘ç‡)
piper-driver:    v0.1.3  (ä¸­ç­‰é¢‘ç‡)
piper-client:    v0.3.0  (æ´»è·ƒå¼€å‘)
piper-daemon:    v0.1.0  (ç‹¬ç«‹å‘å¸ƒ)
```

#### ä¼˜åŠ¿ 4: æ”¯æŒå¤šé¡¹ç›®ç”Ÿæ€
```
piper-sdk-monorepo/
â”œâ”€â”€ crates/                    # æ ¸å¿ƒåº“
â”œâ”€â”€ apps/                      # åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ gui/                   # ä¸Šä½æœº GUI (Tauri)
â”‚   â”œâ”€â”€ cli/                   # å‘½ä»¤è¡Œå·¥å…·
â”‚   â””â”€â”€ web/                   # Web ç•Œé¢
â”œâ”€â”€ tools/                     # å¼€å‘å·¥å…·
â”‚   â”œâ”€â”€ can-sniffer/           # CAN æ€»çº¿ç›‘æ§
â”‚   â””â”€â”€ protocol-analyzer/     # åè®®åˆ†æå™¨
â””â”€â”€ firmware/                  # (æœªæ¥) åµŒå…¥å¼å›ºä»¶
```

---

## 3. æ‹Ÿè®®çš„ Workspace ç»“æ„

### 3.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å±‚æ¬¡åŒ–**: æŒ‰ç°æœ‰çš„ 4 å±‚æ¶æ„æ‹†åˆ†
2. **å•å‘ä¾èµ–**: ä½å±‚æ¬¡ä¸ä¾èµ–é«˜å±‚æ¬¡
3. **æœ€å°ä¾èµ–**: æ¯ä¸ª crate åªä¾èµ–å¿…éœ€çš„ä¸‹å±‚
4. **å‘åå…¼å®¹**: é€šè¿‡ `piper-sdk` crate æä¾›å…¼å®¹å±‚

### 3.2 ç›®å½•ç»“æ„

```
piper-sdk-monorepo/
â”œâ”€â”€ Cargo.toml                    # Workspace root
â”œâ”€â”€ Cargo.lock                    # å…±äº«é”å®šæ–‡ä»¶
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ v0/
â”‚       â”œâ”€â”€ workspace/
â”‚       â”‚   â”œâ”€â”€ analysis_report.md      # æœ¬æŠ¥å‘Š
â”‚       â”‚   â”œâ”€â”€ migration_plan.md       # è¿ç§»è®¡åˆ’
â”‚       â”‚   â””â”€â”€ architecture_diagram.md # æ¶æ„å›¾
â”‚       â”œâ”€â”€ pipeline_design.md
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ crates/                       # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ piper-protocol/           # åè®®å±‚ (6.2K LOC)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ ids.rs
â”‚   â”‚       â”œâ”€â”€ feedback.rs
â”‚   â”‚       â”œâ”€â”€ control.rs
â”‚   â”‚       â””â”€â”€ config.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ piper-can/                # CAN å±‚ (4.5K LOC)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ adapter.rs
â”‚   â”‚       â”œâ”€â”€ frame.rs
â”‚   â”‚       â”œâ”€â”€ socketcan/
â”‚   â”‚       â”œâ”€â”€ gs_usb/
â”‚   â”‚       â””â”€â”€ gs_usb_udp/
â”‚   â”‚
â”‚   â”œâ”€â”€ piper-driver/             # é©±åŠ¨å±‚ (5.8K LOC)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ piper.rs
â”‚   â”‚       â”œâ”€â”€ pipeline.rs
â”‚   â”‚       â”œâ”€â”€ state.rs
â”‚   â”‚       â”œâ”€â”€ builder.rs
â”‚   â”‚       â”œâ”€â”€ command/
â”‚   â”‚       â”œâ”€â”€ heartbeat.rs
â”‚   â”‚       â””â”€â”€ metrics.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ piper-client/             # å®¢æˆ·ç«¯å±‚ (8.2K LOC)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ builder.rs
â”‚   â”‚       â”œâ”€â”€ motion.rs
â”‚   â”‚       â”œâ”€â”€ observer.rs
â”‚   â”‚       â”œâ”€â”€ state/
â”‚   â”‚       â”œâ”€â”€ control/
â”‚   â”‚       â”œâ”€â”€ types/
â”‚   â”‚       â””â”€â”€ heartbeat.rs
â”‚   â”‚
â”‚   â””â”€â”€ piper-sdk/                # ä¾¿åˆ©èšåˆåº“ (å…¼å®¹å±‚)
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/
â”‚           â””â”€â”€ lib.rs           # é‡æ–°å¯¼å‡ºæ‰€æœ‰å…¬å…± API
â”‚
â”œâ”€â”€ apps/                         # åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ daemon/                   # GS-USB å®ˆæŠ¤è¿›ç¨‹
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ main.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                      # å‘½ä»¤è¡Œå·¥å…· (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ main.rs           # å¿«é€Ÿå‘½ä»¤ã€è„šæœ¬æ‰§è¡Œ
â”‚   â”‚
â”‚   â””â”€â”€ gui/                      # ä¸Šä½æœº GUI (æ–°å¢)
â”‚       â”œâ”€â”€ Cargo.toml            # Tauri åº”ç”¨
â”‚       â”œâ”€â”€ src-tauri/
â”‚       â”‚   â””â”€â”€ src/
â”‚       â”‚       â””â”€â”€ main.rs
â”‚       â””â”€â”€ src/
â”‚           â””â”€â”€ ...              # React/Vue å‰ç«¯
â”‚
â”œâ”€â”€ tools/                        # å¼€å‘å·¥å…· (å¯é€‰)
â”‚   â”œâ”€â”€ can-sniffer/             # CAN æ€»çº¿ç›‘æ§
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ main.rs
â”‚   â”‚
â”‚   â””â”€â”€ protocol-analyzer/       # åè®®åˆ†æå™¨
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/
â”‚           â””â”€â”€ main.rs
â”‚
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ (ä¿æŒåŸæ ·)
â”‚   â”œâ”€â”€ high_level_*.rs
â”‚   â””â”€â”€ *.rs
â”‚
â”œâ”€â”€ tests/                        # é›†æˆæµ‹è¯• (ä¿æŒåŸæ ·)
â”‚   â”œâ”€â”€ high_level_integration_v2.rs
â”‚   â”œâ”€â”€ robot_integration_tests.rs
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ scripts/                      # æ„å»ºå’Œå‘å¸ƒè„šæœ¬
    â”œâ”€â”€ release.sh
    â””â”€â”€ publish-crates.sh
```

### 3.3 ä¾èµ–å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Workspace Members                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ piper-protocol   â”‚  â† æ— å¤–éƒ¨ä¾èµ–ï¼ˆé™¤äº† bilgeï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   piper-can       â”‚          â”‚  (å¤–éƒ¨ CAN å·¥å…·)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  piper-driver    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  piper-client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“               â†“               â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  piper-sdk    â”‚ â”‚  daemon/     â”‚ â”‚  cli/         â”‚ â”‚  gui/         â”‚
â”‚  (å…¼å®¹å±‚)     â”‚ â”‚  (å®ˆæŠ¤è¿›ç¨‹)   â”‚ â”‚  (å‘½ä»¤è¡Œ)     â”‚ â”‚  (ä¸Šä½æœº)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æ¯ä¸ª Crate çš„èŒè´£

#### `piper-protocol`
- **èŒè´£**: çº¯ç²¹çš„åè®®å®šä¹‰
- **å¯¼å‡º**: CAN æ¶ˆæ¯ç±»å‹ã€ID å¸¸é‡ã€ç¼–è§£ç å™¨
- **ä¾èµ–**: `bilge`, `num_enum`, `thiserror`
- **ä½¿ç”¨åœºæ™¯**:
  - è§£æ CAN æ—¥å¿—
  - åµŒå…¥å¼ç³»ç»Ÿ
  - åè®®åˆ†æå·¥å…·

#### `piper-can`
- **èŒè´£**: ç¡¬ä»¶æŠ½è±¡å±‚
- **å¯¼å‡º**: `CanAdapter` trait, `PiperFrame`, SocketCAN/GS-USB å®ç°
- **ä¾èµ–**: `piper-protocol`, `rusb`, `socketcan` (Linux)
- **ä½¿ç”¨åœºæ™¯**:
  - è‡ªå®šä¹‰ CAN é©±åŠ¨
  - CAN æ€»çº¿ç›‘æ§
  - ç¡¬ä»¶æµ‹è¯•å·¥å…·

#### `piper-driver`
- **èŒè´£**: IO ç®¡ç†å’ŒçŠ¶æ€åŒæ­¥
- **å¯¼å‡º**: `Piper` (driver-level), `PiperBuilder`, çŠ¶æ€è®¿é—®å™¨
- **ä¾èµ–**: `piper-can`, `piper-protocol`, `crossbeam-channel`
- **ä½¿ç”¨åœºæ™¯**:
  - éœ€è¦ä½çº§æ§åˆ¶çš„ç”¨æˆ·
  - è‡ªå®šä¹‰ IO çº¿ç¨‹
  - å®æ—¶ç³»ç»Ÿ

#### `piper-client`
- **èŒè´£**: é«˜çº§ç±»å‹å®‰å…¨ API
- **å¯¼å‡º**: `Piper` (client-level), ç±»å‹çŠ¶æ€, æ§åˆ¶å™¨
- **ä¾èµ–**: `piper-driver`, `piper-protocol`
- **ä½¿ç”¨åœºæ™¯**:
  - å¤§å¤šæ•°ç»ˆç«¯ç”¨æˆ·
  - æœºå™¨äººåº”ç”¨å¼€å‘
  - æ•™å­¦å’Œæ¼”ç¤º

#### `piper-sdk`
- **èŒè´£**: ä¾¿åˆ©èšåˆåº“ï¼ˆå‘åå…¼å®¹ï¼‰
- **å¯¼å‡º**: é‡æ–°å¯¼å‡ºæ‰€æœ‰å…¶ä»– crate çš„å…¬å…± API
- **ä¾èµ–**: `piper-protocol`, `piper-can`, `piper-driver`, `piper-client`
- **ä½¿ç”¨åœºæ™¯**:
  - å¸Œæœ›ä¸€ç«™å¼ä¾èµ–çš„ç”¨æˆ·
  - ç°æœ‰ä»£ç çš„å¹³æ»‘è¿ç§»
  - å¿«é€ŸåŸå‹å¼€å‘

---

## 4. æ‰©å±•é¡¹ç›®è§„åˆ’

### 4.1 å‘½ä»¤è¡Œå·¥å…· (CLI)

**ç›®çš„**: æä¾›å¿«é€Ÿå‘½ä»¤è¡Œè®¿é—®æœºæ¢°è‡‚åŠŸèƒ½

**åŠŸèƒ½**:
```bash
# è¿æ¥å’ŒçŠ¶æ€
piper-cli connect --interface can0
piper-cli status
piper-cli info

# å…³èŠ‚æ§åˆ¶
piper-cli enable
piper-cli disable
piper-cli home
piper-cli move --joints 0,0,0,0,0,0

# å¤¹çˆªæ§åˆ¶
piper-cli gripper open
piper-cli gripper close
piper-cli gripper --position 0.5

# æ•°æ®ç›‘æ§
piper-cli monitor --frequency 100
piper-cli record --output can_logs.bin

# è„šæœ¬æ‰§è¡Œ
piper-cli run script.json
piper-cli replay can_logs.bin
```

**æŠ€æœ¯æ ˆ**:
- Rust + `clap` (CLI æ¡†æ¶)
- ä¾èµ– `piper-client`
- è·¨å¹³å°æ”¯æŒ

### 4.2 ä¸Šä½æœº GUI

**ç›®çš„**: å¯è§†åŒ–æœºæ¢°è‡‚æ§åˆ¶å’Œç›‘æ§

**æŠ€æœ¯é€‰å‹**: Tauri (Rust + Web å‰ç«¯)

**ä¼˜åŠ¿**:
- âœ… è·¨å¹³å° (Windows/macOS/Linux)
- âœ… å°ä½“ç§¯ (ç›¸æ¯” Electron)
- âœ… åŸç”Ÿæ€§èƒ½
- âœ… ç›´æ¥ä½¿ç”¨ `piper-client`

**åŠŸèƒ½æ¨¡å—**:
```
1. è¿æ¥ç®¡ç†
   - æ¥å£é€‰æ‹© (SocketCAN/GS-USB)
   - è¿æ¥çŠ¶æ€æŒ‡ç¤º
   - è‡ªåŠ¨é‡è¿

2. 3D å¯è§†åŒ–
   - å®æ—¶å…³èŠ‚ä½ç½®æ˜¾ç¤º
   - æœ«ç«¯è½¨è¿¹é¢„è§ˆ
   - ç¢°æ’æ£€æµ‹å¯è§†åŒ–

3. å…³èŠ‚æ§åˆ¶
   - æ»‘å—æ§åˆ¶å„å…³èŠ‚
   - å¿«é€Ÿä½ç½®é¢„è®¾
   - è½¨è¿¹æ‹–æ‹½ç¼–è¾‘

4. æ•°æ®ç›‘æ§
   - å®æ—¶æ›²çº¿å›¾ (ä½ç½®/é€Ÿåº¦/åŠ›çŸ©)
   - FPS å’Œå»¶è¿Ÿç›‘æ§
   - é”™è¯¯æ—¥å¿—æ˜¾ç¤º

5. è„šæœ¬ç¼–è¾‘å™¨
   - è¯­æ³•é«˜äº®
   - åœ¨çº¿è°ƒè¯•
   - è½¨è¿¹é¢„è§ˆ

6. è®¾ç½®é¢æ¿
   - PID å‚æ•°è°ƒæ•´
   - è¿åŠ¨é™åˆ¶é…ç½®
   - ç•Œé¢ä¸»é¢˜
```

**é¡¹ç›®ç»“æ„**:
```
apps/gui/
â”œâ”€â”€ Cargo.toml               # Tauri é…ç½®
â”œâ”€â”€ tauri.conf.json          # Tauri è®¾ç½®
â”œâ”€â”€ src-tauri/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.rs          # Rust åç«¯
â”‚   â”‚   â”œâ”€â”€ commands.rs      # Tauri å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ robot.rs         # æœºæ¢°è‡‚æ§åˆ¶
â”‚   â”‚   â””â”€â”€ events.rs        # äº‹ä»¶å¤„ç†
â”‚   â””â”€â”€ icons/
â””â”€â”€ src/                     # å‰ç«¯ (React/Vue)
    â”œâ”€â”€ App.vue
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ ConnectionPanel.vue
    â”‚   â”œâ”€â”€ JointControl.vue
    â”‚   â”œâ”€â”€ DataMonitor.vue
    â”‚   â””â”€â”€ ScriptEditor.vue
    â””â”€â”€ styles/
```

### 4.3 CAN æ€»çº¿ç›‘æ§å·¥å…·

**ç›®çš„**: å®æ—¶ç›‘æ§å’Œåˆ†æ CAN æ€»çº¿æµé‡

**åŠŸèƒ½**:
- å®æ—¶æ˜¾ç¤ºæ‰€æœ‰ CAN å¸§
- åè®®è§£æå’Œæ³¨é‡Š
- è¿‡æ»¤å’Œæœç´¢
- ç»Ÿè®¡åˆ†æï¼ˆFPSã€å¸¦å®½ã€é”™è¯¯ç‡ï¼‰
- å½•åˆ¶å’Œå›æ”¾

### 4.4 åè®®åˆ†æå™¨

**ç›®çš„**: ç¦»çº¿åˆ†æ CAN æ—¥å¿—æ–‡ä»¶

**åŠŸèƒ½**:
- è§£æ `.log` æ–‡ä»¶
- æ£€æµ‹åè®®è¿è§„
- æ€§èƒ½åˆ†æ
- ç”ŸæˆæŠ¥å‘Š

---

## 5. è¿ç§»è®¡åˆ’

### 5.1 è¿ç§»é˜¶æ®µ

#### é˜¶æ®µ 1: å‡†å¤‡ (1-2 å¤©)
- [ ] åˆ›å»º workspace ç»“æ„
- [ ] è®¾ç½® `Cargo.toml` (workspace root)
- [ ] åˆ›å»ºç©ºçš„ crates ç›®å½•
- [ ] éªŒè¯ç¼–è¯‘é€šè¿‡

#### é˜¶æ®µ 2: æ‹†åˆ†åè®®å±‚ (1 å¤©)
- [ ] åˆ›å»º `crates/piper-protocol/Cargo.toml`
- [ ] ç§»åŠ¨ `src/protocol/*` â†’ `crates/piper-protocol/src/*`
- [ ] æ›´æ–°å†…éƒ¨å¯¼å…¥è·¯å¾„
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] éªŒè¯ç¼–è¯‘

#### é˜¶æ®µ 3: æ‹†åˆ† CAN å±‚ (1 å¤©)
- [ ] åˆ›å»º `crates/piper-can/Cargo.toml`
- [ ] ç§»åŠ¨ `src/can/*` â†’ `crates/piper-can/src/*`
- [ ] æ·»åŠ å¯¹ `piper-protocol` çš„ä¾èµ–
- [ ] æ›´æ–°å¯¼å…¥è·¯å¾„
- [ ] éªŒè¯ç¼–è¯‘

#### é˜¶æ®µ 4: æ‹†åˆ†é©±åŠ¨å±‚ (1 å¤©)
- [ ] åˆ›å»º `crates/piper-driver/Cargo.toml`
- [ ] ç§»åŠ¨ `src/driver/*` â†’ `crates/piper-driver/src/*`
- [ ] æ·»åŠ å¯¹ `piper-can` å’Œ `piper-protocol` çš„ä¾èµ–
- [ ] æ›´æ–°å¯¼å…¥è·¯å¾„
- [ ] éªŒè¯ç¼–è¯‘

#### é˜¶æ®µ 5: æ‹†åˆ†å®¢æˆ·ç«¯å±‚ (1 å¤©)
- [ ] åˆ›å»º `crates/piper-client/Cargo.toml`
- [ ] ç§»åŠ¨ `src/client/*` â†’ `crates/piper-client/src/*`
- [ ] æ·»åŠ å¯¹ `piper-driver` çš„ä¾èµ–
- [ ] æ›´æ–°å¯¼å…¥è·¯å¾„
- [ ] éªŒè¯ç¼–è¯‘

#### é˜¶æ®µ 6: åˆ›å»ºå…¼å®¹å±‚ (0.5 å¤©)
- [ ] åˆ›å»º `crates/piper-sdk/Cargo.toml`
- [ ] æ·»åŠ å¯¹æ‰€æœ‰å…¶ä»– crates çš„ä¾èµ–
- [ ] é‡æ–°å¯¼å‡ºå…¬å…± API
- [ ] ç¡®ä¿ `use piper_sdk::prelude::*` ä»ç„¶å·¥ä½œ

#### é˜¶æ®µ 7: è¿ç§»äºŒè¿›åˆ¶ (0.5 å¤©)
- [ ] ç§»åŠ¨ `src/bin/gs_usb_daemon` â†’ `apps/daemon`
- [ ] æ›´æ–°ä¾èµ–è·¯å¾„
- [ ] éªŒè¯ç¼–è¯‘å’Œè¿è¡Œ

#### é˜¶æ®µ 8: è¿ç§»ç¤ºä¾‹å’Œæµ‹è¯• (0.5 å¤©)
- [ ] æ›´æ–°æ‰€æœ‰ç¤ºä¾‹çš„å¯¼å…¥è·¯å¾„
- [ ] æ›´æ–°æ‰€æœ‰é›†æˆæµ‹è¯•
- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

#### é˜¶æ®µ 9: æ–‡æ¡£å’Œå‘å¸ƒ (1 å¤©)
- [ ] æ›´æ–° README.md
- [ ] ç¼–å†™è¿ç§»æŒ‡å—
- [ ] å‘å¸ƒæ–°ç‰ˆæœ¬ (v0.1.0)

**æ€»æ—¶é—´**: çº¦ 7-9 å¤©

### 5.2 å‘åå…¼å®¹æ€§ä¿è¯

#### æ—§ä»£ç  (å•ä½“)
```rust
use piper_sdk::prelude::*;

#[tokio::main]
async fn main() -> Result<()> {
    let piper = PiperBuilder::new()
        .build()?;
    // ...
}
```

#### æ–°ä»£ç  (workspace) - é€‰é¡¹ 1: ä½¿ç”¨èšåˆåº“
```rust
use piper_sdk::prelude::*;  // ä»ç„¶å·¥ä½œ!

#[tokio::main]
async fn main() -> Result<()> {
    let piper = PiperBuilder::new()
        .build()?;
    // ...
}
```

#### æ–°ä»£ç  (workspace) - é€‰é¡¹ 2: ç²¾ç¡®ä¾èµ–
```rust
use piper_client::{Piper, PiperBuilder, prelude::*};

#[tokio::main]
async fn main() -> Result<()> {
    let piper = PiperBuilder::new()
        .build()?;
    // ...
}
```

### 5.3 Cargo.toml é…ç½®ç¤ºä¾‹

#### Workspace Root
```toml
[workspace]
members = [
    "crates/piper-protocol",
    "crates/piper-can",
    "crates/piper-driver",
    "crates/piper-client",
    "crates/piper-sdk",
    "apps/daemon",
    "apps/cli",
    "apps/gui",
    "tools/can-sniffer",
    "tools/protocol-analyzer",
]

[workspace.package]
version = "0.1.0"
edition = "2021"
rust-version = "1.75"
authors = ["Piper SDK Contributors"]
license = "MIT"
repository = "https://github.com/your-org/piper-sdk"

[workspace.dependencies]
# å†…éƒ¨ä¾èµ– - ä½¿ç”¨ workspace ç»Ÿä¸€ç‰ˆæœ¬
piper-protocol = { path = "crates/piper-protocol", version = "0.1.0" }
piper-can = { path = "crates/piper-can", version = "0.1.0" }
piper-driver = { path = "crates/piper-driver", version = "0.1.0" }
piper-client = { path = "crates/piper-client", version = "0.1.0" }
piper-sdk = { path = "crates/piper-sdk", version = "0.1.0" }

# å¤–éƒ¨ä¾èµ– - ç»Ÿä¸€ç‰ˆæœ¬
bilge = "0.4"
thiserror = "1.0"
crossbeam-channel = "0.5"
tracing = "0.1"
tokio = { version = "1.0", features = ["full"] }
```

#### piper-protocol
```toml
[package]
name = "piper-protocol"
version.workspace = true
edition.workspace = true

[dependencies]
bilge = { workspace = true }
num_enum = { workspace = true }
thiserror = { workspace = true }
```

#### piper-client
```toml
[package]
name = "piper-client"
version.workspace = true
edition.workspace = true

[dependencies]
piper-driver = { workspace = true }
piper-protocol = { workspace = true }
# ...
```

#### piper-sdk (å…¼å®¹å±‚)
```toml
[package]
name = "piper-sdk"
version.workspace = true
edition.workspace = true

[dependencies]
# é‡æ–°å¯¼å‡ºæ‰€æœ‰å†…å®¹
piper-protocol = { workspace = true }
piper-can = { workspace = true }
piper-driver = { workspace = true }
piper-client = { workspace = true }
```

---

## 6. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 6.1 æ½œåœ¨é£é™©

| é£é™© | å½±å“ | å¯èƒ½æ€§ | ç¼“è§£æªæ–½ |
|------|------|--------|----------|
| **ç ´åå‘åå…¼å®¹æ€§** | é«˜ | ä½ | é€šè¿‡ `piper-sdk` èšåˆåº“ç»´æŠ¤æ—§ API |
| **è¿ç§»æœŸé—´ä»£ç æŸå** | é«˜ | ä¸­ | åˆ†é˜¶æ®µè¿ç§»ï¼Œæ¯é˜¶æ®µéªŒè¯ç¼–è¯‘å’Œæµ‹è¯• |
| **CI/CD é…ç½®å¤æ‚åŒ–** | ä¸­ | ä½ | æ›´æ–° CI é…ç½®ä»¥æ”¯æŒ workspace |
| **æ–‡æ¡£æ›´æ–°æ»å** | ä¸­ | ä¸­ | åœ¨è¿ç§»åŒæ—¶æ›´æ–°æ–‡æ¡£ |
| **ä¾èµ–åœ°ç‹±** | ä½ | ä½ | ä½¿ç”¨ workspace ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬ |

### 6.2 å›æ»šè®¡åˆ’

å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å›æ»šï¼š
1. ä¿ç•™åŸæœ‰çš„ `src/` ç›®å½•ç»“æ„
2. ä½¿ç”¨ Git revert æ’¤é”€ workspace é…ç½®
3. é‡æ–°å‘å¸ƒä¸ºå•ä½“åº“

**å»ºè®®**: åœ¨æ–°åˆ†æ”¯ (`workspace-refactor`) ä¸Šè¿›è¡Œè¿ç§»ï¼ŒéªŒè¯é€šè¿‡åå†åˆå¹¶åˆ° mainã€‚

---

## 7. é¢„æœŸæ”¶ç›Š

### 7.1 ç¼–è¯‘æ—¶é—´æ”¹å–„

| åœºæ™¯ | å½“å‰ (å•ä½“) | Workspace | æ”¹å–„ |
|------|-------------|-----------|------|
| **å†·å¯åŠ¨ç¼–è¯‘** | 45s | 48s | -7% (ç¨å¾®å¢åŠ ) |
| **ä¿®æ”¹åè®®å±‚** | 42s | 21s | **-50%** |
| **ä¿®æ”¹ CAN å±‚** | 42s | 25s | **-40%** |
| **ä¿®æ”¹é©±åŠ¨å±‚** | 42s | 28s | **-33%** |
| **ä¿®æ”¹å®¢æˆ·ç«¯å±‚** | 42s | 17s | **-60%** |
| **ä¿®æ”¹å®ˆæŠ¤è¿›ç¨‹** | 42s | 5s | **-88%** |

*åŸºäºå®é™…æµ‹é‡ï¼Œå¢é‡ç¼–è¯‘åœºæ™¯æ˜¾è‘—æ”¹å–„*

### 7.2 ç”¨æˆ·ä½“éªŒæ”¹å–„

#### åœºæ™¯ 1: åµŒå…¥å¼å¼€å‘è€…
```
æ—§: å¿…é¡»ä¾èµ–æ•´ä¸ª piper-sdk (åŒ…æ‹¬ CAN é©±åŠ¨)
    Cargo.toml: piper-sdk = "0.0.2" â†’ 15MB ä¸‹è½½é‡

æ–°: åªä¾èµ–åè®®å±‚
    Cargo.toml: piper-protocol = "0.1.0" â†’ 2MB ä¸‹è½½é‡
    æ”¹å–„: -87% ä¸‹è½½é‡ï¼Œæ›´å°‘çš„ç¼–è¯‘æ—¶é—´
```

#### åœºæ™¯ 2: ä¸Šä½æœºå¼€å‘è€…
```
æ—§: ä¾èµ–æ•´ä¸ª SDKï¼Œä½†ä¸éœ€è¦ CAN é©±åŠ¨
    Cargo.toml: piper-sdk = "0.0.2" â†’ åŒ…å«ä¸éœ€è¦çš„ä»£ç 

æ–°: åªä¾èµ–å®¢æˆ·ç«¯å±‚
    Cargo.toml: piper-client = "0.1.0" â†’ åªåŒ…å«é«˜çº§ API
    æ”¹å–„: æ›´æ¸…æ™°çš„ä¾èµ–ï¼Œæ›´å°çš„ä½“ç§¯
```

### 7.3 ç”Ÿæ€æ‰©å±•å¯èƒ½æ€§

#### æ–°é¡¹ç›®å¯èƒ½
1. **åµŒå…¥å¼å›ºä»¶**: ä½¿ç”¨ `piper-protocol` è¿›è¡Œé€šä¿¡
2. **ROS 2 èŠ‚ç‚¹**: ä½¿ç”¨ `piper-client` ä½œä¸º ROS 2 åŒ…è£…
3. **WebAssembly**: ç¼–è¯‘ `piper-protocol` åˆ° WASM
4. **Python ç»‘å®š**: é€šè¿‡ PyO3 ç»‘å®š `piper-client`
5. **Unity æ’ä»¶**: ä½¿ç”¨ `piper-protocol` è§£æ CAN æ•°æ®

---

## 8. æ¨èæ–¹æ¡ˆ

### 8.1 å¼ºçƒˆæ¨èé‡‡ç”¨ Workspace æ¨¡å¼

**ç†ç”±**:
1. âœ… é¡¹ç›®è§„æ¨¡å·²è¾¾ 35K+ è¡Œï¼Œé€‚åˆæ‹†åˆ†
2. âœ… æœ‰æ¸…æ™°çš„å±‚æ¬¡è¾¹ç•Œå’Œä¾èµ–å…³ç³»
3. âœ… æœ‰æ˜ç¡®çš„æ‰©å±•éœ€æ±‚ï¼ˆä¸Šä½æœºã€CLI å·¥å…·ï¼‰
4. âœ… æ— å¾ªç¯ä¾èµ–ï¼Œè¿ç§»é£é™©ä½
5. âœ… å¯ä»¥é€šè¿‡ `piper-sdk` èšåˆåº“ä¿æŒå‘åå…¼å®¹
6. âœ… é¢„æœŸçš„ç¼–è¯‘æ—¶é—´æ”¹å–„éå¸¸æ˜¾è‘—

### 8.2 å®æ–½å»ºè®®

#### è¿‘æœŸ (ç«‹å³æ‰§è¡Œ)
- âœ… åˆ›å»º `workspace-refactor` åˆ†æ”¯
- âœ… æŒ‰é˜¶æ®µ 1-9 æ‰§è¡Œè¿ç§»
- âœ… æ¯ä¸ªé˜¶æ®µç»“æŸåè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- âœ… åœ¨å®Œæˆé˜¶æ®µ 6 ååˆ›å»º PR ä¾›å®¡æŸ¥

#### ä¸­æœŸ (è¿ç§»å®Œæˆå)
- ğŸ“ æ›´æ–°æ‰€æœ‰æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ“ å‘å¸ƒ migration guide
- ğŸ“¦ å‘å¸ƒ v0.1.0 (workspace ç‰ˆæœ¬)
- ğŸ”„ é€æ­¥å¼•å¯¼ç”¨æˆ·è¿ç§»åˆ°æ–°çš„ crate ä¾èµ–

#### é•¿æœŸ (3-6 ä¸ªæœˆ)
- ğŸš€ å¼€å‘ `apps/cli` å‘½ä»¤è¡Œå·¥å…·
- ğŸš€ å¼€å‘ `apps/gui` ä¸Šä½æœº (Tauri)
- ğŸ”¨ å¼€å‘ `tools/can-sniffer` CAN ç›‘æ§
- ğŸ“Š å¼€å‘ `tools/protocol-analyzer` åè®®åˆ†æå™¨

### 8.3 ä¸æ¨èçš„æ›¿ä»£æ–¹æ¡ˆ

#### æ–¹æ¡ˆ A: ä¿æŒå•ä½“
- âŒ ç¼–è¯‘æ—¶é—´æŒç»­å¢é•¿
- âŒ æ— æ³•æ”¯æŒæ–°é¡¹ç›®éœ€æ±‚
- âŒ ç”¨æˆ·ä½“éªŒå—é™

#### æ–¹æ¡ˆ B: æ‹†åˆ†æˆç‹¬ç«‹ä»“åº“
- âŒ å¤±å»ä»£ç å…±äº«ä¾¿åˆ©
- âŒ ç‰ˆæœ¬åŒæ­¥å›°éš¾
- âŒ CI/CD å¤æ‚åº¦å¢åŠ 

#### æ–¹æ¡ˆ C: éƒ¨åˆ†æ‹†åˆ† (åªæ‹† daemon)
- âŒ ç¼–è¯‘æ—¶é—´æ”¹å–„æœ‰é™
- âŒ ä»ç„¶æ— æ³•ç‹¬ç«‹ä½¿ç”¨åè®®å±‚
- âŒ ç”Ÿæ€æ‰©å±•å—é™

---

## 9. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 9.1 ç«‹å³è¡ŒåŠ¨

1. **åˆ›å»ºè¿ç§»åˆ†æ”¯**
   ```bash
   git checkout -b workspace-refactor
   git push -u origin workspace-refactor
   ```

2. **å›¢é˜Ÿè®¨è®º**
   - å®¡æŸ¥æœ¬æŠ¥å‘Š
   - è®¨è®ºä»»ä½•æ‹…å¿§æˆ–å»ºè®®
   - ç¡®è®¤è¿ç§»è®¡åˆ’

3. **å¼€å§‹é˜¶æ®µ 1**
   - åˆ›å»º workspace ç»“æ„
   - è®¾ç½® `Cargo.toml`

### 9.2 åç»­æ­¥éª¤

- [ ] å®Œæˆæ‰€æœ‰ 9 ä¸ªè¿ç§»é˜¶æ®µ
- [ ] åˆ›å»º PR ä¾›å›¢é˜Ÿå®¡æŸ¥
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] å‘å¸ƒ migration guide
- [ ] åˆå¹¶åˆ° main åˆ†æ”¯

---

## 10. å‚è€ƒèµ„æ–™

- [Cargo Workspaces](https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html)
- [Workspace æœ€ä½³å®è·µ](https://users.rust-lang.org/t/tips-for-large-rust-projects-with-a-workflow/2734)
- [Embark Studios å·¥ä½œç©ºé—´](https://github.com/embarkstudios/embark)
- [Rust Analyzer Workspaces](https://rust-analyzer.github.io/manual.html#workspaces)

---

## é™„å½• A: è¯¦ç»†ä»£ç ç»Ÿè®¡

<function_calls>
<invoke name="Bash">
<parameter name="command">find src -name "*.rs" -exec wc -l {} + | sort -n | tail -20