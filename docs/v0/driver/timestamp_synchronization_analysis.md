# çŠ¶æ€æ—¶é—´æˆ³åŒæ­¥æ€§åˆ†ææŠ¥å‘Š

## 1. æ¦‚è¿°

ç”±äº `MotionState`ã€`DiagnosticState`ã€`ConfigState` ä¸­çš„å­—æ®µæ¥è‡ªä¸åŒçš„ CAN å¸§ï¼Œæ¯ä¸ª CAN å¸§éƒ½æœ‰è‡ªå·±çš„ç¡¬ä»¶æ—¶é—´æˆ³ï¼ˆ`PiperFrame.timestamp_us`ï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´**æ—¶é—´ä¸åŒæ­¥**çš„é—®é¢˜ã€‚

æœ¬æŠ¥å‘Šåˆ†æï¼š
1. **é—®é¢˜åˆ†æ**ï¼šä¸åŒå­—æ®µçš„æ—¶é—´æˆ³æ¥æºå·®å¼‚
2. **å½±å“è¯„ä¼°**ï¼šæ—¶é—´ä¸åŒæ­¥å¯¹åŠ›æ§ç®—æ³•çš„å½±å“
3. **è§£å†³æ–¹æ¡ˆ**ï¼šæ˜¯å¦éœ€è¦æ‹†åˆ†çŠ¶æ€ï¼Œå¦‚ä½•æ‹†åˆ†
4. **è®¾è®¡å»ºè®®**ï¼šæœ€ä¼˜çš„çŠ¶æ€ç»„ç»‡æ–¹å¼

## 2. é—®é¢˜åˆ†æï¼šæ—¶é—´æˆ³æ¥æºå·®å¼‚

### 2.1. MotionState å­—æ®µçš„æ—¶é—´æˆ³æ¥æº

| å­—æ®µç»„ | CAN å¸§ ID | å¸§æ•°é‡ | æ—¶é—´æˆ³ç‰¹æ€§ | åŒæ­¥æ€§ |
|--------|-----------|--------|-----------|--------|
| **å…³èŠ‚ä½ç½®** | 0x2A5, 0x2A6, 0x2A7 | 3 å¸§ | å¸§ç»„ï¼Œå¯èƒ½æœ‰å¾®å°å»¶è¿Ÿï¼ˆ<1msï¼‰ | âš ï¸ æ¥è¿‘åŒæ­¥ |
| **å…³èŠ‚é€Ÿåº¦** | 0x251~0x256 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œæ¯ä¸ªå…³èŠ‚ä¸€å¸§ | âŒ å¯èƒ½ä¸åŒæ­¥ï¼ˆå»¶è¿Ÿå¯è¾¾æ•°æ¯«ç§’ï¼‰ |
| **å…³èŠ‚ç”µæµ** | 0x251~0x256 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œä¸é€Ÿåº¦åŒå¸§ | âš ï¸ ä¸é€Ÿåº¦åŒæ­¥ï¼Œä½†ä¸å…¶ä»–å­—æ®µä¸åŒæ­¥ |
| **æœ«ç«¯ä½å§¿** | 0x2A2, 0x2A3, 0x2A4 | 3 å¸§ | å¸§ç»„ï¼Œå¯èƒ½æœ‰å¾®å°å»¶è¿Ÿï¼ˆ<1msï¼‰ | âš ï¸ æ¥è¿‘åŒæ­¥ |
| **å¤¹çˆªæ•°æ®** | 0x2A8 | 1 å¸§ | ç‹¬ç«‹å¸§ | âŒ ä¸å…¶ä»–å­—æ®µä¸åŒæ­¥ |
| **æ§åˆ¶çŠ¶æ€** | 0x2A1 | 1 å¸§ | ç‹¬ç«‹å¸§ï¼Œæ›´æ–°é¢‘ç‡å¯èƒ½ä¸åŒ | âŒ ä¸å…¶ä»–å­—æ®µä¸åŒæ­¥ |

**å…³é”®é—®é¢˜**ï¼š
1. **å¸§ç»„å†…éƒ¨**ï¼ˆå¦‚ 0x2A5, 0x2A6, 0x2A7ï¼‰å¯èƒ½æœ‰å¾®ç§’çº§å»¶è¿Ÿï¼Œä½†é€šå¸¸åœ¨ 1ms ä»¥å†…ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯"å‡†åŒæ­¥"çš„
2. **å¸§ç»„ä¹‹é—´**ï¼ˆå¦‚å…³èŠ‚ä½ç½®ç»„ vs å…³èŠ‚é€Ÿåº¦ç»„ï¼‰å¯èƒ½æœ‰æ¯«ç§’çº§å»¶è¿Ÿï¼ˆå–å†³äº CAN æ€»çº¿çš„ä¼˜å…ˆçº§å’Œè´Ÿè½½ï¼‰
3. **ä¸åŒæ›´æ–°é¢‘ç‡**ï¼šæŸäº›å¸§ï¼ˆå¦‚ 0x2A1 æ§åˆ¶çŠ¶æ€ï¼‰çš„æ›´æ–°é¢‘ç‡å¯èƒ½ä½äºå…¶ä»–å¸§

### 2.2. DiagnosticState å­—æ®µçš„æ—¶é—´æˆ³æ¥æº

| å­—æ®µç»„ | CAN å¸§ ID | å¸§æ•°é‡ | æ—¶é—´æˆ³ç‰¹æ€§ | åŒæ­¥æ€§ |
|--------|-----------|--------|-----------|--------|
| **ç”µæœºæ¸©åº¦** | 0x261~0x266 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œæ¯ä¸ªå…³èŠ‚ä¸€å¸§ | âŒ å¯èƒ½ä¸åŒæ­¥ |
| **é©±åŠ¨å™¨æ¸©åº¦** | 0x261~0x266 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œä¸ç”µæœºæ¸©åº¦åŒå¸§ | âš ï¸ ä¸ç”µæœºæ¸©åº¦åŒæ­¥ |
| **å…³èŠ‚ç”µå‹** | 0x261~0x266 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œä¸æ¸©åº¦åŒå¸§ | âš ï¸ ä¸æ¸©åº¦åŒæ­¥ |
| **å…³èŠ‚ç”µæµ** | 0x261~0x266 | 6 å¸§ | ç‹¬ç«‹å¸§ï¼Œä¸æ¸©åº¦åŒå¸§ | âš ï¸ ä¸æ¸©åº¦åŒæ­¥ |
| **ä¿æŠ¤ç­‰çº§** | 0x47B | 1 å¸§ | é…ç½®åé¦ˆå¸§ï¼Œæ›´æ–°é¢‘ç‡ä½ | âŒ ä¸å…¶ä»–å­—æ®µä¸åŒæ­¥ |

**å…³é”®é—®é¢˜**ï¼š
1. **ä½é€Ÿåé¦ˆå¸§**ï¼ˆ0x261~0x266ï¼‰æ›´æ–°é¢‘ç‡ä½ï¼ˆå¯èƒ½ 10Hzï¼‰ï¼Œä¸è¿åŠ¨æ•°æ®ï¼ˆ1kHzï¼‰ä¸åŒæ­¥
2. **é…ç½®åé¦ˆå¸§**ï¼ˆ0x47Bï¼‰æ›´æ–°é¢‘ç‡æä½ï¼ˆä»…åœ¨é…ç½®å˜æ›´æ—¶ï¼‰ï¼Œä¸å…¶ä»–å­—æ®µå®Œå…¨ä¸åŒæ­¥

### 2.3. ConfigState å­—æ®µçš„æ—¶é—´æˆ³æ¥æº

| å­—æ®µç»„ | CAN å¸§ ID | å¸§æ•°é‡ | æ—¶é—´æˆ³ç‰¹æ€§ | åŒæ­¥æ€§ |
|--------|-----------|--------|-----------|--------|
| **å…³èŠ‚é™åˆ¶** | 0x473 | 1 å¸§/å…³èŠ‚ | é…ç½®åé¦ˆå¸§ï¼Œéœ€è¦æŸ¥è¯¢ 6 æ¬¡ | âŒ æŸ¥è¯¢å“åº”å»¶è¿Ÿï¼Œä¸åŒæ­¥ |
| **åŠ é€Ÿåº¦é™åˆ¶** | 0x47C | 1 å¸§/å…³èŠ‚ | é…ç½®åé¦ˆå¸§ï¼Œéœ€è¦æŸ¥è¯¢ 6 æ¬¡ | âŒ æŸ¥è¯¢å“åº”å»¶è¿Ÿï¼Œä¸åŒæ­¥ |
| **æœ«ç«¯å‚æ•°** | 0x478 | 1 å¸§ | é…ç½®åé¦ˆå¸§ï¼Œæ›´æ–°é¢‘ç‡ä½ | âŒ ä¸å…¶ä»–å­—æ®µä¸åŒæ­¥ |

**å…³é”®é—®é¢˜**ï¼š
1. **é…ç½®åé¦ˆå¸§**éƒ½æ˜¯**æŒ‰éœ€æŸ¥è¯¢**çš„ï¼Œä¸æ˜¯å‘¨æœŸæ€§åé¦ˆ
2. æŸ¥è¯¢å“åº”å¯èƒ½æœ‰**æ•°æ¯«ç§’åˆ°æ•°ç™¾æ¯«ç§’**çš„å»¶è¿Ÿ
3. è¿™äº›æ•°æ®**å‡ ä¹ä¸å˜**ï¼Œä¸éœ€è¦å®æ—¶åŒæ­¥

## 3. å½±å“è¯„ä¼°

### 3.1. å¯¹åŠ›æ§ç®—æ³•çš„å½±å“

#### 3.1.1. å…³èŠ‚ä½ç½® vs å…³èŠ‚é€Ÿåº¦

**é—®é¢˜**ï¼šå…³èŠ‚ä½ç½®æ¥è‡ª 0x2A5-0x2A7ï¼ˆ3 å¸§ï¼‰ï¼Œå…³èŠ‚é€Ÿåº¦æ¥è‡ª 0x251-0x256ï¼ˆ6 å¸§ï¼‰ï¼Œå®ƒä»¬çš„æ—¶é—´æˆ³å¯èƒ½ä¸åŒæ­¥ã€‚

**å½±å“**ï¼š
- **æ•°å€¼å¾®åˆ†**ï¼šå¦‚æœä½¿ç”¨ä½ç½®å·®åˆ†è®¡ç®—é€Ÿåº¦ï¼Œä¸åŒæ­¥çš„æ•°æ®ä¼šå¯¼è‡´è®¡ç®—é”™è¯¯
- **PID æ§åˆ¶**ï¼šå¦‚æœä½ç½®å’Œé€Ÿåº¦æ¥è‡ªä¸åŒæ—¶åˆ»ï¼ŒPID æ§åˆ¶å™¨çš„ P å’Œ D é¡¹å¯èƒ½ä¸åŒ¹é…
- **çŠ¶æ€ä¼°è®¡**ï¼šå¡å°”æ›¼æ»¤æ³¢ç­‰çŠ¶æ€ä¼°è®¡ç®—æ³•éœ€è¦åŒæ­¥çš„çŠ¶æ€ï¼Œä¸åŒæ­¥ä¼šå¯¼è‡´ä¼°è®¡åå·®

**ä¸¥é‡ç¨‹åº¦**ï¼šâ­â­â­â­ **é«˜**ï¼ˆç›´æ¥å½±å“æ§åˆ¶ç¨³å®šæ€§ï¼‰

#### 3.1.2. å…³èŠ‚ä½ç½® vs æœ«ç«¯ä½å§¿

**é—®é¢˜**ï¼šå…³èŠ‚ä½ç½®æ¥è‡ª 0x2A5-0x2A7ï¼Œæœ«ç«¯ä½å§¿æ¥è‡ª 0x2A2-0x2A4ï¼Œå®ƒä»¬çš„æ—¶é—´æˆ³å¯èƒ½ä¸åŒæ­¥ã€‚

**å½±å“**ï¼š
- **é€†è¿åŠ¨å­¦**ï¼šå¦‚æœå…³èŠ‚ä½ç½®å’Œæœ«ç«¯ä½å§¿ä¸åŒæ­¥ï¼Œé€†è¿åŠ¨å­¦æ±‚è§£ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„ç»“æœ
- **é›…å¯æ¯”çŸ©é˜µ**ï¼šéœ€è¦åŒæ­¥çš„å…³èŠ‚ä½ç½®å’Œæœ«ç«¯é€Ÿåº¦/åŠ é€Ÿåº¦ï¼Œä¸åŒæ­¥ä¼šå¯¼è‡´é›…å¯æ¯”çŸ©é˜µé”™è¯¯

**ä¸¥é‡ç¨‹åº¦**ï¼šâ­â­â­ **ä¸­**ï¼ˆå½±å“è¿åŠ¨å­¦è®¡ç®—å‡†ç¡®æ€§ï¼‰

#### 3.1.3. å…³èŠ‚æ•°æ® vs æ§åˆ¶çŠ¶æ€

**é—®é¢˜**ï¼šå…³èŠ‚æ•°æ®æ¥è‡ªé«˜é¢‘åé¦ˆå¸§ï¼ˆ1kHzï¼‰ï¼Œæ§åˆ¶çŠ¶æ€æ¥è‡ª 0x2A1ï¼ˆå¯èƒ½ 100Hz æˆ–æ›´ä½ï¼‰ã€‚

**å½±å“**ï¼š
- **çŠ¶æ€æ£€æŸ¥**ï¼šå¦‚æœæ§åˆ¶çŠ¶æ€ä¸åŒæ­¥ï¼Œå¯èƒ½åœ¨é”™è¯¯çš„çŠ¶æ€ä¸‹æ‰§è¡Œæ§åˆ¶ç®—æ³•
- **æ¨¡å¼åˆ‡æ¢**ï¼šæ¨¡å¼åˆ‡æ¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨è¿‡æ—¶çš„æ§åˆ¶çŠ¶æ€

**ä¸¥é‡ç¨‹åº¦**ï¼šâ­â­ **ä¸­ä½**ï¼ˆå½±å“çŠ¶æ€æ£€æŸ¥ï¼Œä½†ä¸ç›´æ¥å½±å“æ§åˆ¶å¾ªç¯ï¼‰

#### 3.1.4. è¿åŠ¨æ•°æ® vs è¯Šæ–­æ•°æ®

**é—®é¢˜**ï¼šè¿åŠ¨æ•°æ®æ¥è‡ªé«˜é¢‘åé¦ˆå¸§ï¼ˆ1kHzï¼‰ï¼Œè¯Šæ–­æ•°æ®æ¥è‡ªä½é¢‘åé¦ˆå¸§ï¼ˆ10Hzï¼‰ã€‚

**å½±å“**ï¼š
- **è¯Šæ–­ç›‘æ§**ï¼šè¯Šæ–­æ•°æ®æ›´æ–°æ…¢ï¼Œä¸å½±å“å®æ—¶æ§åˆ¶ï¼Œä½†å¯èƒ½å»¶è¿Ÿé”™è¯¯æ£€æµ‹
- **å®‰å…¨ä¿æŠ¤**ï¼šå¦‚æœæ¸©åº¦/ç”µå‹å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦é™ä½æ§åˆ¶é¢‘ç‡æˆ–åœæ­¢æ§åˆ¶

**ä¸¥é‡ç¨‹åº¦**ï¼šâ­ **ä½**ï¼ˆä¸å½±å“å®æ—¶æ§åˆ¶ï¼Œåªå½±å“ç›‘æ§ï¼‰

### 3.2. å¯¹æ€§èƒ½çš„å½±å“

#### 3.2.1. è¯»å–æ€§èƒ½

**å½“å‰è®¾è®¡**ï¼š
```rust
pub fn get_motion_state(&self) -> MotionState {
    (**self.ctx.motion.load()).clone()
}
```

**é—®é¢˜**ï¼š
- å¦‚æœæ‰€æœ‰å­—æ®µåœ¨ä¸€ä¸ª `MotionState` ä¸­ï¼Œ`Clone` ä¼šå¤åˆ¶æ‰€æœ‰å­—æ®µï¼ˆå³ä½¿æœ‰äº›å­—æ®µå·²ç»è¿‡æœŸï¼‰
- å¦‚æœå­—æ®µæ¥è‡ªä¸åŒæ—¶åˆ»ï¼Œå¤åˆ¶"è¿‡æœŸ"å­—æ®µæ²¡æœ‰æ„ä¹‰

**å½±å“**ï¼šâ­ **ä½**ï¼ˆ`Clone` å¼€é”€é€šå¸¸å¾ˆå°ï¼Œä½†å¦‚æœå­—æ®µå¾ˆå¤šï¼Œå¯èƒ½æœ‰å½±å“ï¼‰

#### 3.2.2. Frame Commit å¤æ‚åº¦

**å½“å‰è®¾è®¡**ï¼šFrame Commit æœºåˆ¶éœ€è¦ç­‰å¾…å®Œæ•´å¸§ç»„ï¼ˆå¦‚ 0x2A5, 0x2A6, 0x2A7ï¼‰ã€‚

**é—®é¢˜**ï¼š
- å¦‚æœä¸åŒå¸§ç»„çš„æ—¶é—´æˆ³ä¸åŒï¼Œæ˜¯å¦éœ€è¦ä¸ºæ¯ä¸ªå¸§ç»„å•ç‹¬ç»´æŠ¤æ—¶é—´æˆ³ï¼Ÿ
- å¦‚æœæŸäº›å¸§ç»„æ›´æ–°é¢‘ç‡ä¸åŒï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ•°æ®è¿‡æœŸï¼Ÿ

**å½±å“**ï¼šâ­â­ **ä¸­**ï¼ˆå½±å“ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æ€§ï¼‰

## 4. è§£å†³æ–¹æ¡ˆåˆ†æ

### 4.1. æ–¹æ¡ˆ 1ï¼šä¿æŒç°æœ‰è®¾è®¡ï¼Œåœ¨å­—æ®µçº§åˆ«æ·»åŠ æ—¶é—´æˆ³

**è®¾è®¡**ï¼šä¸ºæ¯ä¸ªå­—æ®µç»„æ·»åŠ ç‹¬ç«‹çš„æ—¶é—´æˆ³ã€‚

```rust
pub struct MotionState {
    pub timestamp_joint_pos_us: u64,  // å…³èŠ‚ä½ç½®æ—¶é—´æˆ³
    pub joint_pos: [f64; 6],

    pub timestamp_joint_vel_us: u64,  // å…³èŠ‚é€Ÿåº¦æ—¶é—´æˆ³
    pub joint_vel: [f64; 6],

    pub timestamp_end_pose_us: u64,   // æœ«ç«¯ä½å§¿æ—¶é—´æˆ³
    pub end_pose: [f64; 6],

    // ...
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¿ç•™å•ä¸€çŠ¶æ€ç»“æ„ï¼ŒAPI ç®€å•
- âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ¯ä¸ªå­—æ®µç»„çš„æ—¶é—´æˆ³
- âœ… é€‚åˆåˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸ

**ç¼ºç‚¹**ï¼š
- âŒ çŠ¶æ€ç»“æ„å˜å¤§ï¼ˆå¤šä¸ªæ—¶é—´æˆ³å­—æ®µï¼‰
- âŒ ç”¨æˆ·éœ€è¦è‡ªå·±åˆ¤æ–­å“ªäº›å­—æ®µæ˜¯åŒæ­¥çš„
- âŒ Frame Commit é€»è¾‘å˜å¤æ‚ï¼ˆéœ€è¦ä¸ºæ¯ä¸ªå­—æ®µç»„å•ç‹¬æ›´æ–°æ—¶é—´æˆ³ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š**ä¸æ¨è**ï¼Œé™¤éå­—æ®µç»„æ•°é‡å¾ˆå°‘ï¼ˆ<3 ä¸ªï¼‰

### 4.2. æ–¹æ¡ˆ 2ï¼šæŒ‰æ—¶é—´åŒæ­¥æ€§æ‹†åˆ†çŠ¶æ€

**è®¾è®¡**ï¼šæŒ‰ç…§ CAN å¸§çš„æ—¶é—´åŒæ­¥æ€§ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªå­çŠ¶æ€ã€‚

```rust
// æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼ˆé«˜é¢‘ï¼Œ1kHzï¼Œå¸§ç»„åŒæ­¥ï¼‰
pub struct CoreMotionState {
    pub timestamp_us: u64,
    pub joint_pos: [f64; 6],        // æ¥è‡ª 0x2A5-0x2A7
    pub end_pose: [f64; 6],         // æ¥è‡ª 0x2A2-0x2A4
}

// å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼ˆé«˜é¢‘ï¼Œ1kHzï¼Œç‹¬ç«‹å¸§ï¼‰
pub struct JointDynamicState {
    pub timestamp_us: u64,
    pub joint_vel: [f64; 6],        // æ¥è‡ª 0x251-0x256
    pub joint_current: [f64; 6],    // æ¥è‡ª 0x251-0x256
}

// æ§åˆ¶çŠ¶æ€ï¼ˆä½é¢‘ï¼Œ100Hzï¼‰
pub struct ControlStatusState {
    pub timestamp_us: u64,
    pub control_mode: u8,
    pub robot_status: u8,
    pub move_mode: u8,
    // ... æ¥è‡ª 0x2A1
}

// å¤¹çˆªçŠ¶æ€ï¼ˆä¸­é¢‘ï¼Œå¯èƒ½ç‹¬ç«‹æ›´æ–°ï¼‰
pub struct GripperState {
    pub timestamp_us: u64,
    pub travel: f64,
    pub torque: f64,
    // ... æ¥è‡ª 0x2A8
}

// ç»„åˆçŠ¶æ€ï¼ˆç”¨äºå…¼å®¹ï¼‰
pub struct MotionState {
    pub core: Arc<ArcSwap<CoreMotionState>>,
    pub joint_dynamic: Arc<ArcSwap<JointDynamicState>>,
    pub control_status: Arc<ArcSwap<ControlStatusState>>,
    pub gripper: Arc<ArcSwap<GripperState>>,
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… **æ¸…æ™°çš„æ—¶é—´åŒæ­¥æ€§**ï¼šæ¯ä¸ªå­çŠ¶æ€å†…çš„å­—æ®µéƒ½æ˜¯åŒæ­¥çš„
- âœ… **ç²¾ç¡®çš„æ—¶é—´æˆ³**ï¼šæ¯ä¸ªå­çŠ¶æ€éƒ½æœ‰è‡ªå·±çš„æ—¶é—´æˆ³
- âœ… **Frame Commit ç®€åŒ–**ï¼šæ¯ä¸ªå­çŠ¶æ€å¯ä»¥ç‹¬ç«‹è¿›è¡Œ Frame Commit
- âœ… **çµæ´»æ€§é«˜**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è¯»å–ç‰¹å®šå­çŠ¶æ€
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯ä»¥ä¸ºé«˜é¢‘å­çŠ¶æ€ä½¿ç”¨ ArcSwapï¼Œä½é¢‘å­çŠ¶æ€ä½¿ç”¨ RwLock

**ç¼ºç‚¹**ï¼š
- âŒ **API å¤æ‚åŒ–**ï¼šç”¨æˆ·éœ€è¦è¯»å–å¤šä¸ªå­çŠ¶æ€
- âŒ **çŠ¶æ€ç»“æ„å˜å¤š**ï¼šéœ€è¦ç®¡ç†å¤šä¸ª ArcSwap æˆ– RwLock

**é€‚ç”¨åœºæ™¯**ï¼š**æ¨è**ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦ç²¾ç¡®æ—¶é—´æˆ³çš„åŠ›æ§åº”ç”¨

### 4.3. æ–¹æ¡ˆ 3ï¼šæŒ‰æ›´æ–°é¢‘ç‡æ‹†åˆ†çŠ¶æ€

**è®¾è®¡**ï¼šæŒ‰ç…§æ›´æ–°é¢‘ç‡ï¼Œæ‹†åˆ†ä¸º"çƒ­æ•°æ®"ã€"æ¸©æ•°æ®"ã€"å†·æ•°æ®"ã€‚

```rust
// çƒ­æ•°æ®ï¼ˆ1kHzï¼Œé«˜é¢‘è¿åŠ¨æ•°æ®ï¼‰
pub struct HotMotionState {
    pub timestamp_us: u64,
    pub joint_pos: [f64; 6],
    pub joint_vel: [f64; 6],
    pub joint_current: [f64; 6],
    pub end_pose: [f64; 6],
}

// æ¸©æ•°æ®ï¼ˆ100Hzï¼Œæ§åˆ¶çŠ¶æ€ï¼‰
pub struct WarmControlState {
    pub timestamp_us: u64,
    pub control_mode: u8,
    pub robot_status: u8,
    pub move_mode: u8,
    pub gripper_travel: f64,
}

// å†·æ•°æ®ï¼ˆ10Hzï¼Œè¯Šæ–­æ•°æ®ï¼‰
pub struct ColdDiagnosticState {
    pub timestamp_us: u64,
    pub motor_temps: [f32; 6],
    pub driver_temps: [f32; 6],
    // ...
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… **æ¸…æ™°çš„é¢‘ç‡åˆ’åˆ†**ï¼šä¸ TDD æ–‡æ¡£ä¸­çš„"çƒ­/æ¸©/å†·"æ¦‚å¿µä¸€è‡´
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯ä»¥ä¸ºä¸åŒé¢‘ç‡çš„çŠ¶æ€ä½¿ç”¨ä¸åŒçš„åŒæ­¥æœºåˆ¶ï¼ˆArcSwap vs RwLockï¼‰
- âœ… **API ç®€åŒ–**ï¼šæ¯”æ–¹æ¡ˆ 2 æ›´ç®€å•ï¼Œä½†ä»ä¿ç•™äº†æ—¶é—´åŒæ­¥æ€§

**ç¼ºç‚¹**ï¼š
- âŒ **æ—¶é—´åŒæ­¥æ€§ä¸å®Œç¾**ï¼šçƒ­æ•°æ®ä¸­çš„å­—æ®µå¯èƒ½ä»ä¸åŒæ­¥ï¼ˆå¦‚å…³èŠ‚ä½ç½® vs å…³èŠ‚é€Ÿåº¦ï¼‰
- âŒ **éœ€è¦æƒè¡¡**ï¼šåœ¨"æ¸…æ™°çš„æ—¶é—´åŒæ­¥æ€§"å’Œ"ç®€å•çš„ API"ä¹‹é—´æƒè¡¡

**é€‚ç”¨åœºæ™¯**ï¼š**éƒ¨åˆ†æ¨è**ï¼Œé€‚åˆä¸éœ€è¦ç²¾ç¡®æ—¶é—´æˆ³çš„åº”ç”¨

### 4.4. æ–¹æ¡ˆ 4ï¼šæ··åˆæ–¹æ¡ˆï¼ˆåŸºç¡€ç‰ˆï¼‰

**è®¾è®¡**ï¼šç»“åˆæ–¹æ¡ˆ 2 å’Œæ–¹æ¡ˆ 3ï¼ŒæŒ‰æ—¶é—´åŒæ­¥æ€§æ‹†åˆ†çƒ­æ•°æ®ï¼ŒæŒ‰é¢‘ç‡æ‹†åˆ†æ¸©/å†·æ•°æ®ã€‚

```rust
// ============================================================
// çƒ­æ•°æ®ï¼ˆ1kHzï¼Œé«˜é¢‘è¿åŠ¨æ•°æ®ï¼‰
// ============================================================

/// æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼ˆå¸§ç»„åŒæ­¥ï¼‰
pub struct CoreMotionState {
    pub timestamp_us: u64,
    pub joint_pos: [f64; 6],        // æ¥è‡ª 0x2A5-0x2A7ï¼ˆå¸§ç»„ï¼‰
    pub end_pose: [f64; 6],         // æ¥è‡ª 0x2A2-0x2A4ï¼ˆå¸§ç»„ï¼‰
}

/// å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼ˆç‹¬ç«‹å¸§ï¼‰
pub struct JointDynamicState {
    pub timestamp_us: u64,
    pub joint_vel: [f64; 6],        // æ¥è‡ª 0x251-0x256ï¼ˆç‹¬ç«‹å¸§ï¼‰
    pub joint_current: [f64; 6],    // æ¥è‡ª 0x251-0x256ï¼ˆç‹¬ç«‹å¸§ï¼‰
}
```

**âš ï¸ å­˜åœ¨é—®é¢˜**ï¼š
- **çŠ¶æ€æ’•è£‚é£é™©**ï¼šå¦‚æœæ”¶åˆ°ä¸€å¸§é€Ÿåº¦å°±ç«‹å³æ›´æ–° `ArcSwap`ï¼Œä¼šå¯¼è‡´ 6 ä¸ªå…³èŠ‚çš„é€Ÿåº¦æ¥è‡ªä¸åŒæ—¶åˆ»ï¼ˆå‰ 3 ä¸ªå…³èŠ‚æ˜¯æ–°çš„ï¼Œå 3 ä¸ªæ˜¯æ—§çš„ï¼‰
- **æ€§èƒ½é—®é¢˜**ï¼šæ¯æ¬¡æ›´æ–°éƒ½ä¼šè§¦å‘ `ArcSwap` åˆ‡æ¢ï¼Œ6 å¸§ä¼šå¯¼è‡´ 6 æ¬¡åˆ‡æ¢
- **æ—¶é—´å¯¹é½ç¼ºå¤±**ï¼šè·¨çŠ¶æ€è¯»å–æ—¶ï¼Œæ²¡æœ‰æ˜ç¡®çš„æœºåˆ¶æ¥æ£€æŸ¥æˆ–å¤„ç†æ—¶é—´æˆ³å·®å¼‚

### 4.5. æ–¹æ¡ˆ 4+ï¼šæ··åˆæ–¹æ¡ˆ + Buffered Commit Strategyï¼ˆå¼ºçƒˆæ¨èï¼‰

**è®¾è®¡**ï¼šåœ¨æ–¹æ¡ˆ 4 çš„åŸºç¡€ä¸Šï¼Œå¼•å…¥**"ç¼“å†²æäº¤ï¼ˆBuffered Commitï¼‰"**æœºåˆ¶ï¼Œè§£å†³ `JointDynamicState` çš„å†…éƒ¨ä¸åŒæ­¥é—®é¢˜ã€‚

```rust
// ============================================================
// çƒ­æ•°æ®ï¼ˆ1kHzï¼Œé«˜é¢‘è¿åŠ¨æ•°æ®ï¼‰
// ============================================================

/// æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼ˆå¸§ç»„åŒæ­¥ï¼‰
pub struct CoreMotionState {
    pub timestamp_us: u64,
    pub joint_pos: [f64; 6],        // æ¥è‡ª 0x2A5-0x2A7ï¼ˆå¸§ç»„ï¼‰
    pub end_pose: [f64; 6],         // æ¥è‡ª 0x2A2-0x2A4ï¼ˆå¸§ç»„ï¼‰
}

/// å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼ˆç‹¬ç«‹å¸§ï¼Œä½†é€šè¿‡ç¼“å†²æäº¤ä¿è¯ä¸€è‡´æ€§ï¼‰
pub struct JointDynamicState {
    /// æ•´ä¸ªç»„çš„å¤§è‡´æ—¶é—´æˆ³ï¼ˆæœ€æ–°ä¸€å¸§çš„æ—¶é—´ï¼‰
    pub group_timestamp_us: u64,

    pub joint_vel: [f64; 6],        // æ¥è‡ª 0x251-0x256ï¼ˆç‹¬ç«‹å¸§ï¼‰
    pub joint_current: [f64; 6],    // æ¥è‡ª 0x251-0x256ï¼ˆç‹¬ç«‹å¸§ï¼‰

    /// æ¯ä¸ªå…³èŠ‚çš„å…·ä½“æ›´æ–°æ—¶é—´ï¼ˆç”¨äºè°ƒè¯•æˆ–é«˜é˜¶æ’å€¼ï¼‰
    pub timestamps: [u64; 6],

    /// æœ‰æ•ˆæ€§æ©ç ï¼ˆBit 0-5 å¯¹åº” Joint 1-6ï¼‰
    /// - 1 è¡¨ç¤ºæœ¬å‘¨æœŸå†…å·²æ›´æ–°
    /// - 0 è¡¨ç¤ºæœªæ›´æ–°ï¼ˆå¯èƒ½æ˜¯ä¸¢å¸§ï¼‰
    pub valid_mask: u8,
}

// ============================================================
// æ¸©æ•°æ®ï¼ˆ100Hzï¼Œæ§åˆ¶çŠ¶æ€ï¼‰
// ============================================================

pub struct ControlStatusState {
    pub timestamp_us: u64,
    pub control_mode: u8,
    pub robot_status: u8,
    pub move_mode: u8,
    pub teach_status: u8,
    pub motion_status: u8,
    pub trajectory_point_index: u8,
    pub fault_angle_limit: [bool; 6],
    pub fault_comm_error: [bool; 6],
    pub gripper_travel: f64,
    pub gripper_torque: f64,
    // ... æ¥è‡ª 0x2A1 å’Œ 0x2A8
}

// ============================================================
// å†·æ•°æ®ï¼ˆ10Hz æˆ–æŒ‰éœ€ï¼Œè¯Šæ–­å’Œé…ç½®æ•°æ®ï¼‰
// ============================================================

pub struct DiagnosticState {
    pub timestamp_us: u64,
    pub motor_temps: [f32; 6],
    pub driver_temps: [f32; 6],
    pub joint_voltage: [f32; 6],
    pub joint_bus_current: [f32; 6],
    pub protection_levels: [u8; 6],
    // ... æ¥è‡ª 0x261-0x266 å’Œ 0x47B
}

pub struct ConfigState {
    // é…ç½®æ•°æ®é€šå¸¸æ²¡æœ‰æ—¶é—´æˆ³ï¼ˆå› ä¸ºå‡ ä¹ä¸å˜ï¼‰
    pub joint_limits_max: [f64; 6],
    pub joint_limits_min: [f64; 6],
    pub joint_max_velocity: [f64; 6],
    pub max_acc_limits: [f64; 6],
    // ... æ¥è‡ªé…ç½®åé¦ˆå¸§ï¼ˆæŒ‰éœ€æŸ¥è¯¢ï¼‰
}

// ============================================================
// æ€»ä¸Šä¸‹æ–‡ï¼ˆèšåˆæ‰€æœ‰çŠ¶æ€ï¼‰
// ============================================================

pub struct PiperContext {
    // çƒ­æ•°æ®ï¼šä½¿ç”¨ ArcSwapï¼Œæ— é”è¯»å–
    pub core_motion: Arc<ArcSwap<CoreMotionState>>,
    pub joint_dynamic: Arc<ArcSwap<JointDynamicState>>,

    // æ¸©æ•°æ®ï¼šä½¿ç”¨ ArcSwap æˆ– RwLockï¼ˆå–å†³äºè¯»å–é¢‘ç‡ï¼‰
    pub control_status: Arc<ArcSwap<ControlStatusState>>,

    // å†·æ•°æ®ï¼šä½¿ç”¨ RwLock
    pub diagnostics: Arc<RwLock<DiagnosticState>>,
    pub config: Arc<RwLock<ConfigState>>,
}
```

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. **Group Commit æœºåˆ¶**ï¼šæ”¶é›† 6 ä¸ªå…³èŠ‚çš„é€Ÿåº¦å¸§ï¼Œé›†é½åä¸€æ¬¡æ€§åŸå­æäº¤ï¼Œé¿å…çŠ¶æ€æ’•è£‚
2. **è¶…æ—¶ä¿æŠ¤**ï¼šå¦‚æœ 1.2ms å†…æœªé›†é½ 6 å¸§ï¼Œä¹Ÿè¿›è¡Œæäº¤ï¼ˆé˜²æ­¢ä¸¢å¸§å¯¼è‡´æ­»é”ï¼‰
3. **æœ‰æ•ˆæ€§æ ‡è®°**ï¼šé€šè¿‡ `valid_mask` æ ‡è®°å“ªäº›å…³èŠ‚çš„æ•°æ®å·²æ›´æ–°ï¼Œå“ªäº›å¯èƒ½ä¸¢å¤±
4. **ç»†ç²’åº¦æ—¶é—´æˆ³**ï¼š`timestamps` æ•°ç»„è®°å½•æ¯ä¸ªå…³èŠ‚çš„æ›´æ–°æ—¶é—´ï¼Œæ”¯æŒè°ƒè¯•å’Œæ’å€¼

**ä¼˜ç‚¹**ï¼š
- âœ… **åŸå­æ€§è§†å›¾**ï¼š`JointDynamicState` å†…çš„ 6 ä¸ªå…³èŠ‚æ•°æ®æ¥è‡ªåŒä¸€ CAN ä¼ è¾“å‘¨æœŸï¼ˆå°½å¯èƒ½ï¼‰
- âœ… **æœ€ä½³æ—¶é—´åŒæ­¥æ€§**ï¼šæ¯ä¸ªå­çŠ¶æ€å†…çš„å­—æ®µéƒ½æ˜¯åŒæ­¥çš„
- âœ… **æ¸…æ™°çš„é¢‘ç‡åˆ’åˆ†**ï¼šçƒ­/æ¸©/å†·æ•°æ®åˆ†ç¦»ï¼Œæ€§èƒ½ä¼˜åŒ–
- âœ… **ç²¾ç¡®çš„æ—¶é—´æˆ³**ï¼šæ¯ä¸ªå­çŠ¶æ€éƒ½æœ‰è‡ªå·±çš„æ—¶é—´æˆ³
- âœ… **çµæ´»çš„ç»„åˆ**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è¯»å–ç‰¹å®šå­çŠ¶æ€ï¼Œæˆ–ç»„åˆè¯»å–
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå°† 6 æ¬¡ `ArcSwap` å†™æ“ä½œåˆå¹¶ä¸º 1 æ¬¡

**ç¼ºç‚¹**ï¼š
- âŒ **API å¤æ‚åŒ–**ï¼šéœ€è¦è¯»å–å¤šä¸ªå­çŠ¶æ€ï¼Œä½†å¯ä»¥é€šè¿‡ helper æ–¹æ³•ç®€åŒ–
- âš ï¸ **å»¶è¿Ÿå¢åŠ **ï¼šå¦‚æœç­‰å¾…é›†é½ 6 å¸§ï¼Œå¯èƒ½æœ‰å¾®ç§’çº§å»¶è¿Ÿï¼ˆä½†å¯æ¥å—ï¼Œå› ä¸ºä¿è¯äº†åŸå­æ€§ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š**å¼ºçƒˆæ¨è**ï¼Œé€‚åˆéœ€è¦ç²¾ç¡®æ—¶é—´æˆ³å’Œæ€§èƒ½ä¼˜åŒ–çš„åŠ›æ§åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯å¤šå…³èŠ‚åè°ƒæ§åˆ¶åœºæ™¯

## 5. è®¾è®¡å»ºè®®

### 5.1. æ¨èæ–¹æ¡ˆï¼šæ··åˆæ–¹æ¡ˆ + Buffered Commitï¼ˆæ–¹æ¡ˆ 4+ï¼‰

**ç†ç”±**ï¼š
1. **åŸå­æ€§ä¿è¯**ï¼šé€šè¿‡ Group Commit æœºåˆ¶ï¼Œé¿å… `JointDynamicState` å†…éƒ¨çš„çŠ¶æ€æ’•è£‚ï¼ˆå‰ 3 ä¸ªå…³èŠ‚æ–°ï¼Œå 3 ä¸ªå…³èŠ‚æ—§ï¼‰
2. **æ—¶é—´åŒæ­¥æ€§**ï¼šæ¯ä¸ªå­çŠ¶æ€å†…çš„å­—æ®µéƒ½æ˜¯åŒæ­¥çš„ï¼Œé¿å…æ—¶é—´ä¸åŒæ­¥å¯¼è‡´çš„æ§åˆ¶è¯¯å·®
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå°† 6 æ¬¡ `ArcSwap` å†™æ“ä½œåˆå¹¶ä¸º 1 æ¬¡ï¼Œå‡å°‘ cache thrashing
4. **ç²¾ç¡®çš„æ—¶é—´æˆ³**ï¼šæ¯ä¸ªå­çŠ¶æ€éƒ½æœ‰è‡ªå·±çš„æ—¶é—´æˆ³ï¼Œç”¨æˆ·å¯ä»¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸ
5. **çµæ´»æ€§**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è¯»å–ç‰¹å®šå­çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„ Clone
6. **å®¹é”™æ€§**ï¼šé€šè¿‡ `valid_mask` å’Œè¶…æ—¶æœºåˆ¶ï¼Œå¤„ç†ä¸¢å¸§æƒ…å†µ

**ä¸ºä»€ä¹ˆæ–¹æ¡ˆ 4 éœ€è¦æ”¹è¿›**ï¼š
- **ç‰©ç†æ˜ å°„å‡†ç¡®**ï¼šæ‰¿è®¤ç¡¬ä»¶çš„å±€é™æ€§ï¼Œä½ç½®æ•°æ®ï¼ˆå¸§ç»„ï¼‰å’Œé€Ÿåº¦æ•°æ®ï¼ˆç‹¬ç«‹å¸§ï¼‰åœ¨ç‰©ç†é“¾è·¯ä¸Šå°±æ˜¯ä¸åŒæ­¥çš„
- **çŠ¶æ€æ’•è£‚é£é™©**ï¼šå¦‚æœæ”¶åˆ°ä¸€å¸§é€Ÿåº¦å°±ç«‹å³æ›´æ–°ï¼Œä¼šå¯¼è‡´ 6 ä¸ªå…³èŠ‚çš„é€Ÿåº¦æ¥è‡ªä¸åŒæ—¶åˆ»
- **å¤šå…³èŠ‚åè°ƒéœ€æ±‚**ï¼šå¯¹äºè®¡ç®—ç§‘é‡Œå¥¥åˆ©åŠ›çŸ©é˜µç­‰åŠ¨åŠ›å­¦ç®—æ³•ï¼Œæ—¶é—´æ‰­æ›²ä¼šå¯¼è‡´è®¡ç®—å‡ºçš„åŠ›çŸ©éœ‡è¡

### 5.2. API è®¾è®¡å»ºè®®

#### 5.2.1. åŸºç¡€ APIï¼ˆç»†ç²’åº¦è¯»å–ï¼‰

```rust
impl Piper {
    /// è·å–æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼ˆå¸§ç»„åŒæ­¥ï¼‰
    pub fn get_core_motion(&self) -> CoreMotionState {
        (**self.ctx.core_motion.load()).clone()
    }

    /// è·å–å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼ˆç‹¬ç«‹å¸§ï¼‰
    pub fn get_joint_dynamic(&self) -> JointDynamicState {
        (**self.ctx.joint_dynamic.load()).clone()
    }

    /// è·å–æ§åˆ¶çŠ¶æ€ï¼ˆä½é¢‘ï¼‰
    pub fn get_control_status(&self) -> ControlStatusState {
        (**self.ctx.control_status.load()).clone()
    }

    /// è·å–è¯Šæ–­çŠ¶æ€ï¼ˆä½é¢‘ï¼‰
    pub fn get_diagnostics(&self) -> Result<DiagnosticState, DriverError> {
        self.ctx.diagnostics.read()
            .map(|guard| guard.clone())
            .map_err(|_| DriverError::PoisonedLock)
    }
}
```

#### 5.2.2. ç»„åˆ APIï¼ˆå…¼å®¹æ€§è¯»å–ï¼‰

```rust
impl Piper {
    /// è·å–ç»„åˆè¿åŠ¨çŠ¶æ€ï¼ˆæ‰€æœ‰çƒ­æ•°æ®ï¼‰
    ///
    /// æ³¨æ„ï¼šä¸åŒå­çŠ¶æ€çš„æ—¶é—´æˆ³å¯èƒ½ä¸åŒæ­¥ï¼ˆå·®å¼‚é€šå¸¸åœ¨æ¯«ç§’çº§ï¼‰
    pub fn get_motion_state(&self) -> CombinedMotionState {
        CombinedMotionState {
            core: self.get_core_motion(),
            joint_dynamic: self.get_joint_dynamic(),
        }
    }
}

pub struct CombinedMotionState {
    pub core: CoreMotionState,
    pub joint_dynamic: JointDynamicState,
}
```

#### 5.2.3. æ—¶é—´æˆ³æ£€æŸ¥å’Œæ—¶é—´å¯¹é½ API

```rust
impl CoreMotionState {
    /// æ£€æŸ¥çŠ¶æ€æ˜¯å¦è¿‡æœŸï¼ˆç›¸å¯¹äºç»™å®šæ—¶é—´æˆ³ï¼‰
    pub fn is_stale(&self, now_us: u64, max_age_us: u64) -> bool {
        now_us.saturating_sub(self.timestamp_us) > max_age_us
    }
}

impl JointDynamicState {
    /// æ£€æŸ¥æ‰€æœ‰å…³èŠ‚æ˜¯å¦éƒ½å·²æ›´æ–°ï¼ˆ`valid_mask == 0x3F`ï¼‰
    pub fn is_complete(&self) -> bool {
        self.valid_mask == 0b111111
    }

    /// è·å–æœªæ›´æ–°çš„å…³èŠ‚ç´¢å¼•ï¼ˆç”¨äºè°ƒè¯•ï¼‰
    pub fn missing_joints(&self) -> Vec<usize> {
        (0..6).filter(|&i| (self.valid_mask & (1 << i)) == 0).collect()
    }
}

impl Piper {
    /// è·å–åŒæ­¥çš„è¿åŠ¨çŠ¶æ€ï¼ˆæ£€æŸ¥æ—¶é—´æˆ³å·®å¼‚ï¼‰
    ///
    /// å¦‚æœæ—¶é—´æˆ³å·®å¼‚å°äº `max_time_diff_us`ï¼Œè¿”å›ç»„åˆçŠ¶æ€ï¼›å¦åˆ™è¿”å› None
    pub fn get_synchronized_motion(&self, max_time_diff_us: u64) -> Option<CombinedMotionState> {
        let core = self.get_core_motion();
        let joint_dynamic = self.get_joint_dynamic();

        let time_diff = core.timestamp_us.abs_diff(joint_dynamic.group_timestamp_us);
        if time_diff <= max_time_diff_us {
            Some(CombinedMotionState { core, joint_dynamic })
        } else {
            None // æ•°æ®ä¸åŒæ­¥ï¼Œè¿”å› None
        }
    }

    /// è·å–æ—¶é—´å¯¹é½çš„è¿åŠ¨çŠ¶æ€ï¼ˆæ¨èç”¨äºåŠ›æ§ç®—æ³•ï¼‰
    ///
    /// ä»¥ `core.timestamp_us` ä¸ºåŸºå‡†æ—¶é—´ï¼Œæ£€æŸ¥å¹¶è­¦å‘Šæ—¶é—´æˆ³å·®å¼‚
    pub fn get_aligned_motion(&self, max_time_diff_us: u64) -> Result<AlignedMotionState, AlignmentError> {
        let core = self.get_core_motion();
        let joint_dynamic = self.get_joint_dynamic();

        let time_diff = core.timestamp_us.abs_diff(joint_dynamic.group_timestamp_us);

        if time_diff > max_time_diff_us {
            return Err(AlignmentError::TimeMismatch {
                core_ts: core.timestamp_us,
                dynamic_ts: joint_dynamic.group_timestamp_us,
                diff_us: time_diff,
            });
        }

        // æ£€æŸ¥é€Ÿåº¦æ•°æ®æ˜¯å¦å®Œæ•´
        if !joint_dynamic.is_complete() {
            let missing = joint_dynamic.missing_joints();
            warn!("Velocity data incomplete: missing joints {:?}", missing);
        }

        Ok(AlignedMotionState {
            joint_pos: core.joint_pos,
            joint_vel: joint_dynamic.joint_vel,
            joint_current: joint_dynamic.joint_current,
            end_pose: core.end_pose,
            timestamp: core.timestamp_us,  // ä½¿ç”¨ä½ç½®æ•°æ®çš„æ—¶é—´æˆ³ä½œä¸ºåŸºå‡†
            time_diff_us: time_diff as i64,
        })
    }
}

/// æ—¶é—´å¯¹é½åçš„è¿åŠ¨çŠ¶æ€
pub struct AlignedMotionState {
    pub joint_pos: [f64; 6],
    pub joint_vel: [f64; 6],
    pub joint_current: [f64; 6],
    pub end_pose: [f64; 6],
    pub timestamp: u64,          // åŸºå‡†æ—¶é—´æˆ³ï¼ˆæ¥è‡ªä½ç½®æ•°æ®ï¼‰
    pub time_diff_us: i64,       // é€Ÿåº¦æ•°æ®ä¸ä½ç½®æ•°æ®çš„æ—¶é—´å·®ï¼ˆç”¨äºè°ƒè¯•ï¼‰
}

#[derive(Debug, thiserror::Error)]
pub enum AlignmentError {
    #[error("Time mismatch: core={core_ts}us, dynamic={dynamic_ts}us, diff={diff_us}us")]
    TimeMismatch {
        core_ts: u64,
        dynamic_ts: u64,
        diff_us: u64,
    },
}
```

**API ä½¿ç”¨å»ºè®®**ï¼š
- **åŠ›æ§ç®—æ³•**ï¼šä½¿ç”¨ `get_aligned_motion()`ï¼Œç¡®ä¿ä½ç½®å’Œé€Ÿåº¦çš„æ—¶é—´æˆ³å·®å¼‚åœ¨å¯æ¥å—èŒƒå›´å†…
- **çŠ¶æ€ç›‘æ§**ï¼šä½¿ç”¨ `get_synchronized_motion()`ï¼Œç®€å•åœ°æ£€æŸ¥æ—¶é—´æˆ³å·®å¼‚
- **è°ƒè¯•è¯Šæ–­**ï¼šä½¿ç”¨ `JointDynamicState::is_complete()` å’Œ `missing_joints()` æ£€æŸ¥æ•°æ®å®Œæ•´æ€§

### 5.3. Frame Commit é€»è¾‘è°ƒæ•´ï¼ˆæ–¹æ¡ˆ 4+ æ”¹è¿›ç‰ˆï¼‰

```rust
fn io_loop(
    mut can: impl CanAdapter,
    cmd_rx: Receiver<PiperFrame>,
    ctx: Arc<PiperContext>,
    config: PipelineConfig,
) {
    // === æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼šå¸§ç»„åŒæ­¥ ===
    let mut pending_core_motion = CoreMotionState::default();

    // === å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼šç¼“å†²æäº¤ï¼ˆå…³é”®æ”¹è¿›ï¼‰ ===
    let mut pending_joint_dynamic = JointDynamicState::default();
    let mut vel_update_mask: u8 = 0;        // ä½æ©ç ï¼šå·²æ”¶åˆ°çš„å…³èŠ‚
    let mut last_vel_commit_time_us: u64 = 0;

    loop {
        let frame = match can.receive() {
            Ok(frame) => frame,
            Err(e) => { /* ... */ }
        };

        match frame.id {
            // === æ ¸å¿ƒè¿åŠ¨çŠ¶æ€ï¼ˆå¸§ç»„åŒæ­¥ï¼‰ ===
            ID_JOINT_FEEDBACK_12 => {
                if let Ok(feedback) = JointFeedback12::try_from(frame) {
                    pending_core_motion.joint_pos[0] = feedback.j1_rad();
                    pending_core_motion.joint_pos[1] = feedback.j2_rad();
                    // ä¸æäº¤ï¼Œç­‰å¾…å®Œæ•´å¸§ç»„
                }
            }
            ID_JOINT_FEEDBACK_34 => {
                if let Ok(feedback) = JointFeedback34::try_from(frame) {
                    pending_core_motion.joint_pos[2] = feedback.j3_rad();
                    pending_core_motion.joint_pos[3] = feedback.j4_rad();
                }
            }
            ID_JOINT_FEEDBACK_56 => {
                if let Ok(feedback) = JointFeedback56::try_from(frame) {
                    pending_core_motion.joint_pos[4] = feedback.j5_rad();
                    pending_core_motion.joint_pos[5] = feedback.j6_rad();

                    // ã€Frame Commitã€‘å…³èŠ‚ä½ç½®å®Œæ•´å¸§ç»„å·²æ”¶åˆ°
                    pending_core_motion.timestamp_us = frame.timestamp_us;
                    ctx.core_motion.store(Arc::new(pending_core_motion.clone()));
                }
            }

            ID_END_POSE_1 => {
                if let Ok(feedback) = EndPoseFeedback1::try_from(frame) {
                    pending_core_motion.end_pose[0] = feedback.x() / 1000.0;  // mm â†’ m
                    pending_core_motion.end_pose[1] = feedback.y() / 1000.0;
                }
            }
            ID_END_POSE_2 => {
                if let Ok(feedback) = EndPoseFeedback2::try_from(frame) {
                    pending_core_motion.end_pose[2] = feedback.z() / 1000.0;  // mm â†’ m
                    pending_core_motion.end_pose[3] = feedback.rx_rad();
                }
            }
            ID_END_POSE_3 => {
                if let Ok(feedback) = EndPoseFeedback3::try_from(frame) {
                    pending_core_motion.end_pose[4] = feedback.ry_rad();
                    pending_core_motion.end_pose[5] = feedback.rz_rad();

                    // ã€Frame Commitã€‘æœ«ç«¯ä½å§¿å®Œæ•´å¸§ç»„å·²æ”¶åˆ°
                    pending_core_motion.timestamp_us = frame.timestamp_us;
                    ctx.core_motion.store(Arc::new(pending_core_motion.clone()));
                }
            }

            // === å…³èŠ‚åŠ¨æ€çŠ¶æ€ï¼ˆç¼“å†²æäº¤ç­–ç•¥ - æ ¸å¿ƒæ”¹è¿›ï¼‰ ===
            id if id >= ID_JOINT_DRIVER_HIGH_SPEED_BASE && id <= ID_JOINT_DRIVER_HIGH_SPEED_BASE + 5 => {
                let joint_index = (id - ID_JOINT_DRIVER_HIGH_SPEED_BASE) as usize;

                if let Ok(feedback) = JointDriverHighSpeedFeedback::try_from(frame) {
                    // 1. æ›´æ–°ç¼“å†²åŒºï¼ˆè€Œä¸æ˜¯ç«‹å³æäº¤ï¼‰
                    pending_joint_dynamic.joint_vel[joint_index] = feedback.speed();
                    pending_joint_dynamic.joint_current[joint_index] = feedback.current();
                    pending_joint_dynamic.timestamps[joint_index] = frame.timestamp_us;

                    // 2. æ ‡è®°è¯¥å…³èŠ‚å·²æ›´æ–°
                    vel_update_mask |= 1 << joint_index;

                    // 3. åˆ¤æ–­æ˜¯å¦æäº¤ï¼ˆæ··åˆç­–ç•¥ï¼šé›†é½æˆ–è¶…æ—¶ï¼‰
                    let all_received = vel_update_mask == 0b111111;  // 0x3Fï¼Œ6 ä¸ªå…³èŠ‚å…¨éƒ¨æ”¶åˆ°
                    let time_since_last_commit = frame.timestamp_us.saturating_sub(last_vel_commit_time_us);
                    let timeout_threshold_us = 1200;  // 1.2ms è¶…æ—¶ï¼ˆé˜²æ­¢ä¸¢å¸§å¯¼è‡´æ­»é”ï¼‰

                    // ç­–ç•¥ Aï¼šé›†é½ 6 ä¸ªå…³èŠ‚ï¼ˆä¸¥æ ¼åŒæ­¥ï¼‰
                    // ç­–ç•¥ Bï¼šè¶…æ—¶æäº¤ï¼ˆå®¹é”™ï¼‰
                    if all_received || time_since_last_commit > timeout_threshold_us {
                        // åŸå­æ€§åœ°ä¸€æ¬¡æ€§æäº¤æ‰€æœ‰å…³èŠ‚çš„é€Ÿåº¦
                        pending_joint_dynamic.group_timestamp_us = frame.timestamp_us;
                        pending_joint_dynamic.valid_mask = vel_update_mask;

                        ctx.joint_dynamic.store(Arc::new(pending_joint_dynamic.clone()));

                        // é‡ç½®çŠ¶æ€ï¼ˆå‡†å¤‡ä¸‹ä¸€è½®ï¼‰
                        vel_update_mask = 0;
                        last_vel_commit_time_us = frame.timestamp_us;

                        // å¦‚æœè¶…æ—¶æäº¤ï¼Œè®°å½•è­¦å‘Šï¼ˆå¯èƒ½ä¸¢å¸§ï¼‰
                        if !all_received {
                            warn!(
                                "Velocity frame commit timeout: mask={:06b}, missing joints",
                                vel_update_mask
                            );
                        }
                    }
                }
            }

            // === æ§åˆ¶çŠ¶æ€ï¼ˆç‹¬ç«‹å¸§ï¼Œç«‹å³æäº¤ï¼‰ ===
            ID_ROBOT_STATUS => {
                if let Ok(feedback) = RobotStatusFeedback::try_from(frame) {
                    ctx.control_status.rcu(|state| {
                        let mut new = state.clone();
                        new.control_mode = feedback.control_mode as u8;
                        new.robot_status = feedback.robot_status as u8;
                        new.move_mode = feedback.move_mode as u8;
                        new.teach_status = feedback.teach_status as u8;
                        new.motion_status = feedback.motion_status as u8;
                        new.trajectory_point_index = feedback.trajectory_point_index;
                        // ... æ›´æ–°å…¶ä»–å­—æ®µ
                        new.timestamp_us = frame.timestamp_us;
                        new
                    });
                }
            }

            // ... å…¶ä»–å¸§å¤„ç† ...
        }
    }
}
```

**å…³é”®æ”¹è¿›ç‚¹**ï¼š
1. **ç¼“å†²æ”¶é›†**ï¼šæ”¶åˆ°é€Ÿåº¦å¸§åå…ˆæ›´æ–°ç¼“å†²åŒºï¼Œä¸ç«‹å³æäº¤
2. **ç»„æäº¤åˆ¤æ–­**ï¼šé›†é½ 6 å¸§ï¼ˆ`mask == 0x3F`ï¼‰æˆ–è¶…æ—¶ï¼ˆ1.2msï¼‰åä¸€æ¬¡æ€§æäº¤
3. **åŸå­æ€§ä¿è¯**ï¼šä¸€æ¬¡æ€§æäº¤æ‰€æœ‰ 6 ä¸ªå…³èŠ‚çš„æ•°æ®ï¼Œé¿å…çŠ¶æ€æ’•è£‚
4. **æœ‰æ•ˆæ€§æ ‡è®°**ï¼šé€šè¿‡ `valid_mask` è®°å½•å“ªäº›å…³èŠ‚å·²æ›´æ–°ï¼Œå“ªäº›å¯èƒ½ä¸¢å¤±
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå°† 6 æ¬¡ `ArcSwap` å†™æ“ä½œåˆå¹¶ä¸º 1 æ¬¡

## 6. æ¶æ„å›¾

ä»¥ä¸‹æ¶æ„å›¾å±•ç¤ºäº†æ–¹æ¡ˆ 4+ çš„æ•°æ®æµå‘å’Œåˆå¹¶ç‚¹ï¼š

```mermaid
graph TD
    subgraph CAN_Bus["CAN æ€»çº¿"]
        F_Pos["ä½ç½®å¸§ç»„<br/>0x2A5-0x2A7<br/>3 å¸§"]
        F_Vel["é€Ÿåº¦å¸§ç»„<br/>0x251-0x256<br/>6 å¸§"]
        F_Status["çŠ¶æ€å¸§<br/>0x2A1<br/>1 å¸§"]
    end

    subgraph IO_Thread_Buffer["IO çº¿ç¨‹ç¼“å†²åŒº"]
        B_Pos["ä½ç½®ç¼“å†²åŒº<br/>ç­‰å¾…å¸§ç»„å®Œæ•´"]
        B_Vel["é€Ÿåº¦ç¼“å†²åŒº<br/>ç­‰å¾… mask=0x3F<br/>æˆ–è¶…æ—¶ 1.2ms"]
    end

    subgraph Shared_State["å…±äº«çŠ¶æ€ï¼ˆArcSwapï¼‰"]
        S_Core["CoreMotionState<br/>ä½ç½®+æœ«ç«¯ä½å§¿<br/>å¸§ç»„åŒæ­¥"]
        S_Dyn["JointDynamicState<br/>é€Ÿåº¦+ç”µæµ<br/>ç»„æäº¤ä¿è¯åŸå­æ€§"]
        S_Ctrl["ControlStatus<br/>æ§åˆ¶çŠ¶æ€<br/>ç«‹å³æäº¤"]
    end

    subgraph User_API["ç”¨æˆ· API"]
        API_Read["get_aligned_motion()<br/>æ£€æŸ¥æ—¶é—´æˆ³å·®å¼‚"]
        API_Calc["åŠ›æ§ç®—æ³•å¾ªç¯"]
    end

    F_Pos -->|"é€å¸§æ›´æ–°"| B_Pos
    B_Pos -->|"å¸§ç»„å®Œæ•´å<br/>åŸå­æäº¤"| S_Core

    F_Vel -->|"é€å¸§æ”¶é›†"| B_Vel
    B_Vel -->|"mask=0x3F æˆ–è¶…æ—¶<br/>åŸå­æäº¤æ‰€æœ‰å…³èŠ‚"| S_Dyn

    F_Status -->|"ç«‹å³æäº¤"| S_Ctrl

    S_Core -.->|"æ— é”è¯»å–"| API_Read
    S_Dyn -.->|"æ— é”è¯»å–"| API_Read
    S_Ctrl -.->|"æ— é”è¯»å–"| API_Read

    API_Read -->|"æ—¶é—´å¯¹é½çš„çŠ¶æ€"| API_Calc

    style S_Core fill:#e1f5ff
    style S_Dyn fill:#fff4e1
    style S_Ctrl fill:#f0f0f0
    style B_Vel fill:#ffe1e1
```

**å…³é”®è®¾è®¡ç‚¹**ï¼š
- **ä½ç½®æ•°æ®**ï¼šå¸§ç»„åŒæ­¥ï¼Œç­‰å¾… 3 å¸§å®Œæ•´åä¸€æ¬¡æ€§æäº¤
- **é€Ÿåº¦æ•°æ®**ï¼šç¼“å†²æ”¶é›†ï¼Œç­‰å¾… 6 å¸§é›†é½æˆ–è¶…æ—¶åä¸€æ¬¡æ€§æäº¤ï¼ˆä¿è¯åŸå­æ€§ï¼‰
- **æ§åˆ¶çŠ¶æ€**ï¼šç‹¬ç«‹å¸§ï¼Œç«‹å³æäº¤ï¼ˆæ›´æ–°é¢‘ç‡ä½ï¼Œå½±å“å°ï¼‰
- **ç”¨æˆ· API**ï¼šæä¾›æ—¶é—´å¯¹é½æ£€æŸ¥ï¼Œç¡®ä¿ä½ç½®å’Œé€Ÿåº¦çš„æ—¶é—´æˆ³å·®å¼‚åœ¨å¯æ¥å—èŒƒå›´å†…

## 7. æ€»ç»“

### 7.1. å…³é”®ç»“è®º

1. **é—®é¢˜ç¡®å®å­˜åœ¨**ï¼šä¸åŒå­—æ®µæ¥è‡ªä¸åŒçš„ CAN å¸§ï¼Œæ—¶é—´æˆ³å¯èƒ½ä¸åŒæ­¥ï¼ˆå·®å¼‚å¯è¾¾æ•°æ¯«ç§’ï¼‰
2. **çŠ¶æ€æ’•è£‚é£é™©**ï¼š`JointDynamicState` å¦‚æœå•å¸§ç«‹å³æ›´æ–°ï¼Œä¼šå¯¼è‡´ 6 ä¸ªå…³èŠ‚çš„é€Ÿåº¦æ¥è‡ªä¸åŒæ—¶åˆ»
3. **å¯¹åŠ›æ§ç®—æ³•æœ‰å½±å“**ï¼šç‰¹åˆ«æ˜¯å…³èŠ‚ä½ç½®å’Œå…³èŠ‚é€Ÿåº¦ä¸åŒæ­¥ï¼Œä¼šå¯¼è‡´æ§åˆ¶è¯¯å·®å’ŒåŠ›çŸ©éœ‡è¡
4. **éœ€è¦æ‹†åˆ†çŠ¶æ€**ï¼šæŒ‰æ—¶é—´åŒæ­¥æ€§æ‹†åˆ†ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æŒ‰é¢‘ç‡æ‹†åˆ†
5. **æ¨èæ–¹æ¡ˆ 4+**ï¼šæ··åˆæ–¹æ¡ˆ + Buffered Commit Strategyï¼Œè§£å†³å†…éƒ¨ä¸åŒæ­¥é—®é¢˜

### 7.2. æ–¹æ¡ˆ 4+ çš„æ ¸å¿ƒä¼˜åŠ¿

1. **åŸå­æ€§ä¿è¯**ï¼šé€šè¿‡ Group Commit æœºåˆ¶ï¼Œé¿å… `JointDynamicState` å†…éƒ¨çš„çŠ¶æ€æ’•è£‚
2. **æ—¶é—´åŒæ­¥æ€§**ï¼šæ¯ä¸ªå­çŠ¶æ€å†…çš„å­—æ®µéƒ½æ˜¯åŒæ­¥çš„ï¼Œé¿å…æ—¶é—´ä¸åŒæ­¥å¯¼è‡´çš„æ§åˆ¶è¯¯å·®
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå°† 6 æ¬¡ `ArcSwap` å†™æ“ä½œåˆå¹¶ä¸º 1 æ¬¡ï¼Œå‡å°‘ cache thrashing
4. **å®¹é”™æ€§**ï¼šé€šè¿‡è¶…æ—¶æœºåˆ¶å’Œ `valid_mask`ï¼Œå¤„ç†ä¸¢å¸§æƒ…å†µ
5. **ç²¾ç¡®çš„æ—¶é—´æˆ³**ï¼šæ¯ä¸ªå­çŠ¶æ€éƒ½æœ‰è‡ªå·±çš„æ—¶é—´æˆ³ï¼Œç”¨æˆ·å¯ä»¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸ
6. **çµæ´»æ€§**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è¯»å–ç‰¹å®šå­çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„ Clone

### 7.3. å®æ–½ä¼˜å…ˆçº§

**é«˜ä¼˜å…ˆçº§**ï¼ˆç›´æ¥å½±å“æ§åˆ¶ç¨³å®šæ€§ï¼‰ï¼š
1. âœ… æ‹†åˆ† `CoreMotionState`ï¼ˆå…³èŠ‚ä½ç½® + æœ«ç«¯ä½å§¿ï¼Œå¸§ç»„åŒæ­¥ï¼‰
2. âœ… æ‹†åˆ† `JointDynamicState`ï¼ˆå…³èŠ‚é€Ÿåº¦ + ç”µæµï¼Œç‹¬ç«‹å¸§ï¼‰
3. âœ… **å®æ–½ Buffered Commit æœºåˆ¶**ï¼ˆå…³é”®ï¼é¿å…çŠ¶æ€æ’•è£‚ï¼‰
4. âœ… è°ƒæ•´ Frame Commit é€»è¾‘ï¼Œä¸ºæ¯ä¸ªå­çŠ¶æ€ç‹¬ç«‹ç»´æŠ¤æ—¶é—´æˆ³
5. âœ… æ·»åŠ  `valid_mask` å’Œ `timestamps` æ•°ç»„ï¼ˆæ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼‰

**ä¸­ä¼˜å…ˆçº§**ï¼ˆå½±å“çŠ¶æ€æ£€æŸ¥ï¼‰ï¼š
1. âš ï¸ æ‹†åˆ† `ControlStatusState`ï¼ˆæ§åˆ¶çŠ¶æ€ï¼Œä½é¢‘ï¼‰
2. âš ï¸ è°ƒæ•´ DiagnosticState çš„æ—¶é—´æˆ³å¤„ç†
3. âš ï¸ å®ç° `get_aligned_motion()` APIï¼ˆæ—¶é—´å¯¹é½æ£€æŸ¥ï¼‰

**ä½ä¼˜å…ˆçº§**ï¼ˆä¸å½±å“å®æ—¶æ§åˆ¶ï¼‰ï¼š
1. ğŸ’¡ æ·»åŠ ç»„åˆ APIï¼ˆå‘åå…¼å®¹ï¼‰
2. ğŸ’¡ æ·»åŠ æ—¶é—´æˆ³æ£€æŸ¥ APIï¼ˆ`is_stale()`, `is_complete()`ï¼‰

### 7.4. é¢„æœŸæ”¶ç›Š

1. **æ¶ˆé™¤çŠ¶æ€æ’•è£‚**ï¼š`JointDynamicState` å†…çš„ 6 ä¸ªå…³èŠ‚æ•°æ®æ¥è‡ªåŒä¸€ CAN ä¼ è¾“å‘¨æœŸ
2. **æ—¶é—´åŒæ­¥æ€§**ï¼šæ¯ä¸ªå­çŠ¶æ€å†…çš„å­—æ®µéƒ½æ˜¯åŒæ­¥çš„ï¼Œé¿å…æ§åˆ¶è¯¯å·®
3. **ç²¾ç¡®çš„æ—¶é—´æˆ³**ï¼šæ¯ä¸ªå­çŠ¶æ€éƒ½æœ‰è‡ªå·±çš„æ—¶é—´æˆ³ï¼Œç”¨æˆ·å¯ä»¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘ `ArcSwap` å†™æ“ä½œæ¬¡æ•°ï¼Œé™ä½ cache thrashing
5. **å®¹é”™æ€§**ï¼šé€šè¿‡ `valid_mask` å’Œè¶…æ—¶æœºåˆ¶ï¼Œå¤„ç†ä¸¢å¸§æƒ…å†µ
6. **çµæ´»æ€§**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è¯»å–ç‰¹å®šå­çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„ Clone

### 7.5. è®¾è®¡åŸåˆ™æ€»ç»“

1. **ç‰©ç†æ˜ å°„å‡†ç¡®**ï¼šæ‰¿è®¤ç¡¬ä»¶çš„å±€é™æ€§ï¼Œä½ç½®æ•°æ®ï¼ˆå¸§ç»„ï¼‰å’Œé€Ÿåº¦æ•°æ®ï¼ˆç‹¬ç«‹å¸§ï¼‰åœ¨ç‰©ç†é“¾è·¯ä¸Šå°±æ˜¯ä¸åŒæ­¥çš„
2. **åŸå­æ€§ä¼˜å…ˆ**ï¼šå®å¯å¾®ç§’çº§å»¶è¿Ÿï¼Œä¹Ÿè¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆé¿å…çŠ¶æ€æ’•è£‚ï¼‰
3. **æ—¶é—´æˆ³æ˜¾å¼åŒ–**ï¼šä¸è¦éšè—æ—¶é—´æˆ³å·®å¼‚ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥å’Œå¤„ç†
4. **æ€§èƒ½ä¸æ­£ç¡®æ€§å¹³è¡¡**ï¼šé€šè¿‡ Group Commit æœºåˆ¶ï¼Œåœ¨ä¿è¯æ­£ç¡®æ€§çš„åŒæ—¶ä¼˜åŒ–æ€§èƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024-12
**åˆ†æäºº**: Driver æ¨¡å—è®¾è®¡å›¢é˜Ÿ

