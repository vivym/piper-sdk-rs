# SocketCAN é€‚é…å±‚å®ç° TODO List

> åŸºäº `socketcan/implementation_plan.md` çš„å®ç°æ¸…å•
> **æ ¸å¿ƒåŸåˆ™ï¼šæµ‹è¯•ä¼˜å…ˆï¼Œç¡®ä¿æ­£ç¡®æ€§**

## ğŸ“Š æ•´ä½“è¿›åº¦

| Phase | çŠ¶æ€ | è¿›åº¦ | æµ‹è¯•çŠ¶æ€ | å¤‡æ³¨ |
|-------|------|------|----------|------|
| Phase 0: ç¯å¢ƒå‡†å¤‡ | âœ… å·²å®Œæˆ | 100% | - | vcan0 æ¥å£å·²åˆ›å»º |
| Phase 1: åŸºç¡€å®ç° | âœ… å·²å®Œæˆ | 100% | 11/11 | æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œå·²é›†æˆåˆ° PiperBuilder |
| Phase 2: é”™è¯¯å¤„ç† | ğŸ”„ è¿›è¡Œä¸­ | 60% | 0/5 | é”™è¯¯å¸§è§£æå·²å®ç° |
| Phase 3: æ—¶é—´æˆ³æ”¯æŒ | â³ å¾…å¼€å§‹ | 0% | 0/4 | æ—¶é—´æˆ³æå– |
| Phase 4: é›†æˆä¸æµ‹è¯• | â³ å¾…å¼€å§‹ | 0% | 0/10 | å®Œæ•´æµ‹è¯•å¥—ä»¶ |
| Phase 5: ä¸ GS-USB ä¸€è‡´æ€§éªŒè¯ | â³ å¾…å¼€å§‹ | 0% | 0/6 | è·¨å¹³å°è¡Œä¸ºä¸€è‡´æ€§ |

**æœ€åæ›´æ–°**ï¼š2024-12ï¼ˆåˆå§‹åˆ›å»ºï¼‰

---

## ğŸ¯ å¼€å‘åŸåˆ™ï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰

### 1. æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰

**æµç¨‹**ï¼šçº¢-ç»¿-é‡æ„ï¼ˆRed-Green-Refactorï¼‰
- ğŸ”´ **Red**ï¼šå…ˆå†™å¤±è´¥çš„æµ‹è¯•
- ğŸŸ¢ **Green**ï¼šå®ç°æœ€ç®€ä»£ç ä½¿æµ‹è¯•é€šè¿‡
- ğŸ”µ **Refactor**ï¼šé‡æ„ä¼˜åŒ–ä»£ç ï¼Œç¡®ä¿æµ‹è¯•ä»é€šè¿‡

**è¦æ±‚**ï¼š
- **æ¯ä¸ªåŠŸèƒ½å¿…é¡»å…ˆå†™æµ‹è¯•ï¼Œå†å®ç°ä»£ç **
- **æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼šâ‰¥ 90%**
- **æ‰€æœ‰æµ‹è¯•é€šè¿‡åæ‰èƒ½æäº¤ä»£ç **

### 2. æµ‹è¯•å±‚çº§ä¼˜å…ˆçº§

```
å•å…ƒæµ‹è¯•ï¼ˆUnit Testsï¼‰ > é›†æˆæµ‹è¯•ï¼ˆIntegration Testsï¼‰ > ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆE2Eï¼‰
```

**æ‰§è¡Œé¡ºåº**ï¼š
1. å•å…ƒæµ‹è¯•ï¼šéªŒè¯å•ä¸ªå‡½æ•°/æ–¹æ³•çš„è¡Œä¸º
2. é›†æˆæµ‹è¯•ï¼šéªŒè¯æ¨¡å—é—´çš„äº¤äº’
3. ç«¯åˆ°ç«¯æµ‹è¯•ï¼šéªŒè¯å®Œæ•´æµç¨‹ï¼ˆä¸ GS-USB å¯¹æ¯”ï¼‰

### 3. æ­£ç¡®æ€§ä¿è¯

**æ¯ä¸ªä»»åŠ¡å¿…é¡»å®Œæˆä»¥ä¸‹æ£€æŸ¥**ï¼š

- âœ… **åŠŸèƒ½æ­£ç¡®æ€§**ï¼šåŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
- âœ… **è¾¹ç•Œæ¡ä»¶**ï¼šå¤„ç†æç«¯æƒ…å†µï¼ˆç©ºæ•°æ®ã€æœ€å¤§é•¿åº¦ç­‰ï¼‰
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰é”™è¯¯è·¯å¾„éƒ½æœ‰æµ‹è¯•è¦†ç›–
- âœ… **èµ„æºç®¡ç†**ï¼šç¡®ä¿æ²¡æœ‰å†…å­˜æ³„æ¼ã€èµ„æºæ³„æ¼
- âœ… **çº¿ç¨‹å®‰å…¨**ï¼šå¦‚æœæœ‰å¹¶å‘ï¼ŒéªŒè¯çº¿ç¨‹å®‰å…¨
- âœ… **æ€§èƒ½åŸºå‡†**ï¼šå…³é”®è·¯å¾„çš„æ€§èƒ½æµ‹è¯•

### 4. æµ‹è¯•ç¯å¢ƒè¦æ±‚

**å¿…éœ€ç¯å¢ƒ**ï¼š
- Linux ç³»ç»Ÿï¼ˆArch/Ubuntu/Debian ç­‰ï¼‰
- è™šæ‹Ÿ CAN æ¥å£ï¼ˆ`vcan0`ï¼‰ç”¨äºæµ‹è¯•
- root æƒé™ï¼ˆç”¨äºåˆ›å»ºè™šæ‹Ÿæ¥å£ï¼‰

**è®¾ç½®å‘½ä»¤**ï¼š
```bash
# åŠ è½½ vcan æ¨¡å—
sudo modprobe vcan

# åˆ›å»ºè™šæ‹Ÿæ¥å£
sudo ip link add dev vcan0 type vcan
sudo ip link set up vcan0

# éªŒè¯æ¥å£
ip link show vcan0
```

---

## Phase 0: ç¯å¢ƒå‡†å¤‡ï¼ˆ30 åˆ†é’Ÿï¼‰

### Task 0.1: æµ‹è¯•ç¯å¢ƒè®¾ç½® âœ…

**ç›®æ ‡**ï¼šå»ºç«‹å¯é‡å¤çš„æµ‹è¯•ç¯å¢ƒ

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] åœ¨ Linux ç³»ç»Ÿä¸Šè®¾ç½®è™šæ‹Ÿ CAN æ¥å£ï¼ˆ`vcan0`ï¼‰
- [x] éªŒè¯ `socketcan` crate ä¾èµ–å·²æ­£ç¡®æ·»åŠ 
- [ ] åˆ›å»ºæµ‹è¯•è„šæœ¬ç”¨äºå‘é€/æ¥æ”¶æµ‹è¯•å¸§ï¼ˆå¯é€‰ï¼Œç”¨äºæ‰‹åŠ¨æµ‹è¯•ï¼‰
- [ ] ç¼–å†™ç¯å¢ƒæ£€æŸ¥è„šæœ¬ï¼ˆæ£€æŸ¥ `vcan0` æ˜¯å¦å­˜åœ¨ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å¯ä»¥é€šè¿‡ `ip link show vcan0` çœ‹åˆ°æ¥å£çŠ¶æ€ä¸º UP
- âœ… å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ `candump vcan0` å’Œ `cansend vcan0` å·¥å…·ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
- âœ… Rust é¡¹ç›®å¯ä»¥ç¼–è¯‘å¹¶æ‰¾åˆ° `socketcan` crate

**æµ‹è¯•ä»£ç **ï¼ˆç¯å¢ƒæ£€æŸ¥ï¼‰ï¼š
```rust
#[cfg(test)]
mod env_tests {
    #[test]
    #[cfg(target_os = "linux")]
    fn test_vcan0_exists() {
        use std::process::Command;
        let output = Command::new("ip")
            .args(&["link", "show", "vcan0"])
            .output();
        assert!(output.is_ok(), "vcan0 interface should exist");
    }
}
```

---

## Phase 1: åŸºç¡€å®ç°ï¼ˆ2-3 å°æ—¶ï¼‰

### Task 1.1: åˆ›å»ºæ¨¡å—ç»“æ„ âœ…

**ç›®æ ‡**ï¼šå»ºç«‹ SocketCAN æ¨¡å—çš„ç›®å½•ç»“æ„

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] åˆ›å»º `src/can/socketcan/mod.rs` æ–‡ä»¶
- [x] æ·»åŠ æ¨¡å—æ–‡æ¡£æ³¨é‡Šï¼ˆè¯´æ˜ç”¨é€”ã€ä¾èµ–ã€é™åˆ¶ï¼‰
- [x] æ·»åŠ å¿…è¦çš„ `use` è¯­å¥ï¼ˆ`socketcan`, `CanAdapter`, `CanError`, `PiperFrame`ï¼‰
- [x] æ·»åŠ  `#[cfg(target_os = "linux")]` æ¡ä»¶ç¼–è¯‘

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ¨¡å—æ–‡ä»¶å­˜åœ¨ä¸”ç»“æ„æ­£ç¡®
- âœ… ä»£ç å¯ä»¥ç¼–è¯‘ï¼ˆå³ä½¿åŠŸèƒ½æœªå®ç°ï¼‰

**å‚è€ƒ**ï¼š`src/can/gs_usb/mod.rs`

---

### Task 1.2: å®ç° `SocketCanAdapter::new()` â³

**ç›®æ ‡**ï¼šåˆ›å»º SocketCAN é€‚é…å™¨å®ä¾‹

**æµ‹è¯•ä¼˜å…ˆ**ï¼ˆå…ˆå†™è¿™äº›æµ‹è¯•ï¼‰ï¼š

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_socketcan_adapter_new_success() {
        let adapter = SocketCanAdapter::new("vcan0");
        assert!(adapter.is_ok());
    }

    #[test]
    fn test_socketcan_adapter_new_invalid_interface() {
        let adapter = SocketCanAdapter::new("nonexistent_can99");
        assert!(adapter.is_err());
        match adapter.unwrap_err() {
            CanError::Device(msg) => assert!(msg.contains("nonexistent_can99")),
            _ => panic!("Expected Device error"),
        }
    }

    #[test]
    fn test_socketcan_adapter_new_stores_interface_name() {
        let adapter = SocketCanAdapter::new("vcan0").unwrap();
        assert_eq!(adapter.interface(), "vcan0"); // éœ€è¦æ·»åŠ  getter
    }

    #[test]
    fn test_socketcan_adapter_new_sets_read_timeout() {
        let adapter = SocketCanAdapter::new("vcan0").unwrap();
        // éªŒè¯é»˜è®¤è¶…æ—¶æ—¶é—´å·²è®¾ç½®ï¼ˆ100msï¼‰
        assert_eq!(adapter.read_timeout(), Duration::from_millis(100));
    }

    #[test]
    fn test_socketcan_adapter_new_sets_started_true() {
        let adapter = SocketCanAdapter::new("vcan0").unwrap();
        assert!(adapter.is_started()); // éœ€è¦æ·»åŠ  getter
    }
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] å®ç° `new(interface: impl Into<String>) -> Result<Self, CanError>`
- [ ] è°ƒç”¨ `CanSocket::open()` æ‰“å¼€æ¥å£
- [ ] è®¾ç½®é»˜è®¤è¯»è¶…æ—¶ï¼ˆ100msï¼‰
- [ ] è®¾ç½® `started = true`ï¼ˆSocketCAN æ‰“å¼€å³å¯åŠ¨ï¼‰
- [ ] é”™è¯¯å¤„ç†ï¼šæ¥å£ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ç­‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ5/5ï¼‰
- âœ… é”™è¯¯æ¶ˆæ¯æ¸…æ™°ï¼ŒåŒ…å«æ¥å£åç§°
- âœ… è¶…æ—¶æ—¶é—´æ­£ç¡®è®¾ç½®

---

### Task 1.3: å®ç° `CanAdapter::send()` â³

**ç›®æ ‡**ï¼šå‘é€ CAN å¸§åˆ°æ€»çº¿

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
fn test_socketcan_adapter_send_standard_frame() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();
    let frame = PiperFrame::new_standard(0x123, &[1, 2, 3, 4]);

    let result = adapter.send(frame);
    assert!(result.is_ok());
}

#[test]
fn test_socketcan_adapter_send_extended_frame() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();
    let frame = PiperFrame::new_extended(0x12345678, &[0xFF; 8]);

    let result = adapter.send(frame);
    assert!(result.is_ok());
}

#[test]
fn test_socketcan_adapter_send_empty_frame() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();
    let frame = PiperFrame::new_standard(0x123, &[]);

    let result = adapter.send(frame);
    assert!(result.is_ok());
}

#[test]
fn test_socketcan_adapter_send_not_started() {
    // éœ€è¦æ·»åŠ æœºåˆ¶æ¥æ¨¡æ‹Ÿæœªå¯åŠ¨çŠ¶æ€ï¼ˆæˆ–ç›´æ¥ä¸è®¾ç½® startedï¼‰
    // è¿™å¯èƒ½éœ€è¦é‡æ„æˆ–ä½¿ç”¨ mock
    // å…ˆæ ‡è®°ä¸º TODOï¼Œåç»­å®Œå–„
}

#[test]
fn test_socketcan_adapter_send_invalid_id() {
    // æµ‹è¯•æ— æ•ˆçš„ CAN IDï¼ˆå¦‚è¶…è¿‡æ ‡å‡†å¸§èŒƒå›´çš„æ‰©å±•å¸§ï¼‰
    // æ³¨æ„ï¼šsocketcan-rs å¯èƒ½å·²ç»åœ¨åº•å±‚å¤„ç†ï¼Œéœ€è¦éªŒè¯
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] æ£€æŸ¥ `started` çŠ¶æ€ï¼ˆæœªå¯åŠ¨è¿”å› `CanError::NotStarted`ï¼‰
- [ ] è½¬æ¢ `PiperFrame` -> `CanFrame`
  - [ ] æ ‡å‡†å¸§ï¼šä½¿ç”¨ `StandardId::new()`
  - [ ] æ‰©å±•å¸§ï¼šä½¿ç”¨ `ExtendedId::new()`
- [ ] è°ƒç”¨ `socket.transmit(&can_frame)`
- [ ] é”™è¯¯å¤„ç†ï¼šè½¬æ¢é”™è¯¯åˆ° `CanError`

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆâ‰¥ 3/5ï¼Œéƒ¨åˆ†æµ‹è¯•å¯èƒ½éœ€è¦å®Œå–„ï¼‰
- âœ… æ ‡å‡†å¸§å’Œæ‰©å±•å¸§éƒ½èƒ½æ­£ç¡®å‘é€
- âœ… é”™è¯¯å¤„ç†æ­£ç¡®

**éªŒè¯æ–¹æ³•**ï¼š
- ä½¿ç”¨ `candump vcan0` è§‚å¯Ÿå‘é€çš„å¸§ï¼ˆæ‰‹åŠ¨éªŒè¯ï¼‰

---

### Task 1.4: å®ç° `CanAdapter::receive()`ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰â³

**ç›®æ ‡**ï¼šä»æ€»çº¿æ¥æ”¶ CAN å¸§ï¼ˆå…ˆä¸å¤„ç†é”™è¯¯å¸§ï¼‰

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
fn test_socketcan_adapter_receive_standard_frame() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    // å…ˆå‘é€ä¸€ä¸ªå¸§ï¼ˆå¦ä¸€ä¸ªçº¿ç¨‹æˆ–å¤–éƒ¨å·¥å…·ï¼‰
    let tx_frame = PiperFrame::new_standard(0x123, &[1, 2, 3, 4]);
    adapter.send(tx_frame).unwrap();

    // æ¥æ”¶å¸§
    let rx_frame = adapter.receive().unwrap();
    assert_eq!(rx_frame.id, 0x123);
    assert_eq!(rx_frame.data[..4], [1, 2, 3, 4]);
    assert_eq!(rx_frame.len, 4);
    assert!(!rx_frame.is_extended);
}

#[test]
fn test_socketcan_adapter_receive_extended_frame() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    let tx_frame = PiperFrame::new_extended(0x12345678, &[0xFF; 8]);
    adapter.send(tx_frame).unwrap();

    let rx_frame = adapter.receive().unwrap();
    assert_eq!(rx_frame.id, 0x12345678);
    assert!(rx_frame.is_extended);
}

#[test]
fn test_socketcan_adapter_receive_timeout() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    // è®¾ç½®çŸ­è¶…æ—¶ï¼ˆ10msï¼‰
    adapter.set_read_timeout(Duration::from_millis(10)).unwrap();

    // ä¸å‘é€ä»»ä½•å¸§ï¼Œåº”è¯¥è¶…æ—¶
    let result = adapter.receive();
    assert!(result.is_err());
    match result.unwrap_err() {
        CanError::Timeout => {},
        _ => panic!("Expected Timeout error"),
    }
}

#[test]
fn test_socketcan_adapter_receive_not_started() {
    // TODO: éœ€è¦æ¨¡æ‹Ÿæœªå¯åŠ¨çŠ¶æ€
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] æ£€æŸ¥ `started` çŠ¶æ€
- [ ] è°ƒç”¨ `socket.read_frame_timeout(timeout)`
- [ ] å¤„ç†è¶…æ—¶é”™è¯¯ï¼ˆ`should_retry()` -> `CanError::Timeout`ï¼‰
- [ ] è½¬æ¢ `CanFrame` -> `PiperFrame`
- [ ] å¤„ç† IO é”™è¯¯

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆâ‰¥ 3/5ï¼‰
- âœ… è¶…æ—¶å¤„ç†æ­£ç¡®
- âœ… å¸§è½¬æ¢æ­£ç¡®ï¼ˆIDã€æ•°æ®ã€é•¿åº¦ã€æ‰©å±•æ ‡å¿—ï¼‰

**æ³¨æ„äº‹é¡¹**ï¼š
- å½“å‰ç‰ˆæœ¬**ä¸å¤„ç†é”™è¯¯å¸§**ï¼Œå°†åœ¨ Phase 2 å®ç°
- æµ‹è¯•å¯èƒ½éœ€è¦ `vcan0` å›ç¯æ¨¡å¼ï¼ˆ`ip link set vcan0 up type vcan`ï¼‰

---

### Task 1.5: æ›´æ–°æ¨¡å—å¯¼å‡º â³

**ç›®æ ‡**ï¼šåœ¨ `can/mod.rs` ä¸­å¯¼å‡º SocketCAN æ¨¡å—

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åœ¨ `src/can/mod.rs` ä¸­æ·»åŠ æ¡ä»¶ç¼–è¯‘ï¼š
  ```rust
  #[cfg(target_os = "linux")]
  pub mod socketcan;

  #[cfg(target_os = "linux")]
  pub use socketcan::SocketCanAdapter;
  ```
- [ ] éªŒè¯ä»£ç åœ¨ Linux ä¸Šç¼–è¯‘é€šè¿‡
- [ ] éªŒè¯ä»£ç åœ¨é Linux å¹³å°ä¸Šä¸åŒ…å« SocketCAN ä»£ç 

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… `cargo check --target x86_64-unknown-linux-gnu` é€šè¿‡
- âœ… `cargo check --target x86_64-apple-darwin` ä¸åŒ…å« SocketCAN ä»£ç 
- âœ… `cargo build` åœ¨ Linux ä¸ŠæˆåŠŸ

---

### Task 1.6: é›†æˆåˆ° PiperBuilder âœ…

**ç›®æ ‡**ï¼šåœ¨ `robot/builder.rs` ä¸­ä½¿ç”¨ SocketCAN é€‚é…å™¨

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] æ›´æ–° `src/robot/builder.rs` ä¸­çš„ `#[cfg(target_os = "linux")]` åˆ†æ”¯
- [x] å®ç° `SocketCanAdapter::new(interface)`
- [x] è°ƒç”¨ `configure()`ï¼ˆå¯é€‰ï¼Œç”¨äºéªŒè¯æ¥å£çŠ¶æ€ï¼‰
- [x] åˆ›å»º `Piper` å®ä¾‹

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
#[cfg(target_os = "linux")]
fn test_piper_builder_with_socketcan() {
    let piper = PiperBuilder::new()
        .interface("vcan0")
        .build();
    assert!(piper.is_ok());
}

#[test]
#[cfg(target_os = "linux")]
fn test_piper_builder_socketcan_default_interface() {
    // æµ‹è¯•é»˜è®¤æ¥å£ "can0"ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼Œåº”è¯¥ä½¿ç”¨ vcan0ï¼‰
    let piper = PiperBuilder::new().build();
    // å¯èƒ½å¤±è´¥ï¼Œå–å†³äºç³»ç»Ÿé…ç½®
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… `PiperBuilder::new().interface("vcan0").build()` æˆåŠŸ
- âœ… é Linux å¹³å°ä¸Šä»ä½¿ç”¨ GS-USB é€‚é…å™¨

---

### Phase 1 éªŒæ”¶æµ‹è¯• â³

**ç›®æ ‡**ï¼šéªŒè¯ Phase 1 çš„æ‰€æœ‰åŠŸèƒ½

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼ˆ`cargo test --lib`ï¼‰
- [ ] è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆ`cargo test --test socketcan_integration`ï¼Œå¦‚æœå·²åˆ›å»ºï¼‰
- [ ] æ‰‹åŠ¨æµ‹è¯•ï¼šä½¿ç”¨ `candump` å’Œ `cansend` å·¥å…·éªŒè¯å‘é€/æ¥æ”¶
- [ ] ä»£ç æ ¼å¼åŒ–ï¼ˆ`cargo fmt`ï¼‰
- [ ] ä»£ç æ£€æŸ¥ï¼ˆ`cargo clippy`ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ—  Clippy è­¦å‘Š
- âœ… ä»£ç ç¬¦åˆé¡¹ç›®é£æ ¼

---

## Phase 2: é”™è¯¯å¤„ç†ï¼ˆ1-2 å°æ—¶ï¼‰

### Task 2.1: é”™è¯¯å¸§è¿‡æ»¤ â³

**ç›®æ ‡**ï¼šè¿‡æ»¤ SocketCAN æ¥æ”¶åˆ°çš„é”™è¯¯å¸§

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
fn test_socketcan_adapter_receive_filters_error_frames() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    // æ³¨æ„ï¼šé”™è¯¯å¸§é€šå¸¸ç”±å†…æ ¸ç”Ÿæˆï¼Œéš¾ä»¥æ‰‹åŠ¨åˆ›å»º
    // å¯ä»¥é€šè¿‡ç‰¹å®šæ¡ä»¶è§¦å‘ï¼ˆå¦‚æ€»çº¿é”™è¯¯ï¼‰
    // æˆ–è€…ä½¿ç”¨ mock/stub æ¨¡æ‹Ÿé”™è¯¯å¸§

    // TODO: ç ”ç©¶å¦‚ä½•ç”Ÿæˆé”™è¯¯å¸§ç”¨äºæµ‹è¯•
    // å¯èƒ½çš„æ–¹æ³•ï¼š
    // 1. æ¨¡æ‹Ÿ CanFrame ä¸ºé”™è¯¯å¸§ï¼ˆéœ€è¦åº•å±‚ APIï¼‰
    // 2. ä½¿ç”¨ç‰¹å®šçš„æ€»çº¿é”™è¯¯æ¡ä»¶
    // 3. ä½¿ç”¨æµ‹è¯•å·¥å…·ç”Ÿæˆé”™è¯¯å¸§
}

#[test]
fn test_socketcan_adapter_receive_skips_error_frames() {
    // éªŒè¯ï¼šå¦‚æœæ”¶åˆ°é”™è¯¯å¸§ï¼Œä¼šè·³è¿‡å¹¶ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªæœ‰æ•ˆå¸§
    // éœ€è¦æ¨¡æ‹Ÿï¼šé”™è¯¯å¸§ -> æœ‰æ•ˆå¸§ -> æœ‰æ•ˆå¸§
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] åœ¨ `receive()` ä¸­æ·»åŠ é”™è¯¯å¸§æ£€æµ‹
- [ ] ä½¿ç”¨ `can_frame.is_error_frame()` æ£€æŸ¥
- [ ] è·³è¿‡é”™è¯¯å¸§ï¼Œç»§ç»­å¾ªç¯è¯»å–
- [ ] è®°å½•é”™è¯¯å¸§æ—¥å¿—ï¼ˆä½¿ç”¨ `tracing::warn!`ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… é”™è¯¯å¸§è¢«æ­£ç¡®è¿‡æ»¤ï¼ˆä¸è¿”å›ç»™ä¸Šå±‚ï¼‰
- âœ… é”™è¯¯å¸§åä»èƒ½æ­£å¸¸æ¥æ”¶æœ‰æ•ˆå¸§
- âœ… æ—¥å¿—è®°å½•æ­£ç¡®

---

### Task 2.2: é”™è¯¯å¸§è§£æï¼ˆåŸºç¡€ï¼‰ â³

**ç›®æ ‡**ï¼šè§£æé”™è¯¯å¸§ç±»å‹ï¼Œæ˜ å°„åˆ° `CanError`

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
fn test_socketcan_adapter_parse_bus_off_error() {
    // æµ‹è¯• Bus Off é”™è¯¯å¸§è§£æ
    // æ³¨æ„ï¼šéœ€è¦èƒ½å¤Ÿç”Ÿæˆæˆ–æ¨¡æ‹Ÿ Bus Off é”™è¯¯å¸§
}

#[test]
fn test_socketcan_adapter_parse_buffer_overflow_error() {
    // æµ‹è¯•ç¼“å†²åŒºæº¢å‡ºé”™è¯¯å¸§è§£æ
}

#[test]
fn test_socketcan_adapter_error_frame_logging() {
    // éªŒè¯é”™è¯¯å¸§è¢«è®°å½•åˆ°æ—¥å¿—
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] ç ”ç©¶ `socketcan-rs` çš„é”™è¯¯å¸§ APIï¼ˆ`CanErrorFrame`ï¼‰
- [ ] å®ç°é”™è¯¯å¸§ç±»å‹æ£€æµ‹ï¼ˆBus Offã€Overflow ç­‰ï¼‰
- [ ] æ˜ å°„åˆ° `CanError`ï¼ˆ`BusOff`, `BufferOverflow` ç­‰ï¼‰
- [ ] æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… é”™è¯¯å¸§ç±»å‹èƒ½æ­£ç¡®è¯†åˆ«
- âœ… é”™è¯¯ç±»å‹æ˜ å°„æ­£ç¡®
- âœ… æ—¥å¿—ä¿¡æ¯è¯¦ç»†

**å‚è€ƒ**ï¼š
- `socketcan-rs` çš„ `CanErrorFrame` æ–‡æ¡£
- Linux SocketCAN é”™è¯¯å¸§æ ¼å¼

---

### Task 2.3: å®Œå–„é”™è¯¯ç±»å‹æ˜ å°„ â³

**ç›®æ ‡**ï¼šç¡®ä¿æ‰€æœ‰ socketcan-rs é”™è¯¯éƒ½æ­£ç¡®æ˜ å°„åˆ° `CanError`

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ—å‡ºæ‰€æœ‰ `socketcan-rs` å¯èƒ½çš„é”™è¯¯ç±»å‹
- [ ] ä¸ºæ¯ä¸ªé”™è¯¯ç±»å‹ç¼–å†™æ˜ å°„è§„åˆ™
- [ ] å®ç° `From<socketcan::Error>` for `CanError`ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] ç¼–å†™æµ‹è¯•è¦†ç›–æ‰€æœ‰é”™è¯¯è·¯å¾„

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] IO é”™è¯¯æ˜ å°„
- [ ] æ„é€ é”™è¯¯æ˜ å°„
- [ ] è¶…æ—¶é”™è¯¯æ˜ å°„
- [ ] è®¾å¤‡é”™è¯¯æ˜ å°„

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰é”™è¯¯ç±»å‹éƒ½æœ‰å¯¹åº”çš„æ˜ å°„
- âœ… é”™è¯¯æ¶ˆæ¯æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯•

---

### Phase 2 éªŒæ”¶æµ‹è¯• â³

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… é”™è¯¯å¸§è¢«æ­£ç¡®è¿‡æ»¤
- âœ… é”™è¯¯ç±»å‹æ˜ å°„æ­£ç¡®
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ5/5 æˆ–æ›´å¤šï¼‰

---

## Phase 3: æ—¶é—´æˆ³æ”¯æŒï¼ˆ2-3 å°æ—¶ï¼‰

### Task 3.1: ç ”ç©¶æ—¶é—´æˆ³ API â³

**ç›®æ ‡**ï¼šäº†è§£ SocketCAN æ—¶é—´æˆ³çš„å®ç°æ–¹å¼

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] é˜…è¯» `socketcan-rs` æ–‡æ¡£ï¼ŒæŸ¥æ‰¾æ—¶é—´æˆ³ API
- [ ] ç ”ç©¶ Linux SocketCAN æ—¶é—´æˆ³æœºåˆ¶ï¼ˆ`SO_TIMESTAMP`ï¼‰
- [ ] æŸ¥çœ‹ `socketcan-rs` ç¤ºä¾‹ä»£ç ä¸­æ˜¯å¦æœ‰æ—¶é—´æˆ³ä½¿ç”¨ç¤ºä¾‹
- [ ] æµ‹è¯•ç¡¬ä»¶æ—¶é—´æˆ³æ”¯æŒï¼ˆå¦‚æœç¡¬ä»¶æ”¯æŒï¼‰

**ç ”ç©¶é—®é¢˜**ï¼š
- `socketcan-rs` æ˜¯å¦æä¾›æ—¶é—´æˆ³ APIï¼Ÿ
- æ—¶é—´æˆ³æ˜¯è½¯ä»¶æ—¶é—´æˆ³è¿˜æ˜¯ç¡¬ä»¶æ—¶é—´æˆ³ï¼Ÿ
- æ—¶é—´æˆ³çš„å•ä½æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆçº³ç§’ã€å¾®ç§’ã€æ¯«ç§’ï¼‰
- å¦‚ä½•æå–æ—¶é—´æˆ³ï¼Ÿ

**æ–‡æ¡£è®°å½•**ï¼š
- [ ] è®°å½•ç ”ç©¶å‘ç°åˆ° `docs/v0/socketcan/timestamp_research.md`

---

### Task 3.2: å®ç°æ—¶é—´æˆ³æå–ï¼ˆè½¯ä»¶æ—¶é—´æˆ³ï¼‰ â³

**ç›®æ ‡**ï¼šæå– SocketCAN çš„è½¯ä»¶æ—¶é—´æˆ³ï¼ˆå†…æ ¸æä¾›ï¼‰

**æµ‹è¯•ä¼˜å…ˆ**ï¼š

```rust
#[test]
fn test_socketcan_adapter_receive_includes_timestamp() {
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    // å‘é€å¸§
    let tx_frame = PiperFrame::new_standard(0x123, &[1, 2, 3]);
    adapter.send(tx_frame).unwrap();

    // æ¥æ”¶å¸§ï¼Œæ£€æŸ¥æ—¶é—´æˆ³
    let rx_frame = adapter.receive().unwrap();
    assert!(rx_frame.timestamp_us > 0, "Timestamp should be set");
}

#[test]
fn test_socketcan_adapter_timestamp_accuracy() {
    // éªŒè¯æ—¶é—´æˆ³çš„å‡†ç¡®æ€§ï¼ˆå¾®ç§’çº§ç²¾åº¦ï¼‰
    let mut adapter = SocketCanAdapter::new("vcan0").unwrap();

    let start = std::time::Instant::now();
    // ... å‘é€å’Œæ¥æ”¶å¸§
    let end = std::time::Instant::now();

    // æ—¶é—´æˆ³åº”è¯¥ä¸å®é™…æ—¶é—´æ¥è¿‘ï¼ˆå…è®¸ä¸€å®šè¯¯å·®ï¼‰
}
```

**å®ç°æ¸…å•**ï¼š
- [ ] æ ¹æ®ç ”ç©¶ç»“æœå®ç°æ—¶é—´æˆ³æå–
- [ ] è½¬æ¢æ—¶é—´æˆ³å•ä½åˆ°å¾®ç§’ï¼ˆ`timestamp_us`ï¼‰
- [ ] æ›´æ–° `receive()` æ–¹æ³•ï¼Œå¡«å…… `timestamp_us` å­—æ®µ

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ—¶é—´æˆ³è¢«æ­£ç¡®æå–
- âœ… æ—¶é—´æˆ³ç²¾åº¦åˆç†ï¼ˆå¾®ç§’çº§ï¼‰
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ2/2 æˆ–æ›´å¤šï¼‰

---

### Task 3.3: ç¡¬ä»¶æ—¶é—´æˆ³æ”¯æŒï¼ˆå¦‚æœç¡¬ä»¶æ”¯æŒï¼‰ â³

**ç›®æ ‡**ï¼šå¦‚æœç¡¬ä»¶æ”¯æŒï¼Œå¯ç”¨ç¡¬ä»¶æ—¶é—´æˆ³

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ£€æµ‹ç¡¬ä»¶æ˜¯å¦æ”¯æŒæ—¶é—´æˆ³
- [ ] å®ç°ç¡¬ä»¶æ—¶é—´æˆ³æå–ï¼ˆå¦‚æœä¸åŒäºè½¯ä»¶æ—¶é—´æˆ³ï¼‰
- [ ] æµ‹è¯•ç¡¬ä»¶æ—¶é—´æˆ³å‡†ç¡®æ€§

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ç¡¬ä»¶æ—¶é—´æˆ³ï¼ˆå¦‚æœæ”¯æŒï¼‰è¢«æ­£ç¡®æå–
- âœ… ç¡¬ä»¶æ—¶é—´æˆ³ç²¾åº¦é«˜äºè½¯ä»¶æ—¶é—´æˆ³

---

### Task 3.4: æ—¶é—´æˆ³å•å…ƒæµ‹è¯• â³

**ç›®æ ‡**ï¼šå®Œå–„æ—¶é—´æˆ³ç›¸å…³çš„æµ‹è¯•

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] æ—¶é—´æˆ³å­˜åœ¨æ€§æµ‹è¯•
- [ ] æ—¶é—´æˆ³å•è°ƒæ€§æµ‹è¯•ï¼ˆé€’å¢ï¼‰
- [ ] æ—¶é—´æˆ³ç²¾åº¦æµ‹è¯•
- [ ] æ—¶é—´æˆ³å•ä½è½¬æ¢æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æ—¶é—´æˆ³æµ‹è¯•é€šè¿‡ï¼ˆ4/4ï¼‰

---

### Phase 3 éªŒæ”¶æµ‹è¯• â³

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ—¶é—´æˆ³è¢«æ­£ç¡®æå–å’Œä½¿ç”¨
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ4/4 æˆ–æ›´å¤šï¼‰

---

## Phase 4: é›†æˆä¸æµ‹è¯•ï¼ˆ2-3 å°æ—¶ï¼‰

### Task 4.1: ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶ â³

**ç›®æ ‡**ï¼šè¦†ç›–æ‰€æœ‰ä»£ç è·¯å¾„

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] `new()` çš„æ‰€æœ‰é”™è¯¯è·¯å¾„
- [ ] `send()` çš„æ‰€æœ‰è¾¹ç•Œæƒ…å†µ
- [ ] `receive()` çš„æ‰€æœ‰è¾¹ç•Œæƒ…å†µ
- [ ] é”™è¯¯å¸§å¤„ç†çš„æ‰€æœ‰æƒ…å†µ
- [ ] æ—¶é—´æˆ³çš„æ‰€æœ‰æƒ…å†µ
- [ ] `Drop` å®ç°ï¼ˆå¦‚æœæ·»åŠ äº†æ¸…ç†é€»è¾‘ï¼‰

**è¦†ç›–ç‡ç›®æ ‡**ï¼š
- âœ… ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- âœ… æ‰€æœ‰å…¬å…± API éƒ½æœ‰æµ‹è¯•
- âœ… æ‰€æœ‰é”™è¯¯è·¯å¾„éƒ½æœ‰æµ‹è¯•

**å·¥å…·**ï¼š
- ä½¿ç”¨ `cargo tarpaulin` æˆ– `cargo llvm-cov` æ£€æŸ¥è¦†ç›–ç‡

---

### Task 4.2: ç¼–å†™é›†æˆæµ‹è¯• â³

**ç›®æ ‡**ï¼šæµ‹è¯• SocketCAN é€‚é…å™¨åœ¨å®é™…åœºæ™¯ä¸­çš„è¡Œä¸º

**æµ‹è¯•æ¸…å•**ï¼š

```rust
// tests/socketcan_integration_tests.rs

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_full_loopback() {
    // å®Œæ•´çš„å›ç¯æµ‹è¯•ï¼šå‘é€ -> æ¥æ”¶
}

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_high_frequency_send() {
    // é«˜é¢‘å‘é€æµ‹è¯•ï¼ˆ500Hzï¼Œæ¨¡æ‹ŸåŠ›æ§åœºæ™¯ï¼‰
}

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_concurrent_access() {
    // å¹¶å‘è®¿é—®æµ‹è¯•ï¼ˆå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™ï¼‰
}

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_timeout_behavior() {
    // è¶…æ—¶è¡Œä¸ºæµ‹è¯•
}

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_resource_cleanup() {
    // èµ„æºæ¸…ç†æµ‹è¯•ï¼ˆç¡®ä¿æ²¡æœ‰æ³„æ¼ï¼‰
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆâ‰¥ 5 ä¸ªæµ‹è¯•ï¼‰

---

### Task 4.3: æ€§èƒ½åŸºå‡†æµ‹è¯• â³

**ç›®æ ‡**ï¼šç¡®ä¿ SocketCAN é€‚é…å™¨æ»¡è¶³æ€§èƒ½è¦æ±‚

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] å•æ¬¡å‘é€å»¶è¿Ÿï¼ˆåº”è¯¥ < 1msï¼‰
- [ ] å•æ¬¡æ¥æ”¶å»¶è¿Ÿï¼ˆåº”è¯¥ < 1msï¼‰
- [ ] ååé‡æµ‹è¯•ï¼ˆ500Hz å‘é€/æ¥æ”¶ï¼‰
- [ ] å†…å­˜ä½¿ç”¨æµ‹è¯•ï¼ˆç¡®ä¿æ— æ³„æ¼ï¼‰

**åŸºå‡†ç›®æ ‡**ï¼š
- âœ… å‘é€å»¶è¿Ÿ < 1ms
- âœ… æ¥æ”¶å»¶è¿Ÿ < 1ms
- âœ… æ”¯æŒ 500Hz é¢‘ç‡ï¼ˆ2ms å‘¨æœŸï¼‰

**å·¥å…·**ï¼š
- ä½¿ç”¨ `criterion` è¿›è¡ŒåŸºå‡†æµ‹è¯•

---

### Task 4.4: é”™è¯¯æ¢å¤æµ‹è¯• â³

**ç›®æ ‡**ï¼šæµ‹è¯•é”™è¯¯æ¢å¤èƒ½åŠ›

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] è¶…æ—¶åæ¢å¤ï¼ˆç»§ç»­æ¥æ”¶ï¼‰
- [ ] é”™è¯¯å¸§åæ¢å¤ï¼ˆç»§ç»­æ¥æ”¶æœ‰æ•ˆå¸§ï¼‰
- [ ] æ¥å£ä¸´æ—¶æ–­å¼€åæ¢å¤ï¼ˆå¦‚æœå¯èƒ½ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… é€‚é…å™¨èƒ½å¤Ÿä»é”™è¯¯ä¸­æ¢å¤
- âœ… æ¢å¤ååŠŸèƒ½æ­£å¸¸

---

### Task 4.5: ä»£ç è´¨é‡æ£€æŸ¥ â³

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è¿è¡Œ `cargo fmt`ï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰
- [ ] è¿è¡Œ `cargo clippy`ï¼ˆä»£ç æ£€æŸ¥ï¼‰
- [ ] ä¿®å¤æ‰€æœ‰ Clippy è­¦å‘Š
- [ ] æ£€æŸ¥æ–‡æ¡£æ³¨é‡Šå®Œæ•´æ€§
- [ ] æ£€æŸ¥ `#[allow]` æ³¨é‡Šçš„åˆç†æ€§

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ—  Clippy è­¦å‘Š
- âœ… æ‰€æœ‰å…¬å…± API éƒ½æœ‰æ–‡æ¡£æ³¨é‡Š
- âœ… ä»£ç ç¬¦åˆé¡¹ç›®é£æ ¼

---

### Phase 4 éªŒæ”¶æµ‹è¯• â³

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰
- âœ… ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚
- âœ… æ— ä»£ç è´¨é‡é—®é¢˜

---

## Phase 5: ä¸ GS-USB ä¸€è‡´æ€§éªŒè¯ï¼ˆ1-2 å°æ—¶ï¼‰

### Task 5.1: æ¥å£è¯­ä¹‰ä¸€è‡´æ€§æµ‹è¯• â³

**ç›®æ ‡**ï¼šç¡®ä¿ SocketCAN å’Œ GS-USB çš„æ¥å£è¯­ä¹‰å®Œå…¨ä¸€è‡´

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] `send()` çš„è¡Œä¸ºä¸€è‡´ï¼ˆFire-and-Forgetï¼‰
- [ ] `receive()` çš„è¡Œä¸ºä¸€è‡´ï¼ˆé˜»å¡ç›´åˆ°æ”¶åˆ°å¸§æˆ–è¶…æ—¶ï¼‰
- [ ] é”™è¯¯å¤„ç†ä¸€è‡´ï¼ˆç›¸åŒçš„é”™è¯¯ç±»å‹å’Œæ¶ˆæ¯ï¼‰

**æµ‹è¯•æ–¹æ³•**ï¼š
```rust
#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_gs_usb_send_consistency() {
    // æ¯”è¾ƒå‘é€è¡Œä¸ºçš„å·®å¼‚ï¼ˆå¦‚æœæœ‰ï¼‰
}

#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_gs_usb_receive_consistency() {
    // æ¯”è¾ƒæ¥æ”¶è¡Œä¸ºçš„å·®å¼‚ï¼ˆå¦‚æœæœ‰ï¼‰
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ¥å£è¯­ä¹‰å®Œå…¨ä¸€è‡´
- âœ… é”™è¯¯å¤„ç†ä¸€è‡´

---

### Task 5.2: ç«¯åˆ°ç«¯åŠŸèƒ½å¯¹æ¯”æµ‹è¯• â³

**ç›®æ ‡**ï¼šä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ•°æ®ï¼ŒéªŒè¯ä¸¤ç§é€‚é…å™¨è¡Œä¸ºä¸€è‡´

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] ç›¸åŒçš„å¸§ï¼ˆIDã€æ•°æ®ï¼‰å‘é€ï¼ŒéªŒè¯ç»“æœä¸€è‡´
- [ ] ç›¸åŒçš„è¶…æ—¶è®¾ç½®ï¼ŒéªŒè¯è¶…æ—¶è¡Œä¸ºä¸€è‡´
- [ ] ç›¸åŒçš„é”™è¯¯åœºæ™¯ï¼ŒéªŒè¯é”™è¯¯å¤„ç†ä¸€è‡´

**æµ‹è¯•æ–¹æ³•**ï¼š
```rust
#[test]
#[cfg(target_os = "linux")]
fn test_socketcan_gs_usb_frame_equivalence() {
    // å‘é€ç›¸åŒçš„å¸§ï¼ŒéªŒè¯ä¸¤ç§é€‚é…å™¨çš„è¡Œä¸º
    // æ³¨æ„ï¼šGS-USB å¯èƒ½ä¸åœ¨ Linux ä¸Šï¼Œéœ€è¦è·¨å¹³å°æµ‹è¯•
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼ˆå…è®¸å¹³å°å·®å¼‚ï¼‰

---

### Task 5.3: æ€§èƒ½å¯¹æ¯”æµ‹è¯• â³

**ç›®æ ‡**ï¼šæ¯”è¾ƒ SocketCAN å’Œ GS-USB çš„æ€§èƒ½å·®å¼‚

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] å‘é€å»¶è¿Ÿå¯¹æ¯”
- [ ] æ¥æ”¶å»¶è¿Ÿå¯¹æ¯”
- [ ] ååé‡å¯¹æ¯”

**é¢„æœŸç»“æœ**ï¼š
- SocketCANï¼ˆå†…æ ¸çº§ï¼‰åº”è¯¥æ¯” GS-USBï¼ˆç”¨æˆ·æ€ï¼‰æ€§èƒ½æ›´å¥½

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ€§èƒ½å·®å¼‚åˆç†ï¼ˆSocketCAN åº”è¯¥æ›´å¿«æˆ–ç›¸å½“ï¼‰

---

### Task 5.4: æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥ â³

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ¯”è¾ƒä¸¤ç§é€‚é…å™¨çš„æ–‡æ¡£æ³¨é‡Š
- [ ] ç¡®ä¿æ–‡æ¡£é£æ ¼ä¸€è‡´
- [ ] ç¡®ä¿ç¤ºä¾‹ä»£ç ä¸€è‡´ï¼ˆå¦‚æœé€‚ç”¨ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ–‡æ¡£é£æ ¼ä¸€è‡´

---

### Task 5.5: ä¸Šå±‚ API é›†æˆæµ‹è¯• â³

**ç›®æ ‡**ï¼šç¡®ä¿ `PiperBuilder` èƒ½æ— ç¼åˆ‡æ¢ä¸¤ç§é€‚é…å™¨

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] `PiperBuilder` åœ¨ Linux ä¸Šä½¿ç”¨ SocketCAN
- [ ] `PiperBuilder` åœ¨é Linux ä¸Šä½¿ç”¨ GS-USB
- [ ] ç›¸åŒçš„ `PiperBuilder` é…ç½®åœ¨ä¸åŒå¹³å°ä¸Šè¡Œä¸ºä¸€è‡´

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ä¸Šå±‚ API æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨ä¸¤ç§é€‚é…å™¨

---

### Phase 5 éªŒæ”¶æµ‹è¯• â³

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ä¸¤ç§é€‚é…å™¨è¡Œä¸ºåŸºæœ¬ä¸€è‡´
- âœ… ä¸Šå±‚ API é›†æˆæ­£å¸¸

---

## æœ€ç»ˆéªŒæ”¶

### å®Œæ•´æµ‹è¯•å¥—ä»¶è¿è¡Œ

**æ‰§è¡Œæ¸…å•**ï¼š
- [ ] è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼ˆ`cargo test --lib`ï¼‰
- [ ] è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•ï¼ˆ`cargo test --test '*'`ï¼‰
- [ ] è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼ˆ`cargo bench`ï¼Œå¦‚æœå·²å®ç°ï¼‰
- [ ] è¿è¡Œä»£ç è¦†ç›–ç‡æ£€æŸ¥ï¼ˆ`cargo tarpaulin`ï¼‰
- [ ] è¿è¡Œ Clippy æ£€æŸ¥ï¼ˆ`cargo clippy -- -D warnings`ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡**
- âœ… **ä»£ç è¦†ç›–ç‡ â‰¥ 90%**
- âœ… **æ—  Clippy è­¦å‘Š**
- âœ… **æ€§èƒ½æ»¡è¶³è¦æ±‚**

---

### æ–‡æ¡£å®Œæ•´æ€§

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] API æ–‡æ¡£å®Œæ•´ï¼ˆ`cargo doc --no-deps`ï¼‰
- [ ] å®ç°æ–¹æ¡ˆæ–‡æ¡£æ›´æ–°ï¼ˆå¦‚æœ‰å˜æ›´ï¼‰
- [ ] README æ›´æ–°ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰æ–‡æ¡£å®Œæ•´ä¸”å‡†ç¡®

---

### ä»£ç å®¡æŸ¥æ¸…å•

**å®¡æŸ¥è¦ç‚¹**ï¼š
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®é£æ ¼
- [ ] é”™è¯¯å¤„ç†å®Œæ•´
- [ ] èµ„æºç®¡ç†æ­£ç¡®ï¼ˆæ— æ³„æ¼ï¼‰
- [ ] çº¿ç¨‹å®‰å…¨ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] å¯ç»´æŠ¤æ€§ï¼ˆä»£ç æ¸…æ™°ã€æ³¨é‡Šå……åˆ†ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡

---

## é—®é¢˜ä¸é£é™©

### å·²çŸ¥é—®é¢˜

1. **æ—¶é—´æˆ³æ”¯æŒ**ï¼š`socketcan-rs` çš„æ—¶é—´æˆ³ API å¯èƒ½ä¸å®Œå–„ï¼Œéœ€è¦æ·±å…¥ç ”ç©¶
2. **é”™è¯¯å¸§ç”Ÿæˆ**ï¼šéš¾ä»¥åœ¨æµ‹è¯•ä¸­ç”Ÿæˆé”™è¯¯å¸§ï¼Œå¯èƒ½éœ€è¦ mock
3. **æƒé™é—®é¢˜**ï¼šSocketCAN æ¥å£å¯èƒ½éœ€è¦ç‰¹å®šæƒé™ï¼ˆ`dialout` ç»„æˆ– `sudo`ï¼‰

### é£é™©ç¼“è§£

1. **æ—¶é—´æˆ³**ï¼šå¦‚æœ `socketcan-rs` ä¸æ”¯æŒï¼Œè€ƒè™‘æäº¤ PR æˆ–ä½¿ç”¨åº•å±‚ API
2. **é”™è¯¯å¸§æµ‹è¯•**ï¼šä½¿ç”¨ mock/stub æˆ–æ–‡æ¡£è¯´æ˜æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•
3. **æƒé™**ï¼šæ–‡æ¡£è¯´æ˜æƒé™è¦æ±‚ï¼Œæˆ–æä¾›æƒé™æ£€æŸ¥å·¥å…·

---

## å‚è€ƒæ–‡æ¡£

- **å®ç°æ–¹æ¡ˆ**ï¼š`docs/v0/socketcan/implementation_plan.md`
- **é¡¹ç›®æ¶æ„**ï¼š`docs/v0/TDD.md`
- **GS-USB å‚è€ƒ**ï¼š`src/can/gs_usb/mod.rs`
- **socketcan-rs æ–‡æ¡£**ï¼šhttps://docs.rs/socketcan/

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2024-12
**æœ€åæ›´æ–°**ï¼š2024-12

